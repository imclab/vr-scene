/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.BinaryLoader = function ( showStatus ) {

  THREE.Loader.call( this, showStatus );

};

THREE.BinaryLoader.prototype = Object.create( THREE.Loader.prototype );
THREE.BinaryLoader.prototype.constructor = THREE.BinaryLoader;

// Load models generated by slim OBJ converter with BINARY option (converter_obj_three_slim.py -t binary)
//  - binary models consist of two files: JS and BIN
//  - parameters
//    - url (required)
//    - callback (required)
//    - texturePath (optional: if not specified, textures will be assumed to be in the same folder as JS model file)
//    - binaryPath (optional: if not specified, binary file will be assumed to be in the same folder as JS model file)

THREE.BinaryLoader.prototype.load = function ( url, callback, texturePath, binaryPath ) {

  // todo: unify load API to for easier SceneLoader use

  texturePath = texturePath || this.extractUrlBase( url );
  binaryPath = binaryPath || this.extractUrlBase( url );

  var callbackProgress = this.showProgress ? THREE.Loader.prototype.updateProgress : undefined;

  this.onLoadStart();

  // #1 load JS part via web worker

  this.loadAjaxJSON( this, url, callback, texturePath, binaryPath, callbackProgress );

};

THREE.BinaryLoader.prototype.loadAjaxJSON = function ( context, url, callback, texturePath, binaryPath, callbackProgress ) {

  var xhr = new XMLHttpRequest();

  texturePath = texturePath && ( typeof texturePath === "string" ) ? texturePath : this.extractUrlBase( url );
  binaryPath = binaryPath && ( typeof binaryPath === "string" ) ? binaryPath : this.extractUrlBase( url );

  xhr.onreadystatechange = function () {

    if ( xhr.readyState == 4 ) {

      if ( xhr.status == 200 || xhr.status == 0 ) {

        var json = JSON.parse( xhr.responseText );
        context.loadAjaxBuffers( json, callback, binaryPath, texturePath, callbackProgress );

      } else {

        console.error( "THREE.BinaryLoader: Couldn't load [" + url + "] [" + xhr.status + "]" );

      }

    }

  };

  xhr.open( "GET", url, true );
  xhr.send( null );

};

THREE.BinaryLoader.prototype.loadAjaxBuffers = function ( json, callback, binaryPath, texturePath, callbackProgress ) {

  var scope = this;

  var xhr = new XMLHttpRequest(),
    url = binaryPath + json.buffers;

  xhr.addEventListener( 'load', function ( event ) {

    var buffer = xhr.response;

    if ( buffer === undefined ) {

      // IEWEBGL needs this
      buffer = ( new Uint8Array( xhr.responseBody ) ).buffer;

    }

    if ( buffer.byteLength == 0 ) {  // iOS and other XMLHttpRequest level 1

      var buffer = new ArrayBuffer( xhr.responseText.length );

      var bufView = new Uint8Array( buffer );

      for ( var i = 0, l = xhr.responseText.length; i < l; i ++ ) {

        bufView[ i ] = xhr.responseText.charCodeAt( i ) & 0xff;

      }

    }

    scope.createBinModel( buffer, callback, texturePath, json.materials );

  }, false );

  if ( callbackProgress !== undefined ) {

    xhr.addEventListener( 'progress', function ( event ) {

      if ( event.lengthComputable ) {

        callbackProgress( event );

      }

    }, false );

  }

  xhr.addEventListener( 'error', function ( event ) {

    console.error( "THREE.BinaryLoader: Couldn't load [" + url + "] [" + xhr.status + "]" );

  }, false );


  xhr.open( "GET", url, true );
  xhr.responseType = "arraybuffer";
  if ( xhr.overrideMimeType ) xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
  xhr.send( null );

};

// Binary AJAX parser

THREE.BinaryLoader.prototype.createBinModel = function ( data, callback, texturePath, jsonMaterials ) {

  var Model = function ( texturePath ) {

    var scope = this,
      currentOffset = 0,
      md,
      normals = [],
      uvs = [],
      start_tri_flat, start_tri_smooth, start_tri_flat_uv, start_tri_smooth_uv,
      start_quad_flat, start_quad_smooth, start_quad_flat_uv, start_quad_smooth_uv,
      tri_size, quad_size,
      len_tri_flat, len_tri_smooth, len_tri_flat_uv, len_tri_smooth_uv,
      len_quad_flat, len_quad_smooth, len_quad_flat_uv, len_quad_smooth_uv;


    THREE.Geometry.call( this );

    md = parseMetaData( data, currentOffset );

    currentOffset += md.header_bytes;
/*
    md.vertex_index_bytes = Uint32Array.BYTES_PER_ELEMENT;
    md.material_index_bytes = Uint16Array.BYTES_PER_ELEMENT;
    md.normal_index_bytes = Uint32Array.BYTES_PER_ELEMENT;
    md.uv_index_bytes = Uint32Array.BYTES_PER_ELEMENT;
*/
    // buffers sizes

    tri_size =  md.vertex_index_bytes * 3 + md.material_index_bytes;
    quad_size = md.vertex_index_bytes * 4 + md.material_index_bytes;

    len_tri_flat      = md.ntri_flat      * ( tri_size );
    len_tri_smooth    = md.ntri_smooth    * ( tri_size + md.normal_index_bytes * 3 );
    len_tri_flat_uv   = md.ntri_flat_uv   * ( tri_size + md.uv_index_bytes * 3 );
    len_tri_smooth_uv = md.ntri_smooth_uv * ( tri_size + md.normal_index_bytes * 3 + md.uv_index_bytes * 3 );

    len_quad_flat      = md.nquad_flat      * ( quad_size );
    len_quad_smooth    = md.nquad_smooth    * ( quad_size + md.normal_index_bytes * 4 );
    len_quad_flat_uv   = md.nquad_flat_uv   * ( quad_size + md.uv_index_bytes * 4 );
    len_quad_smooth_uv = md.nquad_smooth_uv * ( quad_size + md.normal_index_bytes * 4 + md.uv_index_bytes * 4 );

    // read buffers

    currentOffset += init_vertices( currentOffset );

    currentOffset += init_normals( currentOffset );
    currentOffset += handlePadding( md.nnormals * 3 );

    currentOffset += init_uvs( currentOffset );

    start_tri_flat    = currentOffset;
    start_tri_smooth    = start_tri_flat    + len_tri_flat    + handlePadding( md.ntri_flat * 2 );
    start_tri_flat_uv   = start_tri_smooth  + len_tri_smooth  + handlePadding( md.ntri_smooth * 2 );
    start_tri_smooth_uv = start_tri_flat_uv + len_tri_flat_uv + handlePadding( md.ntri_flat_uv * 2 );

    start_quad_flat     = start_tri_smooth_uv + len_tri_smooth_uv  + handlePadding( md.ntri_smooth_uv * 2 );
    start_quad_smooth   = start_quad_flat     + len_quad_flat    + handlePadding( md.nquad_flat * 2 );
    start_quad_flat_uv  = start_quad_smooth   + len_quad_smooth    + handlePadding( md.nquad_smooth * 2 );
    start_quad_smooth_uv= start_quad_flat_uv  + len_quad_flat_uv   + handlePadding( md.nquad_flat_uv * 2 );

    // have to first process faces with uvs
    // so that face and uv indices match

    init_triangles_flat_uv( start_tri_flat_uv );
    init_triangles_smooth_uv( start_tri_smooth_uv );

    init_quads_flat_uv( start_quad_flat_uv );
    init_quads_smooth_uv( start_quad_smooth_uv );

    // now we can process untextured faces

    init_triangles_flat( start_tri_flat );
    init_triangles_smooth( start_tri_smooth );

    init_quads_flat( start_quad_flat );
    init_quads_smooth( start_quad_smooth );

    this.computeFaceNormals();

    function handlePadding( n ) {

      return ( n % 4 ) ? ( 4 - n % 4 ) : 0;

    };

    function parseMetaData( data, offset ) {

      var metaData = {

        'signature'               :parseString( data, offset,  12 ),
        'header_bytes'            :parseUChar8( data, offset + 12 ),

        'vertex_coordinate_bytes' :parseUChar8( data, offset + 13 ),
        'normal_coordinate_bytes' :parseUChar8( data, offset + 14 ),
        'uv_coordinate_bytes'     :parseUChar8( data, offset + 15 ),

        'vertex_index_bytes'      :parseUChar8( data, offset + 16 ),
        'normal_index_bytes'      :parseUChar8( data, offset + 17 ),
        'uv_index_bytes'          :parseUChar8( data, offset + 18 ),
        'material_index_bytes'    :parseUChar8( data, offset + 19 ),

        'nvertices'    :parseUInt32( data, offset + 20 ),
        'nnormals'     :parseUInt32( data, offset + 20 + 4*1 ),
        'nuvs'         :parseUInt32( data, offset + 20 + 4*2 ),

        'ntri_flat'      :parseUInt32( data, offset + 20 + 4*3 ),
        'ntri_smooth'    :parseUInt32( data, offset + 20 + 4*4 ),
        'ntri_flat_uv'   :parseUInt32( data, offset + 20 + 4*5 ),
        'ntri_smooth_uv' :parseUInt32( data, offset + 20 + 4*6 ),

        'nquad_flat'      :parseUInt32( data, offset + 20 + 4*7 ),
        'nquad_smooth'    :parseUInt32( data, offset + 20 + 4*8 ),
        'nquad_flat_uv'   :parseUInt32( data, offset + 20 + 4*9 ),
        'nquad_smooth_uv' :parseUInt32( data, offset + 20 + 4*10 )

      };
/*
      console.log( "signature: " + metaData.signature );

      console.log( "header_bytes: " + metaData.header_bytes );
      console.log( "vertex_coordinate_bytes: " + metaData.vertex_coordinate_bytes );
      console.log( "normal_coordinate_bytes: " + metaData.normal_coordinate_bytes );
      console.log( "uv_coordinate_bytes: " + metaData.uv_coordinate_bytes );

      console.log( "vertex_index_bytes: " + metaData.vertex_index_bytes );
      console.log( "normal_index_bytes: " + metaData.normal_index_bytes );
      console.log( "uv_index_bytes: " + metaData.uv_index_bytes );
      console.log( "material_index_bytes: " + metaData.material_index_bytes );

      console.log( "nvertices: " + metaData.nvertices );
      console.log( "nnormals: " + metaData.nnormals );
      console.log( "nuvs: " + metaData.nuvs );

      console.log( "ntri_flat: " + metaData.ntri_flat );
      console.log( "ntri_smooth: " + metaData.ntri_smooth );
      console.log( "ntri_flat_uv: " + metaData.ntri_flat_uv );
      console.log( "ntri_smooth_uv: " + metaData.ntri_smooth_uv );

      console.log( "nquad_flat: " + metaData.nquad_flat );
      console.log( "nquad_smooth: " + metaData.nquad_smooth );
      console.log( "nquad_flat_uv: " + metaData.nquad_flat_uv );
      console.log( "nquad_smooth_uv: " + metaData.nquad_smooth_uv );

      var total = metaData.header_bytes
            + metaData.nvertices * metaData.vertex_coordinate_bytes * 3
            + metaData.nnormals * metaData.normal_coordinate_bytes * 3
            + metaData.nuvs * metaData.uv_coordinate_bytes * 2
            + metaData.ntri_flat * ( metaData.vertex_index_bytes*3 + metaData.material_index_bytes )
            + metaData.ntri_smooth * ( metaData.vertex_index_bytes*3 + metaData.material_index_bytes + metaData.normal_index_bytes*3 )
            + metaData.ntri_flat_uv * ( metaData.vertex_index_bytes*3 + metaData.material_index_bytes + metaData.uv_index_bytes*3 )
            + metaData.ntri_smooth_uv * ( metaData.vertex_index_bytes*3 + metaData.material_index_bytes + metaData.normal_index_bytes*3 + metaData.uv_index_bytes*3 )
            + metaData.nquad_flat * ( metaData.vertex_index_bytes*4 + metaData.material_index_bytes )
            + metaData.nquad_smooth * ( metaData.vertex_index_bytes*4 + metaData.material_index_bytes + metaData.normal_index_bytes*4 )
            + metaData.nquad_flat_uv * ( metaData.vertex_index_bytes*4 + metaData.material_index_bytes + metaData.uv_index_bytes*4 )
            + metaData.nquad_smooth_uv * ( metaData.vertex_index_bytes*4 + metaData.material_index_bytes + metaData.normal_index_bytes*4 + metaData.uv_index_bytes*4 );
      console.log( "total bytes: " + total );
*/

      return metaData;

    };

    function parseString( data, offset, length ) {

      var charArray = new Uint8Array( data, offset, length );

      var text = "";

      for ( var i = 0; i < length; i ++ ) {

        text += String.fromCharCode( charArray[ offset + i ] );

      }

      return text;

    };

    function parseUChar8( data, offset ) {

      var charArray = new Uint8Array( data, offset, 1 );

      return charArray[ 0 ];

    };

    function parseUInt32( data, offset ) {

      var intArray = new Uint32Array( data, offset, 1 );

      return intArray[ 0 ];

    };

    function init_vertices( start ) {

      var nElements = md.nvertices;

      var coordArray = new Float32Array( data, start, nElements * 3 );

      var i, x, y, z;

      for( i = 0; i < nElements; i ++ ) {

        x = coordArray[ i * 3 ];
        y = coordArray[ i * 3 + 1 ];
        z = coordArray[ i * 3 + 2 ];

        scope.vertices.push( new THREE.Vector3( x, y, z ) );

      }

      return nElements * 3 * Float32Array.BYTES_PER_ELEMENT;

    };

    function init_normals( start ) {

      var nElements = md.nnormals;

      if ( nElements ) {

        var normalArray = new Int8Array( data, start, nElements * 3 );

        var i, x, y, z;

        for( i = 0; i < nElements; i ++ ) {

          x = normalArray[ i * 3 ];
          y = normalArray[ i * 3 + 1 ];
          z = normalArray[ i * 3 + 2 ];

          normals.push( x/127, y/127, z/127 );

        }

      }

      return nElements * 3 * Int8Array.BYTES_PER_ELEMENT;

    };

    function init_uvs( start ) {

      var nElements = md.nuvs;

      if ( nElements ) {

        var uvArray = new Float32Array( data, start, nElements * 2 );

        var i, u, v;

        for( i = 0; i < nElements; i ++ ) {

          u = uvArray[ i * 2 ];
          v = uvArray[ i * 2 + 1 ];

          uvs.push( u, v );

        }

      }

      return nElements * 2 * Float32Array.BYTES_PER_ELEMENT;

    };

    function init_uvs3( nElements, offset ) {

      var i, uva, uvb, uvc, u1, u2, u3, v1, v2, v3;

      var uvIndexBuffer = new Uint32Array( data, offset, 3 * nElements );

      for( i = 0; i < nElements; i ++ ) {

        uva = uvIndexBuffer[ i * 3 ];
        uvb = uvIndexBuffer[ i * 3 + 1 ];
        uvc = uvIndexBuffer[ i * 3 + 2 ];

        u1 = uvs[ uva*2 ];
        v1 = uvs[ uva*2 + 1 ];

        u2 = uvs[ uvb*2 ];
        v2 = uvs[ uvb*2 + 1 ];

        u3 = uvs[ uvc*2 ];
        v3 = uvs[ uvc*2 + 1 ];

        scope.faceVertexUvs[ 0 ].push( [
          new THREE.Vector2( u1, v1 ),
          new THREE.Vector2( u2, v2 ),
          new THREE.Vector2( u3, v3 )
        ] );

      }

    };

    function init_uvs4( nElements, offset ) {

      var i, uva, uvb, uvc, uvd, u1, u2, u3, u4, v1, v2, v3, v4;

      var uvIndexBuffer = new Uint32Array( data, offset, 4 * nElements );

      for( i = 0; i < nElements; i ++ ) {

        uva = uvIndexBuffer[ i * 4 ];
        uvb = uvIndexBuffer[ i * 4 + 1 ];
        uvc = uvIndexBuffer[ i * 4 + 2 ];
        uvd = uvIndexBuffer[ i * 4 + 3 ];

        u1 = uvs[ uva*2 ];
        v1 = uvs[ uva*2 + 1 ];

        u2 = uvs[ uvb*2 ];
        v2 = uvs[ uvb*2 + 1 ];

        u3 = uvs[ uvc*2 ];
        v3 = uvs[ uvc*2 + 1 ];

        u4 = uvs[ uvd*2 ];
        v4 = uvs[ uvd*2 + 1 ];

        scope.faceVertexUvs[ 0 ].push( [
          new THREE.Vector2( u1, v1 ),
          new THREE.Vector2( u2, v2 ),
          new THREE.Vector2( u4, v4 )
        ] );

        scope.faceVertexUvs[ 0 ].push( [
          new THREE.Vector2( u2, v2 ),
          new THREE.Vector2( u3, v3 ),
          new THREE.Vector2( u4, v4 )
        ] );

      }

    };

    function init_faces3_flat( nElements, offsetVertices, offsetMaterials ) {

      var i, a, b, c, m;

      var vertexIndexBuffer = new Uint32Array( data, offsetVertices, 3 * nElements );
      var materialIndexBuffer = new Uint16Array( data, offsetMaterials, nElements );

      for( i = 0; i < nElements; i ++ ) {

        a = vertexIndexBuffer[ i * 3 ];
        b = vertexIndexBuffer[ i * 3 + 1 ];
        c = vertexIndexBuffer[ i * 3 + 2 ];

        m = materialIndexBuffer[ i ];

        scope.faces.push( new THREE.Face3( a, b, c, null, null, m ) );

      }

    };

    function init_faces4_flat( nElements, offsetVertices, offsetMaterials ) {

      var i, a, b, c, d, m;

      var vertexIndexBuffer = new Uint32Array( data, offsetVertices, 4 * nElements );
      var materialIndexBuffer = new Uint16Array( data, offsetMaterials, nElements );

      for( i = 0; i < nElements; i ++ ) {

        a = vertexIndexBuffer[ i * 4 ];
        b = vertexIndexBuffer[ i * 4 + 1 ];
        c = vertexIndexBuffer[ i * 4 + 2 ];
        d = vertexIndexBuffer[ i * 4 + 3 ];

        m = materialIndexBuffer[ i ];

        scope.faces.push( new THREE.Face3( a, b, d, null, null, m ) );
        scope.faces.push( new THREE.Face3( b, c, d, null, null, m ) );

      }

    };

    function init_faces3_smooth( nElements, offsetVertices, offsetNormals, offsetMaterials ) {

      var i, a, b, c, m;
      var na, nb, nc;

      var vertexIndexBuffer = new Uint32Array( data, offsetVertices, 3 * nElements );
      var normalIndexBuffer = new Uint32Array( data, offsetNormals, 3 * nElements );
      var materialIndexBuffer = new Uint16Array( data, offsetMaterials, nElements );

      for( i = 0; i < nElements; i ++ ) {

        a = vertexIndexBuffer[ i * 3 ];
        b = vertexIndexBuffer[ i * 3 + 1 ];
        c = vertexIndexBuffer[ i * 3 + 2 ];

        na = normalIndexBuffer[ i * 3 ];
        nb = normalIndexBuffer[ i * 3 + 1 ];
        nc = normalIndexBuffer[ i * 3 + 2 ];

        m = materialIndexBuffer[ i ];

        var nax = normals[ na*3     ],
          nay = normals[ na*3 + 1 ],
          naz = normals[ na*3 + 2 ],

          nbx = normals[ nb*3     ],
          nby = normals[ nb*3 + 1 ],
          nbz = normals[ nb*3 + 2 ],

          ncx = normals[ nc*3     ],
          ncy = normals[ nc*3 + 1 ],
          ncz = normals[ nc*3 + 2 ];

        scope.faces.push( new THREE.Face3( a, b, c, [
          new THREE.Vector3( nax, nay, naz ),
          new THREE.Vector3( nbx, nby, nbz ),
          new THREE.Vector3( ncx, ncy, ncz )
        ], null, m ) );

      }

    };

    function init_faces4_smooth( nElements, offsetVertices, offsetNormals, offsetMaterials ) {

      var i, a, b, c, d, m;
      var na, nb, nc, nd;

      var vertexIndexBuffer = new Uint32Array( data, offsetVertices, 4 * nElements );
      var normalIndexBuffer = new Uint32Array( data, offsetNormals, 4 * nElements );
      var materialIndexBuffer = new Uint16Array( data, offsetMaterials, nElements );

      for( i = 0; i < nElements; i ++ ) {

        a = vertexIndexBuffer[ i * 4 ];
        b = vertexIndexBuffer[ i * 4 + 1 ];
        c = vertexIndexBuffer[ i * 4 + 2 ];
        d = vertexIndexBuffer[ i * 4 + 3 ];

        na = normalIndexBuffer[ i * 4 ];
        nb = normalIndexBuffer[ i * 4 + 1 ];
        nc = normalIndexBuffer[ i * 4 + 2 ];
        nd = normalIndexBuffer[ i * 4 + 3 ];

        m = materialIndexBuffer[ i ];

        var nax = normals[ na*3     ],
          nay = normals[ na*3 + 1 ],
          naz = normals[ na*3 + 2 ],

          nbx = normals[ nb*3     ],
          nby = normals[ nb*3 + 1 ],
          nbz = normals[ nb*3 + 2 ],

          ncx = normals[ nc*3     ],
          ncy = normals[ nc*3 + 1 ],
          ncz = normals[ nc*3 + 2 ],

          ndx = normals[ nd*3     ],
          ndy = normals[ nd*3 + 1 ],
          ndz = normals[ nd*3 + 2 ];

        scope.faces.push( new THREE.Face3( a, b, d, [
          new THREE.Vector3( nax, nay, naz ),
          new THREE.Vector3( nbx, nby, nbz ),
          new THREE.Vector3( ndx, ndy, ndz )
        ], null, m ) );

        scope.faces.push( new THREE.Face3( b, c, d, [
          new THREE.Vector3( nbx, nby, nbz ),
          new THREE.Vector3( ncx, ncy, ncz ),
          new THREE.Vector3( ndx, ndy, ndz )
        ], null, m ) );

      }

    };

    function init_triangles_flat( start ) {

      var nElements = md.ntri_flat;

      if ( nElements ) {

        var offsetMaterials = start + nElements * Uint32Array.BYTES_PER_ELEMENT * 3;
        init_faces3_flat( nElements, start, offsetMaterials );

      }

    };

    function init_triangles_flat_uv( start ) {

      var nElements = md.ntri_flat_uv;

      if ( nElements ) {

        var offsetUvs = start + nElements * Uint32Array.BYTES_PER_ELEMENT * 3;
        var offsetMaterials = offsetUvs + nElements * Uint32Array.BYTES_PER_ELEMENT * 3;

        init_faces3_flat( nElements, start, offsetMaterials );
        init_uvs3( nElements, offsetUvs );

      }

    };

    function init_triangles_smooth( start ) {

      var nElements = md.ntri_smooth;

      if ( nElements ) {

        var offsetNormals = start + nElements * Uint32Array.BYTES_PER_ELEMENT * 3;
        var offsetMaterials = offsetNormals + nElements * Uint32Array.BYTES_PER_ELEMENT * 3;

        init_faces3_smooth( nElements, start, offsetNormals, offsetMaterials );

      }

    };

    function init_triangles_smooth_uv( start ) {

      var nElements = md.ntri_smooth_uv;

      if ( nElements ) {

        var offsetNormals = start + nElements * Uint32Array.BYTES_PER_ELEMENT * 3;
        var offsetUvs = offsetNormals + nElements * Uint32Array.BYTES_PER_ELEMENT * 3;
        var offsetMaterials = offsetUvs + nElements * Uint32Array.BYTES_PER_ELEMENT * 3;

        init_faces3_smooth( nElements, start, offsetNormals, offsetMaterials );
        init_uvs3( nElements, offsetUvs );

      }

    };

    function init_quads_flat( start ) {

      var nElements = md.nquad_flat;

      if ( nElements ) {

        var offsetMaterials = start + nElements * Uint32Array.BYTES_PER_ELEMENT * 4;
        init_faces4_flat( nElements, start, offsetMaterials );

      }

    };

    function init_quads_flat_uv( start ) {

      var nElements = md.nquad_flat_uv;

      if ( nElements ) {

        var offsetUvs = start + nElements * Uint32Array.BYTES_PER_ELEMENT * 4;
        var offsetMaterials = offsetUvs + nElements * Uint32Array.BYTES_PER_ELEMENT * 4;

        init_faces4_flat( nElements, start, offsetMaterials );
        init_uvs4( nElements, offsetUvs );

      }

    };

    function init_quads_smooth( start ) {

      var nElements = md.nquad_smooth;

      if ( nElements ) {

        var offsetNormals = start + nElements * Uint32Array.BYTES_PER_ELEMENT * 4;
        var offsetMaterials = offsetNormals + nElements * Uint32Array.BYTES_PER_ELEMENT * 4;

        init_faces4_smooth( nElements, start, offsetNormals, offsetMaterials );

      }

    };

    function init_quads_smooth_uv( start ) {

      var nElements = md.nquad_smooth_uv;

      if ( nElements ) {

        var offsetNormals = start + nElements * Uint32Array.BYTES_PER_ELEMENT * 4;
        var offsetUvs = offsetNormals + nElements * Uint32Array.BYTES_PER_ELEMENT * 4;
        var offsetMaterials = offsetUvs + nElements * Uint32Array.BYTES_PER_ELEMENT * 4;

        init_faces4_smooth( nElements, start, offsetNormals, offsetMaterials );
        init_uvs4( nElements, offsetUvs );

      }

    };

  };

  Model.prototype = Object.create( THREE.Geometry.prototype );
  Model.prototype.constructor = Model;

  var geometry = new Model( texturePath );
  var materials = this.initMaterials( jsonMaterials, texturePath );

  if ( this.needsTangents( materials ) ) geometry.computeTangents();

  callback( geometry, materials );

};

/* globals define */
;(function(define){'use strict';define(function(require,exports,module){
/**
 * Locals
 */
var textContent = Object.getOwnPropertyDescriptor(Node.prototype,
    'textContent');
var innerHTML = Object.getOwnPropertyDescriptor(Element.prototype, 'innerHTML');
var removeAttribute = Element.prototype.removeAttribute;
var setAttribute = Element.prototype.setAttribute;
var noop  = function() {};

/**
 * Register a new component.
 *
 * @param  {String} name
 * @param  {Object} props
 * @return {constructor}
 * @public
 */
exports.register = function(name, props) {
  var baseProto = getBaseProto(props.extends);
  var template = props.template || baseProto.templateString;

  // Components are extensible by default but can be declared
  // as non extensible as an optimization to avoid
  // storing the template strings
  var extensible = props.extensible = props.hasOwnProperty('extensible')?
    props.extensible : true;

  // Clean up
  delete props.extends;

  // Pull out CSS that needs to be in the light-dom
  if (template) {
    // Stores the string to be reprocessed when
    // a new component extends this one
    if (extensible && props.template) {
      props.templateString = props.template;
    }

    var output = processCss(template, name);

    props.template = document.createElement('template');
    props.template.innerHTML = output.template;
    props.lightCss = output.lightCss;

    props.globalCss = props.globalCss || '';
    props.globalCss += output.globalCss;
  }

  // Inject global CSS into the document,
  // and delete as no longer needed
  injectGlobalCss(props.globalCss);
  delete props.globalCss;

  // Merge base getter/setter attributes with the user's,
  // then define the property descriptors on the prototype.
  var descriptors = mixin(props.attrs || {}, base.descriptors);

  // Store the orginal descriptors somewhere
  // a little more private and delete the original
  props._attrs = props.attrs;
  delete props.attrs;

  // Create the prototype, extended from base and
  // define the descriptors directly on the prototype
  var proto = createProto(baseProto, props);
  Object.defineProperties(proto, descriptors);

  // Register the custom-element and return the constructor
  try {
    return document.registerElement(name, { prototype: proto });
  } catch (e) {
    if (e.name !== 'NotSupportedError') {
      throw e;
    }
  }
};

var base = {
  properties: {
    GaiaComponent: true,
    attributeChanged: noop,
    attached: noop,
    detached: noop,
    created: noop,

    createdCallback: function() {
      if (this.rtl) { addDirObserver(); }
      injectLightCss(this);
      this.created();
    },

    /**
     * It is very common to want to keep object
     * properties in-sync with attributes,
     * for example:
     *
     *   el.value = 'foo';
     *   el.setAttribute('value', 'foo');
     *
     * So we support an object on the prototype
     * named 'attrs' to provide a consistent
     * way for component authors to define
     * these properties. When an attribute
     * changes we keep the attr[name]
     * up-to-date.
     *
     * @param  {String} name
     * @param  {String||null} from
     * @param  {String||null} to
     */
    attributeChangedCallback: function(name, from, to) {
      var prop = toCamelCase(name);
      if (this._attrs && this._attrs[prop]) { this[prop] = to; }
      this.attributeChanged(name, from, to);
    },

    attachedCallback: function() { this.attached(); },
    detachedCallback: function() { this.detached(); },

    /**
     * A convenient method for setting up
     * a shadow-root using the defined template.
     *
     * @return {ShadowRoot}
     */
    setupShadowRoot: function() {
      if (!this.template) { return; }
      var node = document.importNode(this.template.content, true);
      this.createShadowRoot().appendChild(node);
      return this.shadowRoot;
    },

    /**
     * Sets an attribute internally
     * and externally. This is so that
     * we can style internal shadow-dom
     * content.
     *
     * @param {String} name
     * @param {String} value
     */
    setAttr: function(name, value) {
      var internal = this.shadowRoot.firstElementChild;
      setAttribute.call(internal, name, value);
      setAttribute.call(this, name, value);
    },

    /**
     * Removes an attribute internally
     * and externally. This is so that
     * we can style internal shadow-dom
     * content.
     *
     * @param {String} name
     * @param {String} value
     */
    removeAttr: function(name) {
      var internal = this.shadowRoot.firstElementChild;
      removeAttribute.call(internal, name);
      removeAttribute.call(this, name);
    }
  },

  descriptors: {
    textContent: {
      set: function(value) {
        textContent.set.call(this, value);
        if (this.lightStyle) { this.appendChild(this.lightStyle); }
      },

      get: function() {
        return textContent.get();
      }
    },

    innerHTML: {
      set: function(value) {
        innerHTML.set.call(this, value);
        if (this.lightStyle) { this.appendChild(this.lightStyle); }
      },

      get: innerHTML.get
    }
  }
};

/**
 * The default base prototype to use
 * when `extends` is undefined.
 *
 * @type {Object}
 */
var defaultPrototype = createProto(HTMLElement.prototype, base.properties);

/**
 * Returns a suitable prototype based
 * on the object passed.
 *
 * @private
 * @param  {HTMLElementPrototype|undefined} proto
 * @return {HTMLElementPrototype}
 */
function getBaseProto(proto) {
  if (!proto) { return defaultPrototype; }
  proto = proto.prototype || proto;
  return !proto.GaiaComponent ?
    createProto(proto, base.properties) : proto;
}

/**
 * Extends the given proto and mixes
 * in the given properties.
 *
 * @private
 * @param  {Object} proto
 * @param  {Object} props
 * @return {Object}
 */
function createProto(proto, props) {
  return mixin(Object.create(proto), props);
}

/**
 * Detects presence of shadow-dom
 * CSS selectors.
 *
 * @private
 * @return {Boolean}
 */
var hasShadowCSS = (function() {
  var div = document.createElement('div');
  try { div.querySelector(':host'); return true; }
  catch (e) { return false; }
})();

/**
 * Regexs used to extract shadow-css
 *
 * @type {Object}
 */
var regex = {
  shadowCss: /(?:\:host|\:\:content)[^{]*\{[^}]*\}/g,
  ':host': /(?:\:host)/g,
  ':host()': /\:host\((.+)\)(?: \:\:content)?/g,
  ':host-context': /\:host-context\((.+)\)([^{,]+)?/g,
  '::content': /(?:\:\:content)/g
};

/**
 * Extracts the :host and ::content rules
 * from the shadow-dom CSS and rewrites
 * them to work from the <style scoped>
 * injected at the root of the component.
 *
 * @private
 * @return {String}
 */
function processCss(template, name) {
  var globalCss = '';
  var lightCss = '';

  if (!hasShadowCSS) {
    template = template.replace(regex.shadowCss, function(match) {
      var hostContext = regex[':host-context'].exec(match);

      if (hostContext) {
        globalCss += match
          .replace(regex['::content'], '')
          .replace(regex[':host-context'], '$1 ' + name + '$2')
          .replace(/ +/g, ' '); // excess whitespace
      } else {
        lightCss += match
          .replace(regex[':host()'], name + '$1')
          .replace(regex[':host'], name)
          .replace(regex['::content'], name);
      }

      return '';
    });
  }

  return {
    template: template,
    lightCss: lightCss,
    globalCss: globalCss
  };
}

/**
 * Some CSS rules, such as @keyframes
 * and @font-face don't work inside
 * scoped or shadow <style>. So we
 * have to put them into 'global'
 * <style> in the head of the
 * document.
 *
 * @private
 * @param  {String} css
 */
function injectGlobalCss(css) {
  if (!css) {return;}
  var style = document.createElement('style');
  style.innerHTML = css.trim();
  headReady().then(function() {
    document.head.appendChild(style);
  });
}


/**
 * Resolves a promise once document.head is ready.
 *
 * @private
 */
function headReady() {
  return new Promise(function(resolve) {
    if (document.head) { return resolve(); }
    window.addEventListener('load', function fn() {
      window.removeEventListener('load', fn);
      resolve();
    });
  });
}


/**
 * The Gecko platform doesn't yet have
 * `::content` or `:host`, selectors,
 * without these we are unable to style
 * user-content in the light-dom from
 * within our shadow-dom style-sheet.
 *
 * To workaround this, we clone the <style>
 * node into the root of the component,
 * so our selectors are able to target
 * light-dom content.
 *
 * @private
 */
function injectLightCss(el) {
  if (hasShadowCSS) { return; }
  el.lightStyle = document.createElement('style');
  el.lightStyle.setAttribute('scoped', '');
  el.lightStyle.innerHTML = el.lightCss;
  el.appendChild(el.lightStyle);
}

/**
 * Convert hyphen separated
 * string to camel-case.
 *
 * Example:
 *
 *   toCamelCase('foo-bar'); //=> 'fooBar'
 *
 * @private
 * @param  {Sring} string
 * @return {String}
 */
function toCamelCase(string) {
  return string.replace(/-(.)/g, function replacer(string, p1) {
    return p1.toUpperCase();
  });
}

/**
 * Observer (singleton)
 *
 * @type {MutationObserver|undefined}
 */
var dirObserver;

/**
 * Observes the document `dir` (direction)
 * attribute and dispatches a global event
 * when it changes.
 *
 * Components can listen to this event and
 * make internal changes if need be.
 *
 * @private
 */
function addDirObserver() {
  if (dirObserver) { return; }

  dirObserver = new MutationObserver(onChanged);
  dirObserver.observe(document.documentElement, {
    attributeFilter: ['dir'],
    attributes: true
  });

  function onChanged(mutations) {
    document.dispatchEvent(new Event('dirchanged'));
  }
}

/**
 * Copy the values of all properties from
 * source object `target` to a target object `source`.
 * It will return the target object.
 *
 * @private
 * @param   {Object} target
 * @param   {Object} source
 * @returns {Object}
 */
function mixin(target, source) {
  for (var key in source) {
    target[key] = source[key];
  }
  return target;
}

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('gaia-component',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-scene', {
  extends: HTMLDivElement.prototype,

  created: function() {
    this.setupEventHandlers();
    this.setupShadowRoot();
    this.setupRenderer();
    this.setupScene();
    this.setupCamera();
  },

  setupEventHandlers: function() {
    var processDevices = this.processDevices.bind(this);
    var onfullscreenchange = this.onfullscreenchange.bind(this);
    document.addEventListener("webkitfullscreenchange", onfullscreenchange);
    document.addEventListener("mozfullscreenchange",    onfullscreenchange);
    document.addEventListener("fullscreenchange",       onfullscreenchange);
    this.getVRDevices().then(processDevices)['catch'](function (err) {
      console.warn(err);
    });
  },

  onfullscreenchange: function() {
    if ( !document.mozFullScreenElement && !document.webkitFullScreenElement ) {
      this.viewporTransform = this.cameraProjectionTransform;
      this.vrMode = false;
      this.vrEffect.scale = 1;
    } else {
      this.vrMode = true;
      this.viewporTransform = "translate3d(-50%, -50%, 0px)";
      this.vrEffect.scale = 2500;
    }
    this.resizeCanvas();
  },

  addObject: function(el, provided_obj) {
    var obj = el.object3D;
    var objParent = el.parentNode;
    if (obj && this.scene.getObjectById(obj.id)) {
      return obj;
    }
    obj = el.object3D = el.object3D || provided_obj || new THREE.Object3D();
    obj.scene = this;
    if (objParent && objParent !== this) {
      objParent = this.addObject(el.parentNode);
      objParent.add(obj);
    } else {
      this.scene.add(obj);
    }
    return obj;
  },

  epsilon: function ( value ) {
    return Math.abs( value ) < 0.000001 ? 0 : value;
  },

  getCSSMatrix: function (matrix) {
    var epsilon = this.epsilon;
    var elements = matrix.elements;

    return 'matrix3d(' +
      epsilon( elements[ 0 ] ) + ',' +
      epsilon( elements[ 1 ] ) + ',' +
      epsilon( elements[ 2 ] ) + ',' +
      epsilon( elements[ 3 ] ) + ',' +
      epsilon( elements[ 4 ] ) + ',' +
      epsilon( elements[ 5 ] ) + ',' +
      epsilon( elements[ 6 ] ) + ',' +
      epsilon( elements[ 7 ] ) + ',' +
      epsilon( elements[ 8 ] ) + ',' +
      epsilon( elements[ 9 ] ) + ',' +
      epsilon( elements[ 10 ] ) + ',' +
      epsilon( elements[ 11 ] ) + ',' +
      epsilon( elements[ 12 ] ) + ',' +
      epsilon( elements[ 13 ] ) + ',' +
      epsilon( elements[ 14 ] ) + ',' +
      epsilon( elements[ 15 ] ) +
    ')';
  },

  setupCamera: function() {
    var fov = parseFloat(this.style.getPropertyValue('--fov')) || 45;
    var viewport = this.viewport = this.shadowRoot.querySelector('.viewport');
    var world = this.world = this.shadowRoot.querySelector('.world');
    this.perspective = 0.5 / Math.tan( THREE.Math.degToRad( fov * 0.5 ) ) * this.offsetHeight;

    // DOM camera
    var perspectiveMatrix = this.perspectiveMatrix(THREE.Math.degToRad(fov), this.offsetWidth / this.offsetHeight, 1, 10000);
    var scaled = perspectiveMatrix.clone().scale(new THREE.Vector3(this.offsetWidth, this.offsetHeight, 1));
    var style = this.cameraProjectionTransform = this.getCSSMatrix(scaled);
    this.viewporTransform = style;

    // WebGL camera
    var camera = this.camera = new THREE.PerspectiveCamera(fov, this.offsetWidth / this.offsetHeight, 1, 10000);
    this.vrControls = new THREE.VRControls( camera );

  },

  perspectiveMatrix: function(fov, aspect, nearz, farz) {
    var matrix = new THREE.Matrix4();
    var range = Math.tan(fov * 0.5) * nearz;

    matrix.elements[0] = (2 * nearz) / ((range * aspect) - (-range * aspect));
    matrix.elements[1] = 0;
    matrix.elements[2] = 0;
    matrix.elements[3] = 0;
    matrix.elements[4] = 0;
    matrix.elements[5] = (2 * nearz) / (2 * range);
    matrix.elements[6] = 0;
    matrix.elements[7] = 0;
    matrix.elements[8] = 0;
    matrix.elements[9] = 0;
    matrix.elements[10] = -(farz + nearz) / (farz - nearz);
    matrix.elements[11] = -1;
    matrix.elements[12] = 0;
    matrix.elements[13] = 0;
    matrix.elements[14] = -(2 * farz * nearz) / (farz - nearz);
    matrix.elements[15] = 0;
    return matrix.transpose();
  },

  setupRenderer: function() {
    // All WebGL setup
    var canvas = this.canvas = this.shadowRoot.querySelector('canvas');

    this.resizeCanvas();
    window.addEventListener('resize', this.resizeCanvas.bind(this), false);

    var renderer = this.renderer = new THREE.WebGLRenderer( { canvas: canvas, antialias: true, alpha: true } );
    renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize( this.canvas.width, this.canvas.height );
    renderer.sortObjects = false;
    this.vrEffect = new THREE.VREffect(renderer);
  },

  setupScene: function() {
    // All WebGL Setup
    var scene = this.scene = new THREE.Scene();
    createLights();
    function createLights() {
      var directionalLight = new THREE.DirectionalLight(0xffffff);
      directionalLight.position.set(1, 1, 1).normalize();
      scene.add(directionalLight);
    }
  },

  updateChildren: function() {
    var child;
    var i;
    for (i = 0; i < this.children.length; ++i) {
      child = this.children[i];
      if (typeof child.update == 'function') { child.update(); }
      if (typeof child.updateChildren == 'function') { child.updateChildren(); }
    }
  },

  resizeCanvas: function(renderer, camera){
    var canvas = this.canvas;
    // Make it visually fill the positioned parent
    canvas.style.width ='100%';
    canvas.style.height='100%';
    // ...then set the internal size to match
    canvas.width  = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    if (this.camera) {
      this.camera.aspect = canvas.width / canvas.height;
      this.camera.updateProjectionMatrix();
    }

    if (this.renderer) {
      // notify the renderer of the size change
      this.renderer.setSize( canvas.width, canvas.height );
    }

  },

  animate: function() {
    var renderer = this.vrMode? this.vrEffect : this.renderer;
    this.updateChildren();
    this.vrControls.update();
    var orientation = this.vrControls.state.orientation;
    var orientationMatrix;
    var quaternion;
    if (orientation) {
      quaternion = new THREE.Quaternion(orientation.x, -orientation.y, orientation.z, orientation.w);
      orientationMatrix = new THREE.Matrix4().makeRotationFromQuaternion(quaternion);
      this.viewport.style.transform = this.viewporTransform + ' ' + this.getCSSMatrix(orientationMatrix);
    } else {
      this.viewport.style.transform = this.viewporTransform;
      //this.viewport.style.perspective = this.perspective + 'px';
      //this.world.style.setProperty('--z', -this.perspective);
    }
    renderer.render(this.scene, this.camera);
  },

  attributeChanged: function(name, from, to) {
    if (name === "angle") {
      this.style.transform = 'rotateY( ' + this.angle + 'deg )';
    }
  },

  filterInvalidDevices: function(devices) {
    var oculusDevices = devices.filter(function (device) {
      return device.deviceName.toLowerCase().indexOf('oculus') !== -1;
    });

    if (oculusDevices.length >= 1) {
      return devices.filter(function (device) {
        return device.deviceName.toLowerCase().indexOf('cardboard') === -1;
      });
    } else {
      return devices;
    }
  },

   processDevices: function(devices) {
      devices = this.filterInvalidDevices(devices);

      var headset = undefined;
      var position = undefined;

      for (var i = 0; i < devices.length; i++) {
        var device = devices[i];
        if (device instanceof HMDVRDevice) {
          headset = device;
        }
        if (device instanceof PositionSensorVRDevice) {
          position = device;
        }
        if (position && headset) {
          this.vr = {
            headset: headset,
            position: position
          };
        }
      }
  },

  getVRDevices: function(callback) {
    return new Promise(function (resolve, reject) {
      if (navigator.getVRDevices) {
        navigator.getVRDevices().then(function (devices) {
          resolve(devices);
        }, reject);
      } else {
        reject('No VR devices found.');
      }
    });
  },

  startVR: function() {
    this.mozRequestFullScreen({
      vrDisplay: this.vr.headset
    });
  },

  resetSensor: function() {
    if (this.vr.position) {
      this.vr.position.resetSensor();
    }
  },

  template: `
    <canvas width="100%" height="100%"></canvas>
    <div class="viewport">
        <content></content>
    </div>

    <style>
      :host {
        position: absolute;
        display: inline-block;
        width: 100%;
        height: 100%;
        background-image:
          radial-gradient(
            #0B6790,
            #14364A
          );
      }

      .viewport {
        position: absolute;
        display: inline-block;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
      }

      canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
    </style>`
});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRSCene',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-object', {
  extends: HTMLDivElement.prototype,

  created: function() {
    this.setupShadowRoot();
    this.findScene();
    this.scene.addObject(this);
    this.updateTransform();
    //this.reportSize();
  },

  getChildren: function() {
    var children = this.childNodes;
    var objs = [];
    var i;
    var child;
    for (i=0; i<children.length; ++i) {
      child = children[i];
      if (child.tagName === "VR-OBJECT") {
        objs.push(child);
      }
    }
    return objs;
  },

  updateSize: function() {
    var elRect;
    var children = this.getChildren();
    var rect = {};
    var i;
    for (i = 0; i < children.length; ++i) {
      elRect = children[i].getBoundingClientRect();
      if (typeof rect.top === 'undefined' ||
          elRect.top < rect.top) {
        rect.top = elRect.top;
      }
      if (typeof rect.left === 'undefined' ||
          elRect.left < rect.left) {
        rect.left = elRect.left;
      }
      if (typeof rect.bottom === 'undefined' ||
          elRect.bottom > rect.bottom) {
        rect.bottom = elRect.bottom;
      }
      if (typeof rect.right === 'undefined' ||
         elRect.right > rect.right) {
        rect.right = elRect.right;
      }
    }
    this.style.top = rect.top;
    this.style.left = rect.left;
    this.style.width = (rect.right - rect.left) + 'px';
    this.style.height = (rect.bottom - rect.top) + 'px';
    //this.reportSize();
    return rect;
  },

  reportSize: function() {
    if (this.parentNode && this.parentNode.tagName === "VR-OBJECT") {
      this.parentNode.updateSize();
    }
  },

  attributeChanged: function(name, from, to) {
    this.updateTransform();
  },

  epsilon: function ( value ) {
    return Math.abs( value ) < 0.000001 ? 0 : value;
  },

  update: function() { /* NOOP */ },

  updateChildren: function() {
    var child;
    var i;
    for (i = 0; i < this.children.length; ++i) {
      child = this.children[i];
      if (typeof child.update == 'function') { child.update(); }
      if (typeof child.updateChildren == 'function') { child.updateChildren(); }
    }
  },

  getCSSMatrix: function (matrix) {
    var epsilon = this.epsilon;
    var elements = matrix.elements;

    return 'matrix3d(' +
      epsilon( elements[ 0 ] ) + ',' +
      epsilon( elements[ 1 ] ) + ',' +
      epsilon( elements[ 2 ] ) + ',' +
      epsilon( elements[ 3 ] ) + ',' +
      epsilon( elements[ 4 ] ) + ',' +
      epsilon( elements[ 5 ] ) + ',' +
      epsilon( elements[ 6 ] ) + ',' +
      epsilon( elements[ 7 ] ) + ',' +
      epsilon( elements[ 8 ] ) + ',' +
      epsilon( elements[ 9 ] ) + ',' +
      epsilon( elements[ 10 ] ) + ',' +
      epsilon( elements[ 11 ] ) + ',' +
      epsilon( elements[ 12 ] ) + ',' +
      epsilon( elements[ 13 ] ) + ',' +
      epsilon( elements[ 14 ] ) + ',' +
      epsilon( elements[ 15 ] ) +
    ')';
  },

  // If not defined these variables DO NOT
  // cascade from the parent
  notPropagatingVariables: {
    "--x": true,
    "--y": true,
    "--z": true,
    "--rotX": true,
    "--rotY": true,
    "--rotZ": true
  },

  getPropertyValue: function(property) {
    var style = this.notPropagatingVariables[property]?
      this.style : window.getComputedStyle(this);
    return style.getPropertyValue(property);
  },

  updateTransform: function() {
    var previousPosition = this.previousPosition = this.previousPosition || {};
    // Position
    var x = parseFloat(this.getPropertyValue('--x')) || 0;
    var y = parseFloat(this.getPropertyValue('--y')) || 0;
    var z = parseFloat(this.getPropertyValue('--z')) || 0;
    var translation = new THREE.Matrix4().makeTranslation(x, y, -z);

    // Orientation
    var orientationX = parseFloat(this.getPropertyValue('--rotX')) || 0;
    var orientationY = parseFloat(this.getPropertyValue('--rotY')) || 0;
    var orientationZ = parseFloat(this.getPropertyValue('--rotZ')) || 0;

    var rotX = THREE.Math.degToRad(orientationX);
    var rotY = THREE.Math.degToRad(orientationY);
    var rotZ = THREE.Math.degToRad(orientationZ);
    var rotationX = new THREE.Matrix4().makeRotationX(rotX);
    var rotationY = new THREE.Matrix4().makeRotationY(rotY);
    var rotationZ = new THREE.Matrix4().makeRotationZ(rotZ);
    this.style.transform = "translate3d(-50%, -50%, 0) " + this.getCSSMatrix(translation.multiply(rotationZ.multiply(rotationY.multiply(rotationX))));
    this.object3D.position.set(x, -y, -z);
    this.object3D.rotation.order = 'YXZ';
    this.object3D.rotation.set(-rotX, rotY, rotZ);

    // Report position? Only if changed
    // if (x !== previousPosition.x ||
    //     y !== previousPosition.y ||
    //     z !== previousPosition.z ) {
    //   debugger;
    //   this.reportSize();
    //   this.previousPosition = {
    //     x: x,
    //     y: y,
    //     z: z
    //   };
    // }
  },

  findScene: function() {
    var scenes = document.querySelectorAll('vr-scene');
    var perspective;
    for (var i=0; i < scenes.length; ++i) {
      this.scene = scenes[i];
    }
  },

  template: `
    <content></content>
    <style>
      :host {
        left: 50%;
        top: 50%;
        position: absolute;
        transform-style: preserve-3d;
      }
    </style>
  `
});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRObject',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-camera', {
  extends: VRObject.prototype,

  updateTransform: function() {
    var elStyles = window.getComputedStyle(this);
    // Position
    var x = parseFloat(this.style.getPropertyValue('--x')) || 0;
    var y = parseFloat(this.style.getPropertyValue('--y')) || 0;
    var z = parseFloat(this.style.getPropertyValue('--z')) || 0;
    var translation = new THREE.Matrix4().makeTranslation(x, y, -z);

    // Orientation
    var orientationX = parseFloat(this.style.getPropertyValue('--rotX')) || 0;
    var orientationY = parseFloat(this.style.getPropertyValue('--rotY')) || 0;
    var orientationZ = parseFloat(this.style.getPropertyValue('--rotZ')) || 0;

    var rotX = THREE.Math.degToRad(orientationX);
    var rotY = THREE.Math.degToRad(orientationY);
    var rotZ = THREE.Math.degToRad(orientationZ);
    var rotationX = new THREE.Matrix4().makeRotationX(rotX);
    var rotationY = new THREE.Matrix4().makeRotationY(rotY);
    var rotationZ = new THREE.Matrix4().makeRotationZ(rotZ);
    var matrixCSS = rotationZ.multiply(rotationY.multiply(rotationX.multiply(translation)));

    this.style.transform = 'translate3d(-50%, -50%, 0) ' + this.getCSSMatrix(matrixCSS);

    // Matrix threejs
    rotationX = new THREE.Matrix4().makeRotationX(-rotX);
    rotationY = new THREE.Matrix4().makeRotationY(rotY);
    rotationZ = new THREE.Matrix4().makeRotationX(rotZ);
    translation = new THREE.Matrix4().makeTranslation(x, -y, -z);
    var matrix = rotationZ.multiply(rotationY.multiply(rotationX.multiply(translation)));

    var object3D = this.object3D;
    object3D.matrix = matrix;
    object3D.matrixAutoUpdate = false;
    object3D.matrixWorldNeedsUpdate = true;
  }

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRCamera',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-model', {
  extends: VRObject.prototype,

  created: function() {
    this.setupScene();
    VRObject.prototype.created.call(this);
  },

  setupScene: function() {
    var material = new THREE.MeshLambertMaterial({ color: 'magenta' });
    var model = this.model = new THREE.Mesh(new THREE.BoxGeometry(250, 250, 250), material);
    var x = this.style.getPropertyValue('--x') || 0;
    var y = this.style.getPropertyValue('--y') || 0;
    var z = this.style.getPropertyValue('--z');
    this.raycaster = new THREE.Raycaster();
    model.overdraw = true;
    model.position.set(x, y, -z);
    this.object3D = model;
    this.attachClickHandler();
    //this.animate();
  },

  attachClickHandler: function() {
    var self = this;
    self.mousePos = new THREE.Vector2(0, 0);
    //this.scene.addEventListener('mousemove', onMouseMoved, false);
    //document.addEventListener( 'mousedown', onDocumentMouseDown, false );

    function onMouseMoved ( e ) {
      e.preventDefault();
      self.mousePos.x = ( e.clientX / window.innerWidth ) * 2 - 1;
      self.mousePos.y = - ( e.clientY / window.innerHeight ) * 2 + 1;
    }

    function onDocumentMouseDown( e ) {
      if (self.intersected) {
        self.explode();
      }
      // e.preventDefault();
      // var mouseVector = new THREE.Vector3();
      // mouseVector.x = 2 * (e.clientX / SCREEN_WIDTH) - 1;
      // mouseVector.y = 1 - 2 * ( e.clientY / SCREEN_HEIGHT );
      // var raycaster = projector.pickingRay( mouseVector.clone(), camera );
      // var intersects = raycaster.intersectObject( TARGET );
      // for( var i = 0; i < intersects.length; i++ ) {
      //   var intersection = intersects[ i ],
      //   obj = intersection.object;
      //   cons ole.log("Intersected object", obj);
      // }
    }
  },

  explode: function() {

    var box = this.object3D;
    var scene = this.scene;
    var duration = 8000;
    this.exploding = true;

    // explode geometry into objects
    var pieces = explode( box.geometry, box.material );

    box.material.visible = false;

    // animate objects
    for ( var i = 0; i < pieces.children.length; i ++ ) {

      var object = pieces.children[ i ];

      object.geometry.computeFaceNormals();
      var normal = object.geometry.faces[0].normal.clone();
      var targetPosition = object.position.clone().add( normal.multiplyScalar( 3000 ) );
      //removeBoxFromList( box );
      new TWEEN.Tween( object.position )
        .to( targetPosition, duration )
        .onComplete( deleteBox )
        .start();

      object.material.opacity = 0;
      new TWEEN.Tween( object.material )
        .to( { opacity: 1 }, duration )
        .start();

      var rotation = 2 * Math.PI;
      var targetRotation = { x: rotation, y: rotation, z:rotation };
      new TWEEN.Tween( object.rotation )
        .to( targetRotation, duration )
        .start();

    }

    box.add( pieces );

    function removeBoxFromList( box ) {
      for (var i = 0; i < objects.length; i++) {
        if (objects[i] === box) {
          objects.splice(i, 1);
          return;
        }
      }
    }

    function deleteBox() {
      box.remove( pieces )
      //scene.remove( box );
    }

    function explode( geometry, material ) {

      var pieces = new THREE.Group();
      var material = material.clone();
      material.side = THREE.DoubleSide;

      for ( var i = 0; i < geometry.faces.length; i ++ ) {

        var face = geometry.faces[ i ];

        var vertexA = geometry.vertices[ face.a ].clone();
        var vertexB = geometry.vertices[ face.b ].clone();
        var vertexC = geometry.vertices[ face.c ].clone();

        var geometry2 = new THREE.Geometry();
        geometry2.vertices.push( vertexA, vertexB, vertexC );
        geometry2.faces.push( new THREE.Face3( 0, 1, 2 ) );

        var mesh = new THREE.Mesh( geometry2, material );
        mesh.position.sub( geometry2.center() );
        pieces.add( mesh );

      }

      //sort the pieces
      pieces.children.sort( function ( a, b ) {

        return a.position.z - b.position.z;
        //return a.position.x - b.position.x;     // sort x
        //return b.position.y - a.position.y;   // sort y

      } );

      pieces.rotation.set( 0, 0, 0 )

      return pieces;

    }

  },

  animate: function() {
    var self = this;
    var lastTime = self.lastTime || 0;
    var angularSpeed = self.angularSpeed || 0.2;
    requestAnimationFrame(function() {
      self.animate();
      TWEEN.update();
    });

    if (!this.exploding) {
      var time = (new Date()).getTime();
      var timeDiff = time - lastTime;
      var angleChange = angularSpeed * timeDiff * 2 * Math.PI / 1000;
      self.model.rotation.y += angleChange;
      self.lastTime = time;
      //this.intersectMouse();
    }
  },

  // find intersections
  intersectMouse: function intersect() {
    var raycaster = this.raycaster;
    var objects = [this.object3D];
    raycaster.setFromCamera( this.mousePos, this.scene.camera );
    var intersects = raycaster.intersectObjects( objects );

    if ( intersects.length > 0 ) {

      if ( this.object3D == intersects[ 0 ].object && !this.intersected) {

        this.intersected = this.object3D.material.emissive.getHex();
        this.object3D.material.emissive.setHex( 0xffff00 );

      }

    } else {

      if ( this.intersected ) this.object3D.material.emissive.set( 'black' );
      this.intersected = null;

    }
  }

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRModel',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-billboard', {
  extends: VRObject.prototype,

  created: function() {
    VRObject.prototype.created.call(this);
    this.updateTransform();
  },

  update: function() {
    this.updateTransform();
  },

  updateTransform: function() {
    var camera = document.querySelector('vr-camera');
    var matrix = new THREE.Matrix4();
    matrix.copy( matrix.getInverse(camera.object3D.matrixWorld) );
    matrix.copy( camera.object3D.matrixWorld );

    matrix.transpose();

    matrix.elements[ 3 ] = 0;
    matrix.elements[ 7 ] = 0;
    matrix.elements[ 11 ] = 0;
    matrix.elements[ 15 ] = 1;

    // Position
    var x = this.style.getPropertyValue('--x') || 0;
    var y = this.style.getPropertyValue('--y') || 0;
    var z = this.style.getPropertyValue('--z') || 0;
    var translation = new THREE.Matrix4().makeTranslation(x, y, -z);

    // Orientation
    var orientationX = this.style.getPropertyValue('--rotX') || 0;
    var orientationY = this.style.getPropertyValue('--rotY') || 0;
    var orientationZ = this.style.getPropertyValue('--rotZ') || 0;

    var rotX = THREE.Math.degToRad(orientationX);
    var rotY = THREE.Math.degToRad(orientationY);
    var rotZ = THREE.Math.degToRad(orientationZ);
    var rotationX = new THREE.Matrix4().makeRotationX(rotX);
    var rotationY = new THREE.Matrix4().makeRotationY(rotY);
    var rotationZ = new THREE.Matrix4().makeRotationX(rotZ);

    this.style.transform = 'translate3d(-50%, -50%, 0) ' + this.getCSSMatrix(translation.multiply(rotationZ.multiply(rotationY.multiply(rotationX.multiply(matrix)))));
    this.object3D.position.set(x, -y, -z);
    this.object3D.rotation.order = 'YXZ';
    this.object3D.rotation.set(-rotX, rotY, rotZ);
  }

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRBillboard',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-terrain', {
  extends: VRObject.prototype,

  created: function() {
    var self = this;
    this.setupScene(onLoaded);
    function onLoaded() {
      VRObject.prototype.created.call(self);
      self.generateLabels(noise);
    }
  },

  setupScene: function(onLoaded) {
    var self = this;
    this.terrainSize = 1024;
    new Terrain(noise, this.terrainSize, 2, 64, function(model) {;
      self.object3D = model;
      onLoaded();
    });
  },

  generateLabels: function(noise) {
    var label;
    var max = 15;
    for(var i = 0; i < noise.image.data.length; ++i) {
      var noiseValue = noise.image.data[i];
      var sign1 = (Math.random()*10).toFixed(0) % 2 === 0? -1: 1;
      var sign2 = (Math.random()*10).toFixed(0) % 2 === 0? -1: 1;
      if (noiseValue > 80) {
        label = document.createElement('vr-billboard');
        label.classList.add('peak-label');
        label.style.setProperty('--x',  sign1 * (Math.random() * this.terrainSize));
        label.style.setProperty('--y',  sign2 * (Math.random() * this.terrainSize));
        label.style.setProperty('--z',  -noiseValue);
        label.style.setProperty('--rotX',  -90);
        label.innerHTML = "Landmark " + i;
        this.appendChild(label);
        max-=1;
        if (max == 0) {
          return;
        }
      }
    }
  }

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRTerrain',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-axis-gl', {
  extends: VRObject.prototype,

  created: function() {
    this.setupScene();
    VRObject.prototype.created.call(this);
  },

  setupScene: function() {
    this.object3D = new THREE.AxisHelper( 500 );
  }

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRAxisGL',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-axis-dom', {
  extends: VRObject.prototype,

  template: `
    <div class="axis x-axis"></div>
    <div class="axis y-axis"></div>
    <div class="axis z-axis"></div>
    <style>
    :host {
      left: 50%;
      top: 50%;
      position: absolute;
      transform-style: preserve-3d;
    }

    .axis {
      position: absolute;
      display: inline-block;
    }

    .x-axis {
      height: 1px;
      width: 500px;
      background-color: pink;
    }

    .y-axis {
      height: 500px;
      width: 1px;
      background-color: magent;
      transform: translate3d(0, -500px, 0);
    }

    .z-axis {
      height: 1px;
      width: 500px;
      background-color: violet;
      transform: translate3d(-50%, 0, 250px) rotateY(90deg);
    }
    </style>
  `

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRAxisDOM',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

var r = "textures/bridge/";
var urls = [ r + "posx.jpg", r + "negx.jpg",
             r + "posy.jpg", r + "negy.jpg",
             r + "posz.jpg", r + "negz.jpg" ];
var textureCube = THREE.ImageUtils.loadTextureCube( urls );
textureCube.format = THREE.RGBFormat;

/**
 * Exports
 */

module.exports = component.register('vr-lambo', {
  extends: VRObject.prototype,

  created: function() {
    var self = this;
    var modelInfo = this.modelInfo;
    var materials = this.materials;
    modelInfo.materials = {
      body: [
        [ "Orange metal",  materials[ "Orange metal" ] ],
        [ "Blue metal",   materials[ "Blue metal" ] ],
        [ "Red metal",    materials[ "Red metal" ] ],
        [ "Green metal",  materials[ "Green metal" ] ],
        [ "Black metal",  materials[ "Black metal" ] ],
        [ "Gold",     materials[ "Gold" ] ],
        [ "Bronze",   materials[ "Bronze" ] ],
        [ "Chrome",   materials[ "Chrome" ] ]
      ],
      mmap: {
        0: materials[ "Black rough" ],   // tires + inside
        1: materials[ "Pure chrome" ],   // wheels + extras chrome
        2: materials[ "Bronze" ],       // back / top / front torso
        3: materials[ "Light glass" ],    // glass
        4: materials[ "Pure chrome" ],   // sides torso
        5: materials[ "Pure chrome" ],   // engine
        6: materials[ "Red glass 50" ],    // backlights
        7: materials[ "Orange glass 50" ]  // backsignals
      }
    };
    this.setupScene(onLoaded);
    function onLoaded() {
      VRObject.prototype.created.call(self);
      var ambient = new THREE.AmbientLight( 0x050505 );
      self.scene.scene.add( ambient );

      var directionalLight = new THREE.DirectionalLight( 0xffffff, 2 );
      directionalLight.position.set( 2, 1.2, 10 ).normalize();
      self.scene.scene.add( directionalLight );

      directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );
      directionalLight.position.set( -2, 1.2, -10 ).normalize();
      self.scene.scene.add( directionalLight );

      var pointLight = new THREE.PointLight( 0xffaa00, 2 );
      pointLight.position.set( 2000, 1200, 10000 );
      self.scene.scene.add( pointLight );
    }
  },

  // common materials
  materials: {
    "Orange":   new THREE.MeshLambertMaterial( { color: 0xff6600, ambient: 0xff2200, envMap: textureCube, combine: THREE.MixOperation, reflectivity: 0.3 } ),
    "Blue":   new THREE.MeshLambertMaterial( { color: 0x001133, ambient: 0x001133, envMap: textureCube, combine: THREE.MixOperation, reflectivity: 0.3 } ),
    "Red":    new THREE.MeshLambertMaterial( { color: 0x660000, ambient: 0x330000, envMap: textureCube, combine: THREE.MixOperation, reflectivity: 0.25 } ),
    "Black":  new THREE.MeshLambertMaterial( { color: 0x000000, ambient: 0x000000, envMap: textureCube, combine: THREE.MixOperation, reflectivity: 0.15 } ),
    "White":  new THREE.MeshLambertMaterial( { color: 0xffffff, ambient: 0x666666, envMap: textureCube, combine: THREE.MixOperation, reflectivity: 0.25 } ),

    "Carmine":  new THREE.MeshPhongMaterial( { color: 0x770000, specular:0xffaaaa, envMap: textureCube, combine: THREE.MultiplyOperation } ),
    "Gold":   new THREE.MeshPhongMaterial( { color: 0xaa9944, specular:0xbbaa99, shininess:50, envMap: textureCube, combine: THREE.MultiplyOperation } ),
    "Bronze": new THREE.MeshPhongMaterial( { color: 0x150505, specular:0xee6600, shininess:10, envMap: textureCube, combine: THREE.MixOperation, reflectivity: 0.25 } ),
    "Chrome":   new THREE.MeshPhongMaterial( { color: 0xffffff, specular:0xffffff, envMap: textureCube, combine: THREE.MultiplyOperation } ),

    "Orange metal": new THREE.MeshLambertMaterial( { color: 0xff6600, ambient: 0xff2200, envMap: textureCube, combine: THREE.MultiplyOperation } ),
    "Blue metal":   new THREE.MeshLambertMaterial( { color: 0x001133, ambient: 0x002266, envMap: textureCube, combine: THREE.MultiplyOperation } ),
    "Red metal":  new THREE.MeshLambertMaterial( { color: 0x770000, envMap: textureCube, combine: THREE.MultiplyOperation } ),
    "Green metal":  new THREE.MeshLambertMaterial( { color: 0x007711, envMap: textureCube, combine: THREE.MultiplyOperation } ),
    "Black metal":  new THREE.MeshLambertMaterial( { color: 0x222222, envMap: textureCube, combine: THREE.MultiplyOperation } ),

    "Pure chrome":  new THREE.MeshLambertMaterial( { color: 0xffffff, envMap: textureCube } ),
    "Dark chrome":  new THREE.MeshLambertMaterial( { color: 0x444444, envMap: textureCube } ),
    "Darker chrome":new THREE.MeshLambertMaterial( { color: 0x222222, envMap: textureCube } ),

    "Black glass":  new THREE.MeshLambertMaterial( { color: 0x101016, envMap: textureCube, opacity: 0.975, transparent: true } ),
    "Dark glass": new THREE.MeshLambertMaterial( { color: 0x101046, envMap: textureCube, opacity: 0.25, transparent: true } ),
    "Blue glass": new THREE.MeshLambertMaterial( { color: 0x668899, envMap: textureCube, opacity: 0.75, transparent: true } ),
    "Light glass":  new THREE.MeshBasicMaterial( { color: 0x223344, envMap: textureCube, opacity: 0.25, transparent: true, combine: THREE.MixOperation, reflectivity: 0.25 } ),

    "Red glass":  new THREE.MeshLambertMaterial( { color: 0xff0000, opacity: 0.75, transparent: true } ),
    "Yellow glass": new THREE.MeshLambertMaterial( { color: 0xffffaa, opacity: 0.75, transparent: true } ),
    "Orange glass": new THREE.MeshLambertMaterial( { color: 0x995500, opacity: 0.75, transparent: true } ),

    "Orange glass 50":  new THREE.MeshLambertMaterial( { color: 0xffbb00, opacity: 0.5, transparent: true } ),
    "Red glass 50":   new THREE.MeshLambertMaterial( { color: 0xff0000, opacity: 0.5, transparent: true } ),

    "Fullblack rough":  new THREE.MeshLambertMaterial( { color: 0x000000 } ),
    "Black rough":    new THREE.MeshLambertMaterial( { color: 0x050505 } ),
    "Darkgray rough": new THREE.MeshLambertMaterial( { color: 0x090909 } ),
    "Red rough":    new THREE.MeshLambertMaterial( { color: 0x330500 } ),

    "Darkgray shiny": new THREE.MeshPhongMaterial( { color: 0x000000, specular: 0x050505 } ),
    "Gray shiny":   new THREE.MeshPhongMaterial( { color: 0x050505, shininess: 20 } )
  },

  modelInfo: {
    name: "Bugatti Veyron",
    url:  "obj/veyron/VeyronNoUv_bin.js",
    author: '<a href="http://artist-3d.com/free_3d_models/dnm/model_disp.php?uid=1129" target="_blank">Troyano</a>',
    init_rotation: [ 0, 0, 0 ],
    scale: 5.5,
    init_material: 4,
    body_materials: [ 2 ],
    object: null,
    buttons: null,
    materials: null
  },

  setupScene: function(onLoaded) {
    var self = this;
    var loader = new THREE.BinaryLoader(true);
    loader.load(this.modelInfo.url, function(geometry) {
      var modelInfo = self.modelInfo;
      var material = new THREE.MeshFaceMaterial();
      var scale = modelInfo.scale * 1;
      var rotation = modelInfo.init_rotation;
      var materials = modelInfo.materials;
      var initMaterial = modelInfo.init_material;
      var bodyMaterials = modelInfo.body_materials;
      for ( var i in modelInfo.materials.mmap ) {
        material.materials[ i ] = modelInfo.materials.mmap[ i ];
      }
      var mesh = new THREE.Mesh( geometry, material );
      mesh.rotation.x = rotation[ 0 ];
      mesh.rotation.y = rotation[ 1 ];
      mesh.rotation.z = rotation[ 2 ];
      mesh.scale.x = mesh.scale.y = mesh.scale.z = scale;
      var x = parseInt(self.style.getPropertyValue('--x')) || 0;
      var y = parseInt(self.style.getPropertyValue('--y')) || 0;
      var z = parseInt(self.style.getPropertyValue('--z')) || 0;
      mesh.position.set(x, y, -z);
      self.object3D = mesh;
      onLoaded();
    });
  }

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRModel',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-hud', {
  extends: VRObject.prototype,

  created: function() {
    VRObject.prototype.created.call(this);
    var style = window.getComputedStyle(this);
    this.els = {};
    this.els.urlbar = this.shadowRoot.querySelector('.urlbar');
    var data_url = this.getPropertyValue("--data-url");
    data_url = /url\(['"](.*)['"]\)/.exec(data_url)[1];
    ajax.get(data_url, this.loadLinks.bind(this));
  },

  loadLinks(links) {
    var links = links.sites;
    this.classList.add('hud');
    var i;
    var el;
    var h1;
    var h2;
    for (i=0; i < 5; ++i) {
      el = document.createElement('div');
      el.classList.add('hud-element');
      el.classList.add('link');
      h1 = document.createElement('h1');
      h2 = document.createElement('h2');
      h1.innerHTML = links[i].name;
      h2.innerHTML = links[i].tagline;
      el.appendChild(h1);
      el.appendChild(h2);
      el.style.setProperty("--url", links[i].url);
      el.addEventListener('click', this.linkClickHandler.bind(this));
      this.appendChild(el);
    }
  },

  linkClickHandler: function(evt) {
    var url = evt.currentTarget.style.getPropertyValue('--url');
    var event = new CustomEvent('click', { 'detail': { 'url': url } });
    evt.stopPropagation();
    this.dispatchEvent(event);
  },

  show: function() {
    this.classList.remove('hidden');
  },

  hide: function() {
    this.classList.add('hidden');
  },

  template: `
    <div class="links">
      <content></content>
    </div>
    <form class="hud-element urlbar" action="#">
      <input class="urlbar-input" type="text">
    </form>
    <style>

      .hud-element {
        display: inline-block;
        background-color: hsla(228, 15%, 6%, 0.75);
        border: 0.25cm solid black;
        font: 500 1.1rem sans-serif;
      }

      /**
      * URL Bar
      */

      .urlbar {
        margin-top: 20px;
        width: 45%;
      }

      .urlbar-input {
        font: 500 2.1rem/1 sans-serif;
        letter-spacing: 0.05em;
        padding: 0.5em 1em;
        text-align: center;
        text-transform: uppercase;
        transition: .25s width ease;
        width: 100%;
        color: black;
        box-sizing : border-box;
      }

      .urlbar-input:hover {
        background: black;
        color: white;
      }

      .urlbar-input:focus {
        background: white;
        color: black;
      }

      /* NOTE: These selectors cannot be combined: https://developer.mozilla.org/en-US/docs/Web/CSS/::selection#Examples */
      .urlbar-input::selection {
        background: hsla(0, 0%, 0%, 0.2);
        color: white;
      }

      .urlbar-input::-moz-selection {
        background: hsla(0, 0%, 0%, 0.2);
        color: white;
      }

      /**
      * Links
      */

      ::content .link {
        background: white;
        border: 0.25cm solid black;
        font: 500 1.1rem sans-serif;
        display: inline-block;
        height: 7cm;
        margin: 0.25cm;
        overflow: hidden;
        padding: 0.5cm;
        text-align: left;
        width: 7cm;
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

      ::content .link:hover {
        background-color: black;
        color: white;
      }

      ::content .link h1 {
        margin: 0;
        padding: 0;
      }

      ::content .link h2 {
        color: gray;
        margin: 0;
        padding: 0;
      }

      :host {
        left: 50%;
        top: 50%;
        position: absolute;
        transform-style: preserve-3d;
        text-align: center;
      }

      .hidden {
        pointer-events: none;
        display: none;
      }
    </style>
  `

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRHUD',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-webview', {
  extends: VRObject.prototype,

  created: function() {
    VRObject.prototype.created.call(this);
    this.els = {};
    this.els.iframe = this.shadowRoot.querySelector('iframe');
    this.hide();
  },

  loadURL: function(url) {
    this.els.iframe.src = url;
  },

  show: function() {
    this.els.iframe.classList.remove('hidden');
  },

  hide: function() {
    this.els.iframe.classList.add('hidden');
  },

  template: `
    <iframe remote="true" mozbrowser="true"></iframe>
    <style>
      :host {
        left: 50%;
        top: 50%;
        position: absolute;
        transform-style: preserve-3d;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: 0;
        transition: transform 0.3s ease-in-out;
      }

      .hidden {
        pointer-events: none;
        opacity: 0.2;
        transform: translate3d(0, 0, -100px) scale(0.75, 0.75);
      }
    </style>
  `

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRWebView',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');


// .sprite { background: url('sprite.png') no-repeat top left; width: 270px; height: 343px;  }
// .sprite.arm-back { background-position: 0 0; width: 202px; height: 73px; }
// .sprite.arm-bottom { background-position: 0 -83px; width: 203px; height: 34px; }
// .sprite.arm { background-position: 0 -127px; width: 232px; height: 73px; }
// .sprite.body-back { background-position: 0 -210px; }
// .sprite.body-bottom { background-position: 0 -563px; width: 274px; height: 273px; }
// .sprite.body-front { background-position: 0 -846px; }
// .sprite.body-left { background-position: 0 -1199px; }
// .sprite.body-right { background-position: 0 -1552px; }
// .sprite.body-top { background-position: 0 -1905px; width: 274px; height: 273px; }
// .sprite.eyes { background-position: 0 -2188px; height: 110px; }
// .sprite.finger-tip { background-position: 0 -2308px; width: 51px; height: 58px; }
// .sprite.finger { background-position: 0 -2376px; width: 71px; height: 58px; }
// .sprite.forearm-cap { background-position: 0 -2444px; width: 39px; height: 42px; }
// .sprite.forearm { background-position: 0 -2496px; width: 189px; height: 31px; }
// .sprite.head-big { background-position: 0 -2537px; width: 207px; height: 125px; }
// .sprite.head-leftright { background-position: 0 -2672px; width: 14px; height: 130px; }
// .sprite.head-front-back { background-position: 0 -2812px; width: 209px; height: 14px; }
// .sprite.neck-base { background-position: 0 -2836px; width: 35px; height: 42px; }
// .sprite.neck-cap { background-position: 0 -2888px; width: 47px; height: 42px; }
// .sprite.neck-low { background-position: 0 -2940px; width: 170px; height: 37px; }
// .sprite.neck-high { background-position: 0 -2987px; width: 137px; height: 19px; }
// .sprite.shoulder-cap { background-position: 0 -3016px; width: 84px; height: 82px; }
// .sprite.shoulder-left { background-position: 0 -3108px; width: 65px; height: 105px; }
// .sprite.wheel { background-position: 0 -3223px; width: 54px; height: 137px; }
// .sprite.wrist { background-position: 0 -3370px; width: 148px; height: 18px; }

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */
module.exports = component.register('vr-walle', {
  extends: VRObject.prototype,


  template: `
    <div class="ground"></div>

    <div class="walle">

      <div class="body">
        <div class="sprite body-back"></div>
        <div class="sprite body-left"></div>
        <div class="sprite body-right"></div>
        <div class="sprite body-front"></div>
        <div class="sprite body-top"></div>
        <!-- <div class="sprite body-bottom"></div> -->
      </div>

      <div class="head">
        <div class="sprite head-big bottom"></div>
        <div class="sprite head-big top"></div>
        <div class="sprite head-leftright left"></div>
        <div class="sprite head-leftright right"></div>
        <div class="sprite head-front-back back"></div>
        <div class="sprite eyes"></div>
        <div class="sprite neck-low"></div>
        <div class="sprite neck-high"></div>
      </div>

      <div class="sprite arm left">
        <div class="sprite forearm">
          <div class="sprite wrist">
              <div class="sprite finger thumb">
                <div class="sprite finger-tip"></div>
              </div>
              <div class="sprite finger index">
                <div class="sprite finger-tip"></div>
              </div>
              <div class="sprite finger pinky">
                <div class="sprite finger-tip"></div>
              </div>
          </div>
        </div>
      </div>

      <div class="sprite arm right">
        <div class="sprite forearm">
          <div class="sprite wrist">
              <div class="sprite finger thumb">
                <div class="sprite finger-tip"></div>
              </div>
              <div class="sprite finger index">
                <div class="sprite finger-tip"></div>
              </div>
              <div class="sprite finger pinky">
                <div class="sprite finger-tip"></div>
              </div>
          </div>
        </div>
      </div>

      <div class="sprite wheel left">
        <div class="sprite belt bottom"></div>
        <div class="sprite belt back"></div>
        <div class="sprite belt front"></div>
      </div>

      <div class="sprite wheel right">
        <div class="sprite belt bottom"></div>
        <div class="sprite belt back"></div>
        <div class="sprite belt front"></div>
      </div>

    </div>

    <style>
    :host {
      left: 50%;
      top: 50%;
      position: absolute;
      transform-style: preserve-3d;
    }

    .walle {
      position: absolute:
      transform-style: preserve-3d;
    }

    .sprite {
      position: absolute;
      background: url('textures/walle/png/atlas.png') no-repeat top left; width: 270px; height: 343px;
      transform-style: preserve-3d;
    }

    .sprite.body-front {
      background-position: 0 -846px;
    }

    .sprite.body-back {
      background-position: 0 -210px;
      transform: translate3d(0, 0, -270px);
    }

    .sprite.body-left {
      background-position: 0 -1199px;
      transform: translate3d(-135px, 0, -135px) rotateY(90deg);
    }

    .sprite.body-right {
      background-position: 0 -1552px;
      transform: translate3d(135px, 0, -135px) rotateY(90deg) scaleX(-1);
    }

    .sprite.body-top {
      background-position: 0 -1905px; width: 274px; height: 273px;
      transform: translate3d(0, -135px, -135px) rotateX(90deg);
    }

    .sprite.body-bottom {
      background-position: 0 -563px; width: 274px; height: 273px;
      transform: translate3d(0, 210px, -135px) rotateX(90deg);
    }

    .sprite.eyes {
      background-position: 0 -2188px; height: 110px;
      transform: translate3d(0, -210px, -80px);
    }

    .sprite.head-big {
      background-position: 0 -2537px; width: 207px; height: 125px;
    }

    .sprite.head-big.top {
      transform: translate3d(0, -240px, -140px) rotateX(90deg);
    }

    .sprite.head-big.bottom {
      transform: translate3d(0, -220px, -140px) rotateX(90deg);
    }

    .sprite.head-leftright {
      background-position: 0 -2672px; width: 14px; height: 130px;
    }

    .sprite.head-leftright.left {
      transform: translate3d(0, -230px, -140px) rotateZ(90deg) rotateX(90deg);
    }

    .sprite.head-leftright.right {
      transform: translate3d(207px, -230px, -140px) rotateZ(90deg) rotateX(90deg);
    }

    .sprite.head-front-back {
      background-position: 0 -2812px; width: 209px; height: 14px;
      transform: translate3d(0, -170px, -205px);
    }

    .sprite.arm.left {
      background-position: 0 -127px; width: 232px; height: 73px;
      transform: translate3d(-136px, 30px, 0) rotateY(-90deg);
    }

    .sprite.arm.right {
      background-position: 0 -127px; width: 232px; height: 73px;
      transform: translate3d(180px, -60px, -60px) rotateX(60deg) rotateY(-90deg);
    }

    .sprite.forearm {
      background-position: 0 -2496px; width: 189px; height: 31px;
      transform: translate3d(159px, 16px, 0);
    }

    .sprite.wrist {
      background-position: 0 -3370px; width: 148px; height: 18px;
      transform: translate3d(100px, 9px, 0);
    }

    .sprite.finger {
      background-position: 0 -2376px; width: 71px; height: 58px;
    }

    .sprite.finger.thumb {
      transform: rotateX(90deg) translate3d(145px, 0px, 0) rotateY(15deg);
    }

    .sprite.finger.index {
      transform: rotateX(90deg) translate3d(145px, 25px, 40px) rotateY(-15deg);
    }

    .sprite.finger.pinky {
      transform: rotateX(90deg) translate3d(145px, -25px, 40px) rotateY(-15deg);
    }

    .sprite.finger-tip { background-position: 0 -2308px; width: 51px; height: 58px; }

    .sprite.finger.thumb .finger-tip {
      transform: translate3d(60px, 0px, 5px) rotateY(-15deg);
    }

    .sprite.finger.index .finger-tip,
    .sprite.finger.pinky .finger-tip {
      transform: translate3d(60px, 0px, -5px) rotateY(15deg);
    }

    .wheel.left {
      transform: translate3d(-120px, 200px, -150px) rotateY(-90deg) rotateX(-90deg) scale(0.8);
      background: none;
    }

    .wheel.right {
      transform: translate3d(300px, 200px, -150px) rotateY(-90deg) rotateX(-90deg) scale(0.8);
      background: none;
    }

    .belt {
      background: url('textures/walle/wheel.png');
      height: 137px;
      width: calc(54px * 6);
      background-repeat: repeat-x;
    }

    .belt.back {
      width: calc(54px * 4);
      transform-origin: left 50%;
      transform: rotateY(90deg);
    }

    .belt.front {
      width: calc(54px * 7.2);
      transform-origin: right 50%;
      transform: translate3d(calc(-1.2 * 54px), 0, 0) rotateY(-34deg);
    }

    .sprite.neck-low { background-position: 0 -2940px; width: 170px; height: 37px; }

    .sprite.neck-low {
      transform-origin: right 50%;
      transform: translate3d(-35px, 0, -200px) rotateZ(90deg) rotateY(40deg)
    }

    .sprite.neck-high { background-position: 0 -2987px; width: 137px; height: 19px; }

    .sprite.neck-high {
      transform-origin: right 50%;
      transform: translate3d(0, -120px, -90px) rotateZ(90deg) rotateY(-60deg)
    }

    .ground {
      width: 2048px;
      height: 2048px;
      transform-origin: left 50%;
      background-color: green;
      position: absolute;
      transform: translate3d(-50%, calc(-50% + 350px), 0) rotateX(90deg);
      transform-style: preserve-3d;
      background: url('textures/walle/sand.jpg') repeat;
    }

    </style>
  `

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRWalle',this));

/* globals define */
(function(define){'use strict';define(function(require,exports,module){

/**
 * Dependencies
 */

var component = require('gaia-component');

/**
 * Simple logger
 * @type {Function}
 */
var debug = 0 ? console.log.bind(console) : function() {};

/**
 * Exports
 */

module.exports = component.register('vr-skybox', {
  extends: VRObject.prototype,

  created: function() {
    var self = this;
    this.setupScene();
    VRObject.prototype.created.call(self);
  },

  parameters: {
    turbidity: 10,
    reileigh: 2,
    mieCoefficient: 0.005,
    mieDirectionalG: 0.8,
    luminance: 1,
    inclination: 0.49, // elevation / inclination
    azimuth: 0.25, // Facing front,
    sun: !true
  },

  setupScene: function() {
    var sky = this.sky = new THREE.Sky();
    var parameters = this.parameters;
    var uniforms = sky.uniforms;
    uniforms.turbidity.value = parameters.turbidity;
    uniforms.reileigh.value = parameters.reileigh;
    uniforms.luminance.value = parameters.luminance;
    uniforms.mieCoefficient.value = parameters.mieCoefficient;
    uniforms.mieDirectionalG.value = parameters.mieDirectionalG;
    sky.uniforms.sunPosition.value.copy(new THREE.Vector3( -20000, 0, -70000 ));
    // Add Sky Mesh
    this.object3D = sky.mesh;
  }

});

});})(typeof define=='function'&&define.amd?define
:(function(n,w){'use strict';return typeof module=='object'?function(c){
c(require,exports,module);}:function(c){var m={exports:{}};c(function(n){
return w[n];},m.exports,m);w[n]=m.exports;};})('VRSkyBox',this));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkJpbmFyeUxvYWRlci5qcyIsImdhaWEtY29tcG9uZW50LmpzIiwidnItc2NlbmUuanMiLCJ2ci1vYmplY3QuanMiLCJ2ci1jYW1lcmEuanMiLCJ2ci1tb2RlbC5qcyIsInZyLWJpbGxib2FyZC5qcyIsInZyLXRlcnJhaW4uanMiLCJ2ci1heGlzLWdsLmpzIiwidnItYXhpcy1kb20uanMiLCJ2ci1sYW1iby5qcyIsInZyLWh1ZC5qcyIsInZyLXdlYnZpZXcuanMiLCJ2ci13YWxsZS5qcyIsInZyLXNreWJveC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNodkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcGFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25VQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoidnItY29tcG9uZW50cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS9cbiAqL1xuXG5USFJFRS5CaW5hcnlMb2FkZXIgPSBmdW5jdGlvbiAoIHNob3dTdGF0dXMgKSB7XG5cbiAgVEhSRUUuTG9hZGVyLmNhbGwoIHRoaXMsIHNob3dTdGF0dXMgKTtcblxufTtcblxuVEhSRUUuQmluYXJ5TG9hZGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIFRIUkVFLkxvYWRlci5wcm90b3R5cGUgKTtcblRIUkVFLkJpbmFyeUxvYWRlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBUSFJFRS5CaW5hcnlMb2FkZXI7XG5cbi8vIExvYWQgbW9kZWxzIGdlbmVyYXRlZCBieSBzbGltIE9CSiBjb252ZXJ0ZXIgd2l0aCBCSU5BUlkgb3B0aW9uIChjb252ZXJ0ZXJfb2JqX3RocmVlX3NsaW0ucHkgLXQgYmluYXJ5KVxuLy8gIC0gYmluYXJ5IG1vZGVscyBjb25zaXN0IG9mIHR3byBmaWxlczogSlMgYW5kIEJJTlxuLy8gIC0gcGFyYW1ldGVyc1xuLy8gICAgLSB1cmwgKHJlcXVpcmVkKVxuLy8gICAgLSBjYWxsYmFjayAocmVxdWlyZWQpXG4vLyAgICAtIHRleHR1cmVQYXRoIChvcHRpb25hbDogaWYgbm90IHNwZWNpZmllZCwgdGV4dHVyZXMgd2lsbCBiZSBhc3N1bWVkIHRvIGJlIGluIHRoZSBzYW1lIGZvbGRlciBhcyBKUyBtb2RlbCBmaWxlKVxuLy8gICAgLSBiaW5hcnlQYXRoIChvcHRpb25hbDogaWYgbm90IHNwZWNpZmllZCwgYmluYXJ5IGZpbGUgd2lsbCBiZSBhc3N1bWVkIHRvIGJlIGluIHRoZSBzYW1lIGZvbGRlciBhcyBKUyBtb2RlbCBmaWxlKVxuXG5USFJFRS5CaW5hcnlMb2FkZXIucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoIHVybCwgY2FsbGJhY2ssIHRleHR1cmVQYXRoLCBiaW5hcnlQYXRoICkge1xuXG4gIC8vIHRvZG86IHVuaWZ5IGxvYWQgQVBJIHRvIGZvciBlYXNpZXIgU2NlbmVMb2FkZXIgdXNlXG5cbiAgdGV4dHVyZVBhdGggPSB0ZXh0dXJlUGF0aCB8fCB0aGlzLmV4dHJhY3RVcmxCYXNlKCB1cmwgKTtcbiAgYmluYXJ5UGF0aCA9IGJpbmFyeVBhdGggfHwgdGhpcy5leHRyYWN0VXJsQmFzZSggdXJsICk7XG5cbiAgdmFyIGNhbGxiYWNrUHJvZ3Jlc3MgPSB0aGlzLnNob3dQcm9ncmVzcyA/IFRIUkVFLkxvYWRlci5wcm90b3R5cGUudXBkYXRlUHJvZ3Jlc3MgOiB1bmRlZmluZWQ7XG5cbiAgdGhpcy5vbkxvYWRTdGFydCgpO1xuXG4gIC8vICMxIGxvYWQgSlMgcGFydCB2aWEgd2ViIHdvcmtlclxuXG4gIHRoaXMubG9hZEFqYXhKU09OKCB0aGlzLCB1cmwsIGNhbGxiYWNrLCB0ZXh0dXJlUGF0aCwgYmluYXJ5UGF0aCwgY2FsbGJhY2tQcm9ncmVzcyApO1xuXG59O1xuXG5USFJFRS5CaW5hcnlMb2FkZXIucHJvdG90eXBlLmxvYWRBamF4SlNPTiA9IGZ1bmN0aW9uICggY29udGV4dCwgdXJsLCBjYWxsYmFjaywgdGV4dHVyZVBhdGgsIGJpbmFyeVBhdGgsIGNhbGxiYWNrUHJvZ3Jlc3MgKSB7XG5cbiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gIHRleHR1cmVQYXRoID0gdGV4dHVyZVBhdGggJiYgKCB0eXBlb2YgdGV4dHVyZVBhdGggPT09IFwic3RyaW5nXCIgKSA/IHRleHR1cmVQYXRoIDogdGhpcy5leHRyYWN0VXJsQmFzZSggdXJsICk7XG4gIGJpbmFyeVBhdGggPSBiaW5hcnlQYXRoICYmICggdHlwZW9mIGJpbmFyeVBhdGggPT09IFwic3RyaW5nXCIgKSA/IGJpbmFyeVBhdGggOiB0aGlzLmV4dHJhY3RVcmxCYXNlKCB1cmwgKTtcblxuICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgaWYgKCB4aHIucmVhZHlTdGF0ZSA9PSA0ICkge1xuXG4gICAgICBpZiAoIHhoci5zdGF0dXMgPT0gMjAwIHx8IHhoci5zdGF0dXMgPT0gMCApIHtcblxuICAgICAgICB2YXIganNvbiA9IEpTT04ucGFyc2UoIHhoci5yZXNwb25zZVRleHQgKTtcbiAgICAgICAgY29udGV4dC5sb2FkQWpheEJ1ZmZlcnMoIGpzb24sIGNhbGxiYWNrLCBiaW5hcnlQYXRoLCB0ZXh0dXJlUGF0aCwgY2FsbGJhY2tQcm9ncmVzcyApO1xuXG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoIFwiVEhSRUUuQmluYXJ5TG9hZGVyOiBDb3VsZG4ndCBsb2FkIFtcIiArIHVybCArIFwiXSBbXCIgKyB4aHIuc3RhdHVzICsgXCJdXCIgKTtcblxuICAgICAgfVxuXG4gICAgfVxuXG4gIH07XG5cbiAgeGhyLm9wZW4oIFwiR0VUXCIsIHVybCwgdHJ1ZSApO1xuICB4aHIuc2VuZCggbnVsbCApO1xuXG59O1xuXG5USFJFRS5CaW5hcnlMb2FkZXIucHJvdG90eXBlLmxvYWRBamF4QnVmZmVycyA9IGZ1bmN0aW9uICgganNvbiwgY2FsbGJhY2ssIGJpbmFyeVBhdGgsIHRleHR1cmVQYXRoLCBjYWxsYmFja1Byb2dyZXNzICkge1xuXG4gIHZhciBzY29wZSA9IHRoaXM7XG5cbiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLFxuICAgIHVybCA9IGJpbmFyeVBhdGggKyBqc29uLmJ1ZmZlcnM7XG5cbiAgeGhyLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgZnVuY3Rpb24gKCBldmVudCApIHtcblxuICAgIHZhciBidWZmZXIgPSB4aHIucmVzcG9uc2U7XG5cbiAgICBpZiAoIGJ1ZmZlciA9PT0gdW5kZWZpbmVkICkge1xuXG4gICAgICAvLyBJRVdFQkdMIG5lZWRzIHRoaXNcbiAgICAgIGJ1ZmZlciA9ICggbmV3IFVpbnQ4QXJyYXkoIHhoci5yZXNwb25zZUJvZHkgKSApLmJ1ZmZlcjtcblxuICAgIH1cblxuICAgIGlmICggYnVmZmVyLmJ5dGVMZW5ndGggPT0gMCApIHsgIC8vIGlPUyBhbmQgb3RoZXIgWE1MSHR0cFJlcXVlc3QgbGV2ZWwgMVxuXG4gICAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKCB4aHIucmVzcG9uc2VUZXh0Lmxlbmd0aCApO1xuXG4gICAgICB2YXIgYnVmVmlldyA9IG5ldyBVaW50OEFycmF5KCBidWZmZXIgKTtcblxuICAgICAgZm9yICggdmFyIGkgPSAwLCBsID0geGhyLnJlc3BvbnNlVGV4dC5sZW5ndGg7IGkgPCBsOyBpICsrICkge1xuXG4gICAgICAgIGJ1ZlZpZXdbIGkgXSA9IHhoci5yZXNwb25zZVRleHQuY2hhckNvZGVBdCggaSApICYgMHhmZjtcblxuICAgICAgfVxuXG4gICAgfVxuXG4gICAgc2NvcGUuY3JlYXRlQmluTW9kZWwoIGJ1ZmZlciwgY2FsbGJhY2ssIHRleHR1cmVQYXRoLCBqc29uLm1hdGVyaWFscyApO1xuXG4gIH0sIGZhbHNlICk7XG5cbiAgaWYgKCBjYWxsYmFja1Byb2dyZXNzICE9PSB1bmRlZmluZWQgKSB7XG5cbiAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lciggJ3Byb2dyZXNzJywgZnVuY3Rpb24gKCBldmVudCApIHtcblxuICAgICAgaWYgKCBldmVudC5sZW5ndGhDb21wdXRhYmxlICkge1xuXG4gICAgICAgIGNhbGxiYWNrUHJvZ3Jlc3MoIGV2ZW50ICk7XG5cbiAgICAgIH1cblxuICAgIH0sIGZhbHNlICk7XG5cbiAgfVxuXG4gIHhoci5hZGRFdmVudExpc3RlbmVyKCAnZXJyb3InLCBmdW5jdGlvbiAoIGV2ZW50ICkge1xuXG4gICAgY29uc29sZS5lcnJvciggXCJUSFJFRS5CaW5hcnlMb2FkZXI6IENvdWxkbid0IGxvYWQgW1wiICsgdXJsICsgXCJdIFtcIiArIHhoci5zdGF0dXMgKyBcIl1cIiApO1xuXG4gIH0sIGZhbHNlICk7XG5cblxuICB4aHIub3BlbiggXCJHRVRcIiwgdXJsLCB0cnVlICk7XG4gIHhoci5yZXNwb25zZVR5cGUgPSBcImFycmF5YnVmZmVyXCI7XG4gIGlmICggeGhyLm92ZXJyaWRlTWltZVR5cGUgKSB4aHIub3ZlcnJpZGVNaW1lVHlwZSggXCJ0ZXh0L3BsYWluOyBjaGFyc2V0PXgtdXNlci1kZWZpbmVkXCIgKTtcbiAgeGhyLnNlbmQoIG51bGwgKTtcblxufTtcblxuLy8gQmluYXJ5IEFKQVggcGFyc2VyXG5cblRIUkVFLkJpbmFyeUxvYWRlci5wcm90b3R5cGUuY3JlYXRlQmluTW9kZWwgPSBmdW5jdGlvbiAoIGRhdGEsIGNhbGxiYWNrLCB0ZXh0dXJlUGF0aCwganNvbk1hdGVyaWFscyApIHtcblxuICB2YXIgTW9kZWwgPSBmdW5jdGlvbiAoIHRleHR1cmVQYXRoICkge1xuXG4gICAgdmFyIHNjb3BlID0gdGhpcyxcbiAgICAgIGN1cnJlbnRPZmZzZXQgPSAwLFxuICAgICAgbWQsXG4gICAgICBub3JtYWxzID0gW10sXG4gICAgICB1dnMgPSBbXSxcbiAgICAgIHN0YXJ0X3RyaV9mbGF0LCBzdGFydF90cmlfc21vb3RoLCBzdGFydF90cmlfZmxhdF91diwgc3RhcnRfdHJpX3Ntb290aF91dixcbiAgICAgIHN0YXJ0X3F1YWRfZmxhdCwgc3RhcnRfcXVhZF9zbW9vdGgsIHN0YXJ0X3F1YWRfZmxhdF91diwgc3RhcnRfcXVhZF9zbW9vdGhfdXYsXG4gICAgICB0cmlfc2l6ZSwgcXVhZF9zaXplLFxuICAgICAgbGVuX3RyaV9mbGF0LCBsZW5fdHJpX3Ntb290aCwgbGVuX3RyaV9mbGF0X3V2LCBsZW5fdHJpX3Ntb290aF91dixcbiAgICAgIGxlbl9xdWFkX2ZsYXQsIGxlbl9xdWFkX3Ntb290aCwgbGVuX3F1YWRfZmxhdF91diwgbGVuX3F1YWRfc21vb3RoX3V2O1xuXG5cbiAgICBUSFJFRS5HZW9tZXRyeS5jYWxsKCB0aGlzICk7XG5cbiAgICBtZCA9IHBhcnNlTWV0YURhdGEoIGRhdGEsIGN1cnJlbnRPZmZzZXQgKTtcblxuICAgIGN1cnJlbnRPZmZzZXQgKz0gbWQuaGVhZGVyX2J5dGVzO1xuLypcbiAgICBtZC52ZXJ0ZXhfaW5kZXhfYnl0ZXMgPSBVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVDtcbiAgICBtZC5tYXRlcmlhbF9pbmRleF9ieXRlcyA9IFVpbnQxNkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UO1xuICAgIG1kLm5vcm1hbF9pbmRleF9ieXRlcyA9IFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UO1xuICAgIG1kLnV2X2luZGV4X2J5dGVzID0gVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7XG4qL1xuICAgIC8vIGJ1ZmZlcnMgc2l6ZXNcblxuICAgIHRyaV9zaXplID0gIG1kLnZlcnRleF9pbmRleF9ieXRlcyAqIDMgKyBtZC5tYXRlcmlhbF9pbmRleF9ieXRlcztcbiAgICBxdWFkX3NpemUgPSBtZC52ZXJ0ZXhfaW5kZXhfYnl0ZXMgKiA0ICsgbWQubWF0ZXJpYWxfaW5kZXhfYnl0ZXM7XG5cbiAgICBsZW5fdHJpX2ZsYXQgICAgICA9IG1kLm50cmlfZmxhdCAgICAgICogKCB0cmlfc2l6ZSApO1xuICAgIGxlbl90cmlfc21vb3RoICAgID0gbWQubnRyaV9zbW9vdGggICAgKiAoIHRyaV9zaXplICsgbWQubm9ybWFsX2luZGV4X2J5dGVzICogMyApO1xuICAgIGxlbl90cmlfZmxhdF91diAgID0gbWQubnRyaV9mbGF0X3V2ICAgKiAoIHRyaV9zaXplICsgbWQudXZfaW5kZXhfYnl0ZXMgKiAzICk7XG4gICAgbGVuX3RyaV9zbW9vdGhfdXYgPSBtZC5udHJpX3Ntb290aF91diAqICggdHJpX3NpemUgKyBtZC5ub3JtYWxfaW5kZXhfYnl0ZXMgKiAzICsgbWQudXZfaW5kZXhfYnl0ZXMgKiAzICk7XG5cbiAgICBsZW5fcXVhZF9mbGF0ICAgICAgPSBtZC5ucXVhZF9mbGF0ICAgICAgKiAoIHF1YWRfc2l6ZSApO1xuICAgIGxlbl9xdWFkX3Ntb290aCAgICA9IG1kLm5xdWFkX3Ntb290aCAgICAqICggcXVhZF9zaXplICsgbWQubm9ybWFsX2luZGV4X2J5dGVzICogNCApO1xuICAgIGxlbl9xdWFkX2ZsYXRfdXYgICA9IG1kLm5xdWFkX2ZsYXRfdXYgICAqICggcXVhZF9zaXplICsgbWQudXZfaW5kZXhfYnl0ZXMgKiA0ICk7XG4gICAgbGVuX3F1YWRfc21vb3RoX3V2ID0gbWQubnF1YWRfc21vb3RoX3V2ICogKCBxdWFkX3NpemUgKyBtZC5ub3JtYWxfaW5kZXhfYnl0ZXMgKiA0ICsgbWQudXZfaW5kZXhfYnl0ZXMgKiA0ICk7XG5cbiAgICAvLyByZWFkIGJ1ZmZlcnNcblxuICAgIGN1cnJlbnRPZmZzZXQgKz0gaW5pdF92ZXJ0aWNlcyggY3VycmVudE9mZnNldCApO1xuXG4gICAgY3VycmVudE9mZnNldCArPSBpbml0X25vcm1hbHMoIGN1cnJlbnRPZmZzZXQgKTtcbiAgICBjdXJyZW50T2Zmc2V0ICs9IGhhbmRsZVBhZGRpbmcoIG1kLm5ub3JtYWxzICogMyApO1xuXG4gICAgY3VycmVudE9mZnNldCArPSBpbml0X3V2cyggY3VycmVudE9mZnNldCApO1xuXG4gICAgc3RhcnRfdHJpX2ZsYXQgICAgPSBjdXJyZW50T2Zmc2V0O1xuICAgIHN0YXJ0X3RyaV9zbW9vdGggICAgPSBzdGFydF90cmlfZmxhdCAgICArIGxlbl90cmlfZmxhdCAgICArIGhhbmRsZVBhZGRpbmcoIG1kLm50cmlfZmxhdCAqIDIgKTtcbiAgICBzdGFydF90cmlfZmxhdF91diAgID0gc3RhcnRfdHJpX3Ntb290aCAgKyBsZW5fdHJpX3Ntb290aCAgKyBoYW5kbGVQYWRkaW5nKCBtZC5udHJpX3Ntb290aCAqIDIgKTtcbiAgICBzdGFydF90cmlfc21vb3RoX3V2ID0gc3RhcnRfdHJpX2ZsYXRfdXYgKyBsZW5fdHJpX2ZsYXRfdXYgKyBoYW5kbGVQYWRkaW5nKCBtZC5udHJpX2ZsYXRfdXYgKiAyICk7XG5cbiAgICBzdGFydF9xdWFkX2ZsYXQgICAgID0gc3RhcnRfdHJpX3Ntb290aF91diArIGxlbl90cmlfc21vb3RoX3V2ICArIGhhbmRsZVBhZGRpbmcoIG1kLm50cmlfc21vb3RoX3V2ICogMiApO1xuICAgIHN0YXJ0X3F1YWRfc21vb3RoICAgPSBzdGFydF9xdWFkX2ZsYXQgICAgICsgbGVuX3F1YWRfZmxhdCAgICArIGhhbmRsZVBhZGRpbmcoIG1kLm5xdWFkX2ZsYXQgKiAyICk7XG4gICAgc3RhcnRfcXVhZF9mbGF0X3V2ICA9IHN0YXJ0X3F1YWRfc21vb3RoICAgKyBsZW5fcXVhZF9zbW9vdGggICAgKyBoYW5kbGVQYWRkaW5nKCBtZC5ucXVhZF9zbW9vdGggKiAyICk7XG4gICAgc3RhcnRfcXVhZF9zbW9vdGhfdXY9IHN0YXJ0X3F1YWRfZmxhdF91diAgKyBsZW5fcXVhZF9mbGF0X3V2ICAgKyBoYW5kbGVQYWRkaW5nKCBtZC5ucXVhZF9mbGF0X3V2ICogMiApO1xuXG4gICAgLy8gaGF2ZSB0byBmaXJzdCBwcm9jZXNzIGZhY2VzIHdpdGggdXZzXG4gICAgLy8gc28gdGhhdCBmYWNlIGFuZCB1diBpbmRpY2VzIG1hdGNoXG5cbiAgICBpbml0X3RyaWFuZ2xlc19mbGF0X3V2KCBzdGFydF90cmlfZmxhdF91diApO1xuICAgIGluaXRfdHJpYW5nbGVzX3Ntb290aF91diggc3RhcnRfdHJpX3Ntb290aF91diApO1xuXG4gICAgaW5pdF9xdWFkc19mbGF0X3V2KCBzdGFydF9xdWFkX2ZsYXRfdXYgKTtcbiAgICBpbml0X3F1YWRzX3Ntb290aF91diggc3RhcnRfcXVhZF9zbW9vdGhfdXYgKTtcblxuICAgIC8vIG5vdyB3ZSBjYW4gcHJvY2VzcyB1bnRleHR1cmVkIGZhY2VzXG5cbiAgICBpbml0X3RyaWFuZ2xlc19mbGF0KCBzdGFydF90cmlfZmxhdCApO1xuICAgIGluaXRfdHJpYW5nbGVzX3Ntb290aCggc3RhcnRfdHJpX3Ntb290aCApO1xuXG4gICAgaW5pdF9xdWFkc19mbGF0KCBzdGFydF9xdWFkX2ZsYXQgKTtcbiAgICBpbml0X3F1YWRzX3Ntb290aCggc3RhcnRfcXVhZF9zbW9vdGggKTtcblxuICAgIHRoaXMuY29tcHV0ZUZhY2VOb3JtYWxzKCk7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVQYWRkaW5nKCBuICkge1xuXG4gICAgICByZXR1cm4gKCBuICUgNCApID8gKCA0IC0gbiAlIDQgKSA6IDA7XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gcGFyc2VNZXRhRGF0YSggZGF0YSwgb2Zmc2V0ICkge1xuXG4gICAgICB2YXIgbWV0YURhdGEgPSB7XG5cbiAgICAgICAgJ3NpZ25hdHVyZScgICAgICAgICAgICAgICA6cGFyc2VTdHJpbmcoIGRhdGEsIG9mZnNldCwgIDEyICksXG4gICAgICAgICdoZWFkZXJfYnl0ZXMnICAgICAgICAgICAgOnBhcnNlVUNoYXI4KCBkYXRhLCBvZmZzZXQgKyAxMiApLFxuXG4gICAgICAgICd2ZXJ0ZXhfY29vcmRpbmF0ZV9ieXRlcycgOnBhcnNlVUNoYXI4KCBkYXRhLCBvZmZzZXQgKyAxMyApLFxuICAgICAgICAnbm9ybWFsX2Nvb3JkaW5hdGVfYnl0ZXMnIDpwYXJzZVVDaGFyOCggZGF0YSwgb2Zmc2V0ICsgMTQgKSxcbiAgICAgICAgJ3V2X2Nvb3JkaW5hdGVfYnl0ZXMnICAgICA6cGFyc2VVQ2hhcjgoIGRhdGEsIG9mZnNldCArIDE1ICksXG5cbiAgICAgICAgJ3ZlcnRleF9pbmRleF9ieXRlcycgICAgICA6cGFyc2VVQ2hhcjgoIGRhdGEsIG9mZnNldCArIDE2ICksXG4gICAgICAgICdub3JtYWxfaW5kZXhfYnl0ZXMnICAgICAgOnBhcnNlVUNoYXI4KCBkYXRhLCBvZmZzZXQgKyAxNyApLFxuICAgICAgICAndXZfaW5kZXhfYnl0ZXMnICAgICAgICAgIDpwYXJzZVVDaGFyOCggZGF0YSwgb2Zmc2V0ICsgMTggKSxcbiAgICAgICAgJ21hdGVyaWFsX2luZGV4X2J5dGVzJyAgICA6cGFyc2VVQ2hhcjgoIGRhdGEsIG9mZnNldCArIDE5ICksXG5cbiAgICAgICAgJ252ZXJ0aWNlcycgICAgOnBhcnNlVUludDMyKCBkYXRhLCBvZmZzZXQgKyAyMCApLFxuICAgICAgICAnbm5vcm1hbHMnICAgICA6cGFyc2VVSW50MzIoIGRhdGEsIG9mZnNldCArIDIwICsgNCoxICksXG4gICAgICAgICdudXZzJyAgICAgICAgIDpwYXJzZVVJbnQzMiggZGF0YSwgb2Zmc2V0ICsgMjAgKyA0KjIgKSxcblxuICAgICAgICAnbnRyaV9mbGF0JyAgICAgIDpwYXJzZVVJbnQzMiggZGF0YSwgb2Zmc2V0ICsgMjAgKyA0KjMgKSxcbiAgICAgICAgJ250cmlfc21vb3RoJyAgICA6cGFyc2VVSW50MzIoIGRhdGEsIG9mZnNldCArIDIwICsgNCo0ICksXG4gICAgICAgICdudHJpX2ZsYXRfdXYnICAgOnBhcnNlVUludDMyKCBkYXRhLCBvZmZzZXQgKyAyMCArIDQqNSApLFxuICAgICAgICAnbnRyaV9zbW9vdGhfdXYnIDpwYXJzZVVJbnQzMiggZGF0YSwgb2Zmc2V0ICsgMjAgKyA0KjYgKSxcblxuICAgICAgICAnbnF1YWRfZmxhdCcgICAgICA6cGFyc2VVSW50MzIoIGRhdGEsIG9mZnNldCArIDIwICsgNCo3ICksXG4gICAgICAgICducXVhZF9zbW9vdGgnICAgIDpwYXJzZVVJbnQzMiggZGF0YSwgb2Zmc2V0ICsgMjAgKyA0KjggKSxcbiAgICAgICAgJ25xdWFkX2ZsYXRfdXYnICAgOnBhcnNlVUludDMyKCBkYXRhLCBvZmZzZXQgKyAyMCArIDQqOSApLFxuICAgICAgICAnbnF1YWRfc21vb3RoX3V2JyA6cGFyc2VVSW50MzIoIGRhdGEsIG9mZnNldCArIDIwICsgNCoxMCApXG5cbiAgICAgIH07XG4vKlxuICAgICAgY29uc29sZS5sb2coIFwic2lnbmF0dXJlOiBcIiArIG1ldGFEYXRhLnNpZ25hdHVyZSApO1xuXG4gICAgICBjb25zb2xlLmxvZyggXCJoZWFkZXJfYnl0ZXM6IFwiICsgbWV0YURhdGEuaGVhZGVyX2J5dGVzICk7XG4gICAgICBjb25zb2xlLmxvZyggXCJ2ZXJ0ZXhfY29vcmRpbmF0ZV9ieXRlczogXCIgKyBtZXRhRGF0YS52ZXJ0ZXhfY29vcmRpbmF0ZV9ieXRlcyApO1xuICAgICAgY29uc29sZS5sb2coIFwibm9ybWFsX2Nvb3JkaW5hdGVfYnl0ZXM6IFwiICsgbWV0YURhdGEubm9ybWFsX2Nvb3JkaW5hdGVfYnl0ZXMgKTtcbiAgICAgIGNvbnNvbGUubG9nKCBcInV2X2Nvb3JkaW5hdGVfYnl0ZXM6IFwiICsgbWV0YURhdGEudXZfY29vcmRpbmF0ZV9ieXRlcyApO1xuXG4gICAgICBjb25zb2xlLmxvZyggXCJ2ZXJ0ZXhfaW5kZXhfYnl0ZXM6IFwiICsgbWV0YURhdGEudmVydGV4X2luZGV4X2J5dGVzICk7XG4gICAgICBjb25zb2xlLmxvZyggXCJub3JtYWxfaW5kZXhfYnl0ZXM6IFwiICsgbWV0YURhdGEubm9ybWFsX2luZGV4X2J5dGVzICk7XG4gICAgICBjb25zb2xlLmxvZyggXCJ1dl9pbmRleF9ieXRlczogXCIgKyBtZXRhRGF0YS51dl9pbmRleF9ieXRlcyApO1xuICAgICAgY29uc29sZS5sb2coIFwibWF0ZXJpYWxfaW5kZXhfYnl0ZXM6IFwiICsgbWV0YURhdGEubWF0ZXJpYWxfaW5kZXhfYnl0ZXMgKTtcblxuICAgICAgY29uc29sZS5sb2coIFwibnZlcnRpY2VzOiBcIiArIG1ldGFEYXRhLm52ZXJ0aWNlcyApO1xuICAgICAgY29uc29sZS5sb2coIFwibm5vcm1hbHM6IFwiICsgbWV0YURhdGEubm5vcm1hbHMgKTtcbiAgICAgIGNvbnNvbGUubG9nKCBcIm51dnM6IFwiICsgbWV0YURhdGEubnV2cyApO1xuXG4gICAgICBjb25zb2xlLmxvZyggXCJudHJpX2ZsYXQ6IFwiICsgbWV0YURhdGEubnRyaV9mbGF0ICk7XG4gICAgICBjb25zb2xlLmxvZyggXCJudHJpX3Ntb290aDogXCIgKyBtZXRhRGF0YS5udHJpX3Ntb290aCApO1xuICAgICAgY29uc29sZS5sb2coIFwibnRyaV9mbGF0X3V2OiBcIiArIG1ldGFEYXRhLm50cmlfZmxhdF91diApO1xuICAgICAgY29uc29sZS5sb2coIFwibnRyaV9zbW9vdGhfdXY6IFwiICsgbWV0YURhdGEubnRyaV9zbW9vdGhfdXYgKTtcblxuICAgICAgY29uc29sZS5sb2coIFwibnF1YWRfZmxhdDogXCIgKyBtZXRhRGF0YS5ucXVhZF9mbGF0ICk7XG4gICAgICBjb25zb2xlLmxvZyggXCJucXVhZF9zbW9vdGg6IFwiICsgbWV0YURhdGEubnF1YWRfc21vb3RoICk7XG4gICAgICBjb25zb2xlLmxvZyggXCJucXVhZF9mbGF0X3V2OiBcIiArIG1ldGFEYXRhLm5xdWFkX2ZsYXRfdXYgKTtcbiAgICAgIGNvbnNvbGUubG9nKCBcIm5xdWFkX3Ntb290aF91djogXCIgKyBtZXRhRGF0YS5ucXVhZF9zbW9vdGhfdXYgKTtcblxuICAgICAgdmFyIHRvdGFsID0gbWV0YURhdGEuaGVhZGVyX2J5dGVzXG4gICAgICAgICAgICArIG1ldGFEYXRhLm52ZXJ0aWNlcyAqIG1ldGFEYXRhLnZlcnRleF9jb29yZGluYXRlX2J5dGVzICogM1xuICAgICAgICAgICAgKyBtZXRhRGF0YS5ubm9ybWFscyAqIG1ldGFEYXRhLm5vcm1hbF9jb29yZGluYXRlX2J5dGVzICogM1xuICAgICAgICAgICAgKyBtZXRhRGF0YS5udXZzICogbWV0YURhdGEudXZfY29vcmRpbmF0ZV9ieXRlcyAqIDJcbiAgICAgICAgICAgICsgbWV0YURhdGEubnRyaV9mbGF0ICogKCBtZXRhRGF0YS52ZXJ0ZXhfaW5kZXhfYnl0ZXMqMyArIG1ldGFEYXRhLm1hdGVyaWFsX2luZGV4X2J5dGVzIClcbiAgICAgICAgICAgICsgbWV0YURhdGEubnRyaV9zbW9vdGggKiAoIG1ldGFEYXRhLnZlcnRleF9pbmRleF9ieXRlcyozICsgbWV0YURhdGEubWF0ZXJpYWxfaW5kZXhfYnl0ZXMgKyBtZXRhRGF0YS5ub3JtYWxfaW5kZXhfYnl0ZXMqMyApXG4gICAgICAgICAgICArIG1ldGFEYXRhLm50cmlfZmxhdF91diAqICggbWV0YURhdGEudmVydGV4X2luZGV4X2J5dGVzKjMgKyBtZXRhRGF0YS5tYXRlcmlhbF9pbmRleF9ieXRlcyArIG1ldGFEYXRhLnV2X2luZGV4X2J5dGVzKjMgKVxuICAgICAgICAgICAgKyBtZXRhRGF0YS5udHJpX3Ntb290aF91diAqICggbWV0YURhdGEudmVydGV4X2luZGV4X2J5dGVzKjMgKyBtZXRhRGF0YS5tYXRlcmlhbF9pbmRleF9ieXRlcyArIG1ldGFEYXRhLm5vcm1hbF9pbmRleF9ieXRlcyozICsgbWV0YURhdGEudXZfaW5kZXhfYnl0ZXMqMyApXG4gICAgICAgICAgICArIG1ldGFEYXRhLm5xdWFkX2ZsYXQgKiAoIG1ldGFEYXRhLnZlcnRleF9pbmRleF9ieXRlcyo0ICsgbWV0YURhdGEubWF0ZXJpYWxfaW5kZXhfYnl0ZXMgKVxuICAgICAgICAgICAgKyBtZXRhRGF0YS5ucXVhZF9zbW9vdGggKiAoIG1ldGFEYXRhLnZlcnRleF9pbmRleF9ieXRlcyo0ICsgbWV0YURhdGEubWF0ZXJpYWxfaW5kZXhfYnl0ZXMgKyBtZXRhRGF0YS5ub3JtYWxfaW5kZXhfYnl0ZXMqNCApXG4gICAgICAgICAgICArIG1ldGFEYXRhLm5xdWFkX2ZsYXRfdXYgKiAoIG1ldGFEYXRhLnZlcnRleF9pbmRleF9ieXRlcyo0ICsgbWV0YURhdGEubWF0ZXJpYWxfaW5kZXhfYnl0ZXMgKyBtZXRhRGF0YS51dl9pbmRleF9ieXRlcyo0IClcbiAgICAgICAgICAgICsgbWV0YURhdGEubnF1YWRfc21vb3RoX3V2ICogKCBtZXRhRGF0YS52ZXJ0ZXhfaW5kZXhfYnl0ZXMqNCArIG1ldGFEYXRhLm1hdGVyaWFsX2luZGV4X2J5dGVzICsgbWV0YURhdGEubm9ybWFsX2luZGV4X2J5dGVzKjQgKyBtZXRhRGF0YS51dl9pbmRleF9ieXRlcyo0ICk7XG4gICAgICBjb25zb2xlLmxvZyggXCJ0b3RhbCBieXRlczogXCIgKyB0b3RhbCApO1xuKi9cblxuICAgICAgcmV0dXJuIG1ldGFEYXRhO1xuXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHBhcnNlU3RyaW5nKCBkYXRhLCBvZmZzZXQsIGxlbmd0aCApIHtcblxuICAgICAgdmFyIGNoYXJBcnJheSA9IG5ldyBVaW50OEFycmF5KCBkYXRhLCBvZmZzZXQsIGxlbmd0aCApO1xuXG4gICAgICB2YXIgdGV4dCA9IFwiXCI7XG5cbiAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSArKyApIHtcblxuICAgICAgICB0ZXh0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoIGNoYXJBcnJheVsgb2Zmc2V0ICsgaSBdICk7XG5cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRleHQ7XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gcGFyc2VVQ2hhcjgoIGRhdGEsIG9mZnNldCApIHtcblxuICAgICAgdmFyIGNoYXJBcnJheSA9IG5ldyBVaW50OEFycmF5KCBkYXRhLCBvZmZzZXQsIDEgKTtcblxuICAgICAgcmV0dXJuIGNoYXJBcnJheVsgMCBdO1xuXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHBhcnNlVUludDMyKCBkYXRhLCBvZmZzZXQgKSB7XG5cbiAgICAgIHZhciBpbnRBcnJheSA9IG5ldyBVaW50MzJBcnJheSggZGF0YSwgb2Zmc2V0LCAxICk7XG5cbiAgICAgIHJldHVybiBpbnRBcnJheVsgMCBdO1xuXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGluaXRfdmVydGljZXMoIHN0YXJ0ICkge1xuXG4gICAgICB2YXIgbkVsZW1lbnRzID0gbWQubnZlcnRpY2VzO1xuXG4gICAgICB2YXIgY29vcmRBcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIGRhdGEsIHN0YXJ0LCBuRWxlbWVudHMgKiAzICk7XG5cbiAgICAgIHZhciBpLCB4LCB5LCB6O1xuXG4gICAgICBmb3IoIGkgPSAwOyBpIDwgbkVsZW1lbnRzOyBpICsrICkge1xuXG4gICAgICAgIHggPSBjb29yZEFycmF5WyBpICogMyBdO1xuICAgICAgICB5ID0gY29vcmRBcnJheVsgaSAqIDMgKyAxIF07XG4gICAgICAgIHogPSBjb29yZEFycmF5WyBpICogMyArIDIgXTtcblxuICAgICAgICBzY29wZS52ZXJ0aWNlcy5wdXNoKCBuZXcgVEhSRUUuVmVjdG9yMyggeCwgeSwgeiApICk7XG5cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5FbGVtZW50cyAqIDMgKiBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdF9ub3JtYWxzKCBzdGFydCApIHtcblxuICAgICAgdmFyIG5FbGVtZW50cyA9IG1kLm5ub3JtYWxzO1xuXG4gICAgICBpZiAoIG5FbGVtZW50cyApIHtcblxuICAgICAgICB2YXIgbm9ybWFsQXJyYXkgPSBuZXcgSW50OEFycmF5KCBkYXRhLCBzdGFydCwgbkVsZW1lbnRzICogMyApO1xuXG4gICAgICAgIHZhciBpLCB4LCB5LCB6O1xuXG4gICAgICAgIGZvciggaSA9IDA7IGkgPCBuRWxlbWVudHM7IGkgKysgKSB7XG5cbiAgICAgICAgICB4ID0gbm9ybWFsQXJyYXlbIGkgKiAzIF07XG4gICAgICAgICAgeSA9IG5vcm1hbEFycmF5WyBpICogMyArIDEgXTtcbiAgICAgICAgICB6ID0gbm9ybWFsQXJyYXlbIGkgKiAzICsgMiBdO1xuXG4gICAgICAgICAgbm9ybWFscy5wdXNoKCB4LzEyNywgeS8xMjcsIHovMTI3ICk7XG5cbiAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBuRWxlbWVudHMgKiAzICogSW50OEFycmF5LkJZVEVTX1BFUl9FTEVNRU5UO1xuXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGluaXRfdXZzKCBzdGFydCApIHtcblxuICAgICAgdmFyIG5FbGVtZW50cyA9IG1kLm51dnM7XG5cbiAgICAgIGlmICggbkVsZW1lbnRzICkge1xuXG4gICAgICAgIHZhciB1dkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggZGF0YSwgc3RhcnQsIG5FbGVtZW50cyAqIDIgKTtcblxuICAgICAgICB2YXIgaSwgdSwgdjtcblxuICAgICAgICBmb3IoIGkgPSAwOyBpIDwgbkVsZW1lbnRzOyBpICsrICkge1xuXG4gICAgICAgICAgdSA9IHV2QXJyYXlbIGkgKiAyIF07XG4gICAgICAgICAgdiA9IHV2QXJyYXlbIGkgKiAyICsgMSBdO1xuXG4gICAgICAgICAgdXZzLnB1c2goIHUsIHYgKTtcblxuICAgICAgICB9XG5cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5FbGVtZW50cyAqIDIgKiBGbG9hdDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQ7XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdF91dnMzKCBuRWxlbWVudHMsIG9mZnNldCApIHtcblxuICAgICAgdmFyIGksIHV2YSwgdXZiLCB1dmMsIHUxLCB1MiwgdTMsIHYxLCB2MiwgdjM7XG5cbiAgICAgIHZhciB1dkluZGV4QnVmZmVyID0gbmV3IFVpbnQzMkFycmF5KCBkYXRhLCBvZmZzZXQsIDMgKiBuRWxlbWVudHMgKTtcblxuICAgICAgZm9yKCBpID0gMDsgaSA8IG5FbGVtZW50czsgaSArKyApIHtcblxuICAgICAgICB1dmEgPSB1dkluZGV4QnVmZmVyWyBpICogMyBdO1xuICAgICAgICB1dmIgPSB1dkluZGV4QnVmZmVyWyBpICogMyArIDEgXTtcbiAgICAgICAgdXZjID0gdXZJbmRleEJ1ZmZlclsgaSAqIDMgKyAyIF07XG5cbiAgICAgICAgdTEgPSB1dnNbIHV2YSoyIF07XG4gICAgICAgIHYxID0gdXZzWyB1dmEqMiArIDEgXTtcblxuICAgICAgICB1MiA9IHV2c1sgdXZiKjIgXTtcbiAgICAgICAgdjIgPSB1dnNbIHV2YioyICsgMSBdO1xuXG4gICAgICAgIHUzID0gdXZzWyB1dmMqMiBdO1xuICAgICAgICB2MyA9IHV2c1sgdXZjKjIgKyAxIF07XG5cbiAgICAgICAgc2NvcGUuZmFjZVZlcnRleFV2c1sgMCBdLnB1c2goIFtcbiAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMiggdTEsIHYxICksXG4gICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoIHUyLCB2MiApLFxuICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKCB1MywgdjMgKVxuICAgICAgICBdICk7XG5cbiAgICAgIH1cblxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBpbml0X3V2czQoIG5FbGVtZW50cywgb2Zmc2V0ICkge1xuXG4gICAgICB2YXIgaSwgdXZhLCB1dmIsIHV2YywgdXZkLCB1MSwgdTIsIHUzLCB1NCwgdjEsIHYyLCB2MywgdjQ7XG5cbiAgICAgIHZhciB1dkluZGV4QnVmZmVyID0gbmV3IFVpbnQzMkFycmF5KCBkYXRhLCBvZmZzZXQsIDQgKiBuRWxlbWVudHMgKTtcblxuICAgICAgZm9yKCBpID0gMDsgaSA8IG5FbGVtZW50czsgaSArKyApIHtcblxuICAgICAgICB1dmEgPSB1dkluZGV4QnVmZmVyWyBpICogNCBdO1xuICAgICAgICB1dmIgPSB1dkluZGV4QnVmZmVyWyBpICogNCArIDEgXTtcbiAgICAgICAgdXZjID0gdXZJbmRleEJ1ZmZlclsgaSAqIDQgKyAyIF07XG4gICAgICAgIHV2ZCA9IHV2SW5kZXhCdWZmZXJbIGkgKiA0ICsgMyBdO1xuXG4gICAgICAgIHUxID0gdXZzWyB1dmEqMiBdO1xuICAgICAgICB2MSA9IHV2c1sgdXZhKjIgKyAxIF07XG5cbiAgICAgICAgdTIgPSB1dnNbIHV2YioyIF07XG4gICAgICAgIHYyID0gdXZzWyB1dmIqMiArIDEgXTtcblxuICAgICAgICB1MyA9IHV2c1sgdXZjKjIgXTtcbiAgICAgICAgdjMgPSB1dnNbIHV2YyoyICsgMSBdO1xuXG4gICAgICAgIHU0ID0gdXZzWyB1dmQqMiBdO1xuICAgICAgICB2NCA9IHV2c1sgdXZkKjIgKyAxIF07XG5cbiAgICAgICAgc2NvcGUuZmFjZVZlcnRleFV2c1sgMCBdLnB1c2goIFtcbiAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMiggdTEsIHYxICksXG4gICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoIHUyLCB2MiApLFxuICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKCB1NCwgdjQgKVxuICAgICAgICBdICk7XG5cbiAgICAgICAgc2NvcGUuZmFjZVZlcnRleFV2c1sgMCBdLnB1c2goIFtcbiAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMiggdTIsIHYyICksXG4gICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjIoIHUzLCB2MyApLFxuICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IyKCB1NCwgdjQgKVxuICAgICAgICBdICk7XG5cbiAgICAgIH1cblxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBpbml0X2ZhY2VzM19mbGF0KCBuRWxlbWVudHMsIG9mZnNldFZlcnRpY2VzLCBvZmZzZXRNYXRlcmlhbHMgKSB7XG5cbiAgICAgIHZhciBpLCBhLCBiLCBjLCBtO1xuXG4gICAgICB2YXIgdmVydGV4SW5kZXhCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoIGRhdGEsIG9mZnNldFZlcnRpY2VzLCAzICogbkVsZW1lbnRzICk7XG4gICAgICB2YXIgbWF0ZXJpYWxJbmRleEJ1ZmZlciA9IG5ldyBVaW50MTZBcnJheSggZGF0YSwgb2Zmc2V0TWF0ZXJpYWxzLCBuRWxlbWVudHMgKTtcblxuICAgICAgZm9yKCBpID0gMDsgaSA8IG5FbGVtZW50czsgaSArKyApIHtcblxuICAgICAgICBhID0gdmVydGV4SW5kZXhCdWZmZXJbIGkgKiAzIF07XG4gICAgICAgIGIgPSB2ZXJ0ZXhJbmRleEJ1ZmZlclsgaSAqIDMgKyAxIF07XG4gICAgICAgIGMgPSB2ZXJ0ZXhJbmRleEJ1ZmZlclsgaSAqIDMgKyAyIF07XG5cbiAgICAgICAgbSA9IG1hdGVyaWFsSW5kZXhCdWZmZXJbIGkgXTtcblxuICAgICAgICBzY29wZS5mYWNlcy5wdXNoKCBuZXcgVEhSRUUuRmFjZTMoIGEsIGIsIGMsIG51bGwsIG51bGwsIG0gKSApO1xuXG4gICAgICB9XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdF9mYWNlczRfZmxhdCggbkVsZW1lbnRzLCBvZmZzZXRWZXJ0aWNlcywgb2Zmc2V0TWF0ZXJpYWxzICkge1xuXG4gICAgICB2YXIgaSwgYSwgYiwgYywgZCwgbTtcblxuICAgICAgdmFyIHZlcnRleEluZGV4QnVmZmVyID0gbmV3IFVpbnQzMkFycmF5KCBkYXRhLCBvZmZzZXRWZXJ0aWNlcywgNCAqIG5FbGVtZW50cyApO1xuICAgICAgdmFyIG1hdGVyaWFsSW5kZXhCdWZmZXIgPSBuZXcgVWludDE2QXJyYXkoIGRhdGEsIG9mZnNldE1hdGVyaWFscywgbkVsZW1lbnRzICk7XG5cbiAgICAgIGZvciggaSA9IDA7IGkgPCBuRWxlbWVudHM7IGkgKysgKSB7XG5cbiAgICAgICAgYSA9IHZlcnRleEluZGV4QnVmZmVyWyBpICogNCBdO1xuICAgICAgICBiID0gdmVydGV4SW5kZXhCdWZmZXJbIGkgKiA0ICsgMSBdO1xuICAgICAgICBjID0gdmVydGV4SW5kZXhCdWZmZXJbIGkgKiA0ICsgMiBdO1xuICAgICAgICBkID0gdmVydGV4SW5kZXhCdWZmZXJbIGkgKiA0ICsgMyBdO1xuXG4gICAgICAgIG0gPSBtYXRlcmlhbEluZGV4QnVmZmVyWyBpIF07XG5cbiAgICAgICAgc2NvcGUuZmFjZXMucHVzaCggbmV3IFRIUkVFLkZhY2UzKCBhLCBiLCBkLCBudWxsLCBudWxsLCBtICkgKTtcbiAgICAgICAgc2NvcGUuZmFjZXMucHVzaCggbmV3IFRIUkVFLkZhY2UzKCBiLCBjLCBkLCBudWxsLCBudWxsLCBtICkgKTtcblxuICAgICAgfVxuXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGluaXRfZmFjZXMzX3Ntb290aCggbkVsZW1lbnRzLCBvZmZzZXRWZXJ0aWNlcywgb2Zmc2V0Tm9ybWFscywgb2Zmc2V0TWF0ZXJpYWxzICkge1xuXG4gICAgICB2YXIgaSwgYSwgYiwgYywgbTtcbiAgICAgIHZhciBuYSwgbmIsIG5jO1xuXG4gICAgICB2YXIgdmVydGV4SW5kZXhCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoIGRhdGEsIG9mZnNldFZlcnRpY2VzLCAzICogbkVsZW1lbnRzICk7XG4gICAgICB2YXIgbm9ybWFsSW5kZXhCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoIGRhdGEsIG9mZnNldE5vcm1hbHMsIDMgKiBuRWxlbWVudHMgKTtcbiAgICAgIHZhciBtYXRlcmlhbEluZGV4QnVmZmVyID0gbmV3IFVpbnQxNkFycmF5KCBkYXRhLCBvZmZzZXRNYXRlcmlhbHMsIG5FbGVtZW50cyApO1xuXG4gICAgICBmb3IoIGkgPSAwOyBpIDwgbkVsZW1lbnRzOyBpICsrICkge1xuXG4gICAgICAgIGEgPSB2ZXJ0ZXhJbmRleEJ1ZmZlclsgaSAqIDMgXTtcbiAgICAgICAgYiA9IHZlcnRleEluZGV4QnVmZmVyWyBpICogMyArIDEgXTtcbiAgICAgICAgYyA9IHZlcnRleEluZGV4QnVmZmVyWyBpICogMyArIDIgXTtcblxuICAgICAgICBuYSA9IG5vcm1hbEluZGV4QnVmZmVyWyBpICogMyBdO1xuICAgICAgICBuYiA9IG5vcm1hbEluZGV4QnVmZmVyWyBpICogMyArIDEgXTtcbiAgICAgICAgbmMgPSBub3JtYWxJbmRleEJ1ZmZlclsgaSAqIDMgKyAyIF07XG5cbiAgICAgICAgbSA9IG1hdGVyaWFsSW5kZXhCdWZmZXJbIGkgXTtcblxuICAgICAgICB2YXIgbmF4ID0gbm9ybWFsc1sgbmEqMyAgICAgXSxcbiAgICAgICAgICBuYXkgPSBub3JtYWxzWyBuYSozICsgMSBdLFxuICAgICAgICAgIG5heiA9IG5vcm1hbHNbIG5hKjMgKyAyIF0sXG5cbiAgICAgICAgICBuYnggPSBub3JtYWxzWyBuYiozICAgICBdLFxuICAgICAgICAgIG5ieSA9IG5vcm1hbHNbIG5iKjMgKyAxIF0sXG4gICAgICAgICAgbmJ6ID0gbm9ybWFsc1sgbmIqMyArIDIgXSxcblxuICAgICAgICAgIG5jeCA9IG5vcm1hbHNbIG5jKjMgICAgIF0sXG4gICAgICAgICAgbmN5ID0gbm9ybWFsc1sgbmMqMyArIDEgXSxcbiAgICAgICAgICBuY3ogPSBub3JtYWxzWyBuYyozICsgMiBdO1xuXG4gICAgICAgIHNjb3BlLmZhY2VzLnB1c2goIG5ldyBUSFJFRS5GYWNlMyggYSwgYiwgYywgW1xuICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKCBuYXgsIG5heSwgbmF6ICksXG4gICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoIG5ieCwgbmJ5LCBuYnogKSxcbiAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyggbmN4LCBuY3ksIG5jeiApXG4gICAgICAgIF0sIG51bGwsIG0gKSApO1xuXG4gICAgICB9XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdF9mYWNlczRfc21vb3RoKCBuRWxlbWVudHMsIG9mZnNldFZlcnRpY2VzLCBvZmZzZXROb3JtYWxzLCBvZmZzZXRNYXRlcmlhbHMgKSB7XG5cbiAgICAgIHZhciBpLCBhLCBiLCBjLCBkLCBtO1xuICAgICAgdmFyIG5hLCBuYiwgbmMsIG5kO1xuXG4gICAgICB2YXIgdmVydGV4SW5kZXhCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoIGRhdGEsIG9mZnNldFZlcnRpY2VzLCA0ICogbkVsZW1lbnRzICk7XG4gICAgICB2YXIgbm9ybWFsSW5kZXhCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoIGRhdGEsIG9mZnNldE5vcm1hbHMsIDQgKiBuRWxlbWVudHMgKTtcbiAgICAgIHZhciBtYXRlcmlhbEluZGV4QnVmZmVyID0gbmV3IFVpbnQxNkFycmF5KCBkYXRhLCBvZmZzZXRNYXRlcmlhbHMsIG5FbGVtZW50cyApO1xuXG4gICAgICBmb3IoIGkgPSAwOyBpIDwgbkVsZW1lbnRzOyBpICsrICkge1xuXG4gICAgICAgIGEgPSB2ZXJ0ZXhJbmRleEJ1ZmZlclsgaSAqIDQgXTtcbiAgICAgICAgYiA9IHZlcnRleEluZGV4QnVmZmVyWyBpICogNCArIDEgXTtcbiAgICAgICAgYyA9IHZlcnRleEluZGV4QnVmZmVyWyBpICogNCArIDIgXTtcbiAgICAgICAgZCA9IHZlcnRleEluZGV4QnVmZmVyWyBpICogNCArIDMgXTtcblxuICAgICAgICBuYSA9IG5vcm1hbEluZGV4QnVmZmVyWyBpICogNCBdO1xuICAgICAgICBuYiA9IG5vcm1hbEluZGV4QnVmZmVyWyBpICogNCArIDEgXTtcbiAgICAgICAgbmMgPSBub3JtYWxJbmRleEJ1ZmZlclsgaSAqIDQgKyAyIF07XG4gICAgICAgIG5kID0gbm9ybWFsSW5kZXhCdWZmZXJbIGkgKiA0ICsgMyBdO1xuXG4gICAgICAgIG0gPSBtYXRlcmlhbEluZGV4QnVmZmVyWyBpIF07XG5cbiAgICAgICAgdmFyIG5heCA9IG5vcm1hbHNbIG5hKjMgICAgIF0sXG4gICAgICAgICAgbmF5ID0gbm9ybWFsc1sgbmEqMyArIDEgXSxcbiAgICAgICAgICBuYXogPSBub3JtYWxzWyBuYSozICsgMiBdLFxuXG4gICAgICAgICAgbmJ4ID0gbm9ybWFsc1sgbmIqMyAgICAgXSxcbiAgICAgICAgICBuYnkgPSBub3JtYWxzWyBuYiozICsgMSBdLFxuICAgICAgICAgIG5ieiA9IG5vcm1hbHNbIG5iKjMgKyAyIF0sXG5cbiAgICAgICAgICBuY3ggPSBub3JtYWxzWyBuYyozICAgICBdLFxuICAgICAgICAgIG5jeSA9IG5vcm1hbHNbIG5jKjMgKyAxIF0sXG4gICAgICAgICAgbmN6ID0gbm9ybWFsc1sgbmMqMyArIDIgXSxcblxuICAgICAgICAgIG5keCA9IG5vcm1hbHNbIG5kKjMgICAgIF0sXG4gICAgICAgICAgbmR5ID0gbm9ybWFsc1sgbmQqMyArIDEgXSxcbiAgICAgICAgICBuZHogPSBub3JtYWxzWyBuZCozICsgMiBdO1xuXG4gICAgICAgIHNjb3BlLmZhY2VzLnB1c2goIG5ldyBUSFJFRS5GYWNlMyggYSwgYiwgZCwgW1xuICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKCBuYXgsIG5heSwgbmF6ICksXG4gICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoIG5ieCwgbmJ5LCBuYnogKSxcbiAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyggbmR4LCBuZHksIG5keiApXG4gICAgICAgIF0sIG51bGwsIG0gKSApO1xuXG4gICAgICAgIHNjb3BlLmZhY2VzLnB1c2goIG5ldyBUSFJFRS5GYWNlMyggYiwgYywgZCwgW1xuICAgICAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKCBuYngsIG5ieSwgbmJ6ICksXG4gICAgICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoIG5jeCwgbmN5LCBuY3ogKSxcbiAgICAgICAgICBuZXcgVEhSRUUuVmVjdG9yMyggbmR4LCBuZHksIG5keiApXG4gICAgICAgIF0sIG51bGwsIG0gKSApO1xuXG4gICAgICB9XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdF90cmlhbmdsZXNfZmxhdCggc3RhcnQgKSB7XG5cbiAgICAgIHZhciBuRWxlbWVudHMgPSBtZC5udHJpX2ZsYXQ7XG5cbiAgICAgIGlmICggbkVsZW1lbnRzICkge1xuXG4gICAgICAgIHZhciBvZmZzZXRNYXRlcmlhbHMgPSBzdGFydCArIG5FbGVtZW50cyAqIFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogMztcbiAgICAgICAgaW5pdF9mYWNlczNfZmxhdCggbkVsZW1lbnRzLCBzdGFydCwgb2Zmc2V0TWF0ZXJpYWxzICk7XG5cbiAgICAgIH1cblxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBpbml0X3RyaWFuZ2xlc19mbGF0X3V2KCBzdGFydCApIHtcblxuICAgICAgdmFyIG5FbGVtZW50cyA9IG1kLm50cmlfZmxhdF91djtcblxuICAgICAgaWYgKCBuRWxlbWVudHMgKSB7XG5cbiAgICAgICAgdmFyIG9mZnNldFV2cyA9IHN0YXJ0ICsgbkVsZW1lbnRzICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiAzO1xuICAgICAgICB2YXIgb2Zmc2V0TWF0ZXJpYWxzID0gb2Zmc2V0VXZzICsgbkVsZW1lbnRzICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiAzO1xuXG4gICAgICAgIGluaXRfZmFjZXMzX2ZsYXQoIG5FbGVtZW50cywgc3RhcnQsIG9mZnNldE1hdGVyaWFscyApO1xuICAgICAgICBpbml0X3V2czMoIG5FbGVtZW50cywgb2Zmc2V0VXZzICk7XG5cbiAgICAgIH1cblxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBpbml0X3RyaWFuZ2xlc19zbW9vdGgoIHN0YXJ0ICkge1xuXG4gICAgICB2YXIgbkVsZW1lbnRzID0gbWQubnRyaV9zbW9vdGg7XG5cbiAgICAgIGlmICggbkVsZW1lbnRzICkge1xuXG4gICAgICAgIHZhciBvZmZzZXROb3JtYWxzID0gc3RhcnQgKyBuRWxlbWVudHMgKiBVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIDM7XG4gICAgICAgIHZhciBvZmZzZXRNYXRlcmlhbHMgPSBvZmZzZXROb3JtYWxzICsgbkVsZW1lbnRzICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiAzO1xuXG4gICAgICAgIGluaXRfZmFjZXMzX3Ntb290aCggbkVsZW1lbnRzLCBzdGFydCwgb2Zmc2V0Tm9ybWFscywgb2Zmc2V0TWF0ZXJpYWxzICk7XG5cbiAgICAgIH1cblxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBpbml0X3RyaWFuZ2xlc19zbW9vdGhfdXYoIHN0YXJ0ICkge1xuXG4gICAgICB2YXIgbkVsZW1lbnRzID0gbWQubnRyaV9zbW9vdGhfdXY7XG5cbiAgICAgIGlmICggbkVsZW1lbnRzICkge1xuXG4gICAgICAgIHZhciBvZmZzZXROb3JtYWxzID0gc3RhcnQgKyBuRWxlbWVudHMgKiBVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIDM7XG4gICAgICAgIHZhciBvZmZzZXRVdnMgPSBvZmZzZXROb3JtYWxzICsgbkVsZW1lbnRzICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiAzO1xuICAgICAgICB2YXIgb2Zmc2V0TWF0ZXJpYWxzID0gb2Zmc2V0VXZzICsgbkVsZW1lbnRzICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiAzO1xuXG4gICAgICAgIGluaXRfZmFjZXMzX3Ntb290aCggbkVsZW1lbnRzLCBzdGFydCwgb2Zmc2V0Tm9ybWFscywgb2Zmc2V0TWF0ZXJpYWxzICk7XG4gICAgICAgIGluaXRfdXZzMyggbkVsZW1lbnRzLCBvZmZzZXRVdnMgKTtcblxuICAgICAgfVxuXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGluaXRfcXVhZHNfZmxhdCggc3RhcnQgKSB7XG5cbiAgICAgIHZhciBuRWxlbWVudHMgPSBtZC5ucXVhZF9mbGF0O1xuXG4gICAgICBpZiAoIG5FbGVtZW50cyApIHtcblxuICAgICAgICB2YXIgb2Zmc2V0TWF0ZXJpYWxzID0gc3RhcnQgKyBuRWxlbWVudHMgKiBVaW50MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCAqIDQ7XG4gICAgICAgIGluaXRfZmFjZXM0X2ZsYXQoIG5FbGVtZW50cywgc3RhcnQsIG9mZnNldE1hdGVyaWFscyApO1xuXG4gICAgICB9XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdF9xdWFkc19mbGF0X3V2KCBzdGFydCApIHtcblxuICAgICAgdmFyIG5FbGVtZW50cyA9IG1kLm5xdWFkX2ZsYXRfdXY7XG5cbiAgICAgIGlmICggbkVsZW1lbnRzICkge1xuXG4gICAgICAgIHZhciBvZmZzZXRVdnMgPSBzdGFydCArIG5FbGVtZW50cyAqIFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogNDtcbiAgICAgICAgdmFyIG9mZnNldE1hdGVyaWFscyA9IG9mZnNldFV2cyArIG5FbGVtZW50cyAqIFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogNDtcblxuICAgICAgICBpbml0X2ZhY2VzNF9mbGF0KCBuRWxlbWVudHMsIHN0YXJ0LCBvZmZzZXRNYXRlcmlhbHMgKTtcbiAgICAgICAgaW5pdF91dnM0KCBuRWxlbWVudHMsIG9mZnNldFV2cyApO1xuXG4gICAgICB9XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdF9xdWFkc19zbW9vdGgoIHN0YXJ0ICkge1xuXG4gICAgICB2YXIgbkVsZW1lbnRzID0gbWQubnF1YWRfc21vb3RoO1xuXG4gICAgICBpZiAoIG5FbGVtZW50cyApIHtcblxuICAgICAgICB2YXIgb2Zmc2V0Tm9ybWFscyA9IHN0YXJ0ICsgbkVsZW1lbnRzICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiA0O1xuICAgICAgICB2YXIgb2Zmc2V0TWF0ZXJpYWxzID0gb2Zmc2V0Tm9ybWFscyArIG5FbGVtZW50cyAqIFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogNDtcblxuICAgICAgICBpbml0X2ZhY2VzNF9zbW9vdGgoIG5FbGVtZW50cywgc3RhcnQsIG9mZnNldE5vcm1hbHMsIG9mZnNldE1hdGVyaWFscyApO1xuXG4gICAgICB9XG5cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdF9xdWFkc19zbW9vdGhfdXYoIHN0YXJ0ICkge1xuXG4gICAgICB2YXIgbkVsZW1lbnRzID0gbWQubnF1YWRfc21vb3RoX3V2O1xuXG4gICAgICBpZiAoIG5FbGVtZW50cyApIHtcblxuICAgICAgICB2YXIgb2Zmc2V0Tm9ybWFscyA9IHN0YXJ0ICsgbkVsZW1lbnRzICogVWludDMyQXJyYXkuQllURVNfUEVSX0VMRU1FTlQgKiA0O1xuICAgICAgICB2YXIgb2Zmc2V0VXZzID0gb2Zmc2V0Tm9ybWFscyArIG5FbGVtZW50cyAqIFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogNDtcbiAgICAgICAgdmFyIG9mZnNldE1hdGVyaWFscyA9IG9mZnNldFV2cyArIG5FbGVtZW50cyAqIFVpbnQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UICogNDtcblxuICAgICAgICBpbml0X2ZhY2VzNF9zbW9vdGgoIG5FbGVtZW50cywgc3RhcnQsIG9mZnNldE5vcm1hbHMsIG9mZnNldE1hdGVyaWFscyApO1xuICAgICAgICBpbml0X3V2czQoIG5FbGVtZW50cywgb2Zmc2V0VXZzICk7XG5cbiAgICAgIH1cblxuICAgIH07XG5cbiAgfTtcblxuICBNb2RlbC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKCBUSFJFRS5HZW9tZXRyeS5wcm90b3R5cGUgKTtcbiAgTW9kZWwucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTW9kZWw7XG5cbiAgdmFyIGdlb21ldHJ5ID0gbmV3IE1vZGVsKCB0ZXh0dXJlUGF0aCApO1xuICB2YXIgbWF0ZXJpYWxzID0gdGhpcy5pbml0TWF0ZXJpYWxzKCBqc29uTWF0ZXJpYWxzLCB0ZXh0dXJlUGF0aCApO1xuXG4gIGlmICggdGhpcy5uZWVkc1RhbmdlbnRzKCBtYXRlcmlhbHMgKSApIGdlb21ldHJ5LmNvbXB1dGVUYW5nZW50cygpO1xuXG4gIGNhbGxiYWNrKCBnZW9tZXRyeSwgbWF0ZXJpYWxzICk7XG5cbn07XG4iLCIvKiBnbG9iYWxzIGRlZmluZSAqL1xuOyhmdW5jdGlvbihkZWZpbmUpeyd1c2Ugc3RyaWN0JztkZWZpbmUoZnVuY3Rpb24ocmVxdWlyZSxleHBvcnRzLG1vZHVsZSl7XG4vKipcbiAqIExvY2Fsc1xuICovXG52YXIgdGV4dENvbnRlbnQgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE5vZGUucHJvdG90eXBlLFxuICAgICd0ZXh0Q29udGVudCcpO1xudmFyIGlubmVySFRNTCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoRWxlbWVudC5wcm90b3R5cGUsICdpbm5lckhUTUwnKTtcbnZhciByZW1vdmVBdHRyaWJ1dGUgPSBFbGVtZW50LnByb3RvdHlwZS5yZW1vdmVBdHRyaWJ1dGU7XG52YXIgc2V0QXR0cmlidXRlID0gRWxlbWVudC5wcm90b3R5cGUuc2V0QXR0cmlidXRlO1xudmFyIG5vb3AgID0gZnVuY3Rpb24oKSB7fTtcblxuLyoqXG4gKiBSZWdpc3RlciBhIG5ldyBjb21wb25lbnQuXG4gKlxuICogQHBhcmFtICB7U3RyaW5nfSBuYW1lXG4gKiBAcGFyYW0gIHtPYmplY3R9IHByb3BzXG4gKiBAcmV0dXJuIHtjb25zdHJ1Y3Rvcn1cbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0cy5yZWdpc3RlciA9IGZ1bmN0aW9uKG5hbWUsIHByb3BzKSB7XG4gIHZhciBiYXNlUHJvdG8gPSBnZXRCYXNlUHJvdG8ocHJvcHMuZXh0ZW5kcyk7XG4gIHZhciB0ZW1wbGF0ZSA9IHByb3BzLnRlbXBsYXRlIHx8IGJhc2VQcm90by50ZW1wbGF0ZVN0cmluZztcblxuICAvLyBDb21wb25lbnRzIGFyZSBleHRlbnNpYmxlIGJ5IGRlZmF1bHQgYnV0IGNhbiBiZSBkZWNsYXJlZFxuICAvLyBhcyBub24gZXh0ZW5zaWJsZSBhcyBhbiBvcHRpbWl6YXRpb24gdG8gYXZvaWRcbiAgLy8gc3RvcmluZyB0aGUgdGVtcGxhdGUgc3RyaW5nc1xuICB2YXIgZXh0ZW5zaWJsZSA9IHByb3BzLmV4dGVuc2libGUgPSBwcm9wcy5oYXNPd25Qcm9wZXJ0eSgnZXh0ZW5zaWJsZScpP1xuICAgIHByb3BzLmV4dGVuc2libGUgOiB0cnVlO1xuXG4gIC8vIENsZWFuIHVwXG4gIGRlbGV0ZSBwcm9wcy5leHRlbmRzO1xuXG4gIC8vIFB1bGwgb3V0IENTUyB0aGF0IG5lZWRzIHRvIGJlIGluIHRoZSBsaWdodC1kb21cbiAgaWYgKHRlbXBsYXRlKSB7XG4gICAgLy8gU3RvcmVzIHRoZSBzdHJpbmcgdG8gYmUgcmVwcm9jZXNzZWQgd2hlblxuICAgIC8vIGEgbmV3IGNvbXBvbmVudCBleHRlbmRzIHRoaXMgb25lXG4gICAgaWYgKGV4dGVuc2libGUgJiYgcHJvcHMudGVtcGxhdGUpIHtcbiAgICAgIHByb3BzLnRlbXBsYXRlU3RyaW5nID0gcHJvcHMudGVtcGxhdGU7XG4gICAgfVxuXG4gICAgdmFyIG91dHB1dCA9IHByb2Nlc3NDc3ModGVtcGxhdGUsIG5hbWUpO1xuXG4gICAgcHJvcHMudGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xuICAgIHByb3BzLnRlbXBsYXRlLmlubmVySFRNTCA9IG91dHB1dC50ZW1wbGF0ZTtcbiAgICBwcm9wcy5saWdodENzcyA9IG91dHB1dC5saWdodENzcztcblxuICAgIHByb3BzLmdsb2JhbENzcyA9IHByb3BzLmdsb2JhbENzcyB8fCAnJztcbiAgICBwcm9wcy5nbG9iYWxDc3MgKz0gb3V0cHV0Lmdsb2JhbENzcztcbiAgfVxuXG4gIC8vIEluamVjdCBnbG9iYWwgQ1NTIGludG8gdGhlIGRvY3VtZW50LFxuICAvLyBhbmQgZGVsZXRlIGFzIG5vIGxvbmdlciBuZWVkZWRcbiAgaW5qZWN0R2xvYmFsQ3NzKHByb3BzLmdsb2JhbENzcyk7XG4gIGRlbGV0ZSBwcm9wcy5nbG9iYWxDc3M7XG5cbiAgLy8gTWVyZ2UgYmFzZSBnZXR0ZXIvc2V0dGVyIGF0dHJpYnV0ZXMgd2l0aCB0aGUgdXNlcidzLFxuICAvLyB0aGVuIGRlZmluZSB0aGUgcHJvcGVydHkgZGVzY3JpcHRvcnMgb24gdGhlIHByb3RvdHlwZS5cbiAgdmFyIGRlc2NyaXB0b3JzID0gbWl4aW4ocHJvcHMuYXR0cnMgfHwge30sIGJhc2UuZGVzY3JpcHRvcnMpO1xuXG4gIC8vIFN0b3JlIHRoZSBvcmdpbmFsIGRlc2NyaXB0b3JzIHNvbWV3aGVyZVxuICAvLyBhIGxpdHRsZSBtb3JlIHByaXZhdGUgYW5kIGRlbGV0ZSB0aGUgb3JpZ2luYWxcbiAgcHJvcHMuX2F0dHJzID0gcHJvcHMuYXR0cnM7XG4gIGRlbGV0ZSBwcm9wcy5hdHRycztcblxuICAvLyBDcmVhdGUgdGhlIHByb3RvdHlwZSwgZXh0ZW5kZWQgZnJvbSBiYXNlIGFuZFxuICAvLyBkZWZpbmUgdGhlIGRlc2NyaXB0b3JzIGRpcmVjdGx5IG9uIHRoZSBwcm90b3R5cGVcbiAgdmFyIHByb3RvID0gY3JlYXRlUHJvdG8oYmFzZVByb3RvLCBwcm9wcyk7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHByb3RvLCBkZXNjcmlwdG9ycyk7XG5cbiAgLy8gUmVnaXN0ZXIgdGhlIGN1c3RvbS1lbGVtZW50IGFuZCByZXR1cm4gdGhlIGNvbnN0cnVjdG9yXG4gIHRyeSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LnJlZ2lzdGVyRWxlbWVudChuYW1lLCB7IHByb3RvdHlwZTogcHJvdG8gfSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5uYW1lICE9PSAnTm90U3VwcG9ydGVkRXJyb3InKSB7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfVxufTtcblxudmFyIGJhc2UgPSB7XG4gIHByb3BlcnRpZXM6IHtcbiAgICBHYWlhQ29tcG9uZW50OiB0cnVlLFxuICAgIGF0dHJpYnV0ZUNoYW5nZWQ6IG5vb3AsXG4gICAgYXR0YWNoZWQ6IG5vb3AsXG4gICAgZGV0YWNoZWQ6IG5vb3AsXG4gICAgY3JlYXRlZDogbm9vcCxcblxuICAgIGNyZWF0ZWRDYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5ydGwpIHsgYWRkRGlyT2JzZXJ2ZXIoKTsgfVxuICAgICAgaW5qZWN0TGlnaHRDc3ModGhpcyk7XG4gICAgICB0aGlzLmNyZWF0ZWQoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSXQgaXMgdmVyeSBjb21tb24gdG8gd2FudCB0byBrZWVwIG9iamVjdFxuICAgICAqIHByb3BlcnRpZXMgaW4tc3luYyB3aXRoIGF0dHJpYnV0ZXMsXG4gICAgICogZm9yIGV4YW1wbGU6XG4gICAgICpcbiAgICAgKiAgIGVsLnZhbHVlID0gJ2Zvbyc7XG4gICAgICogICBlbC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgJ2ZvbycpO1xuICAgICAqXG4gICAgICogU28gd2Ugc3VwcG9ydCBhbiBvYmplY3Qgb24gdGhlIHByb3RvdHlwZVxuICAgICAqIG5hbWVkICdhdHRycycgdG8gcHJvdmlkZSBhIGNvbnNpc3RlbnRcbiAgICAgKiB3YXkgZm9yIGNvbXBvbmVudCBhdXRob3JzIHRvIGRlZmluZVxuICAgICAqIHRoZXNlIHByb3BlcnRpZXMuIFdoZW4gYW4gYXR0cmlidXRlXG4gICAgICogY2hhbmdlcyB3ZSBrZWVwIHRoZSBhdHRyW25hbWVdXG4gICAgICogdXAtdG8tZGF0ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSAge1N0cmluZ30gbmFtZVxuICAgICAqIEBwYXJhbSAge1N0cmluZ3x8bnVsbH0gZnJvbVxuICAgICAqIEBwYXJhbSAge1N0cmluZ3x8bnVsbH0gdG9cbiAgICAgKi9cbiAgICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2s6IGZ1bmN0aW9uKG5hbWUsIGZyb20sIHRvKSB7XG4gICAgICB2YXIgcHJvcCA9IHRvQ2FtZWxDYXNlKG5hbWUpO1xuICAgICAgaWYgKHRoaXMuX2F0dHJzICYmIHRoaXMuX2F0dHJzW3Byb3BdKSB7IHRoaXNbcHJvcF0gPSB0bzsgfVxuICAgICAgdGhpcy5hdHRyaWJ1dGVDaGFuZ2VkKG5hbWUsIGZyb20sIHRvKTtcbiAgICB9LFxuXG4gICAgYXR0YWNoZWRDYWxsYmFjazogZnVuY3Rpb24oKSB7IHRoaXMuYXR0YWNoZWQoKTsgfSxcbiAgICBkZXRhY2hlZENhbGxiYWNrOiBmdW5jdGlvbigpIHsgdGhpcy5kZXRhY2hlZCgpOyB9LFxuXG4gICAgLyoqXG4gICAgICogQSBjb252ZW5pZW50IG1ldGhvZCBmb3Igc2V0dGluZyB1cFxuICAgICAqIGEgc2hhZG93LXJvb3QgdXNpbmcgdGhlIGRlZmluZWQgdGVtcGxhdGUuXG4gICAgICpcbiAgICAgKiBAcmV0dXJuIHtTaGFkb3dSb290fVxuICAgICAqL1xuICAgIHNldHVwU2hhZG93Um9vdDogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMudGVtcGxhdGUpIHsgcmV0dXJuOyB9XG4gICAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGF0ZS5jb250ZW50LCB0cnVlKTtcbiAgICAgIHRoaXMuY3JlYXRlU2hhZG93Um9vdCgpLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgcmV0dXJuIHRoaXMuc2hhZG93Um9vdDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhbiBhdHRyaWJ1dGUgaW50ZXJuYWxseVxuICAgICAqIGFuZCBleHRlcm5hbGx5LiBUaGlzIGlzIHNvIHRoYXRcbiAgICAgKiB3ZSBjYW4gc3R5bGUgaW50ZXJuYWwgc2hhZG93LWRvbVxuICAgICAqIGNvbnRlbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbmFtZVxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSB2YWx1ZVxuICAgICAqL1xuICAgIHNldEF0dHI6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICB2YXIgaW50ZXJuYWwgPSB0aGlzLnNoYWRvd1Jvb3QuZmlyc3RFbGVtZW50Q2hpbGQ7XG4gICAgICBzZXRBdHRyaWJ1dGUuY2FsbChpbnRlcm5hbCwgbmFtZSwgdmFsdWUpO1xuICAgICAgc2V0QXR0cmlidXRlLmNhbGwodGhpcywgbmFtZSwgdmFsdWUpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGFuIGF0dHJpYnV0ZSBpbnRlcm5hbGx5XG4gICAgICogYW5kIGV4dGVybmFsbHkuIFRoaXMgaXMgc28gdGhhdFxuICAgICAqIHdlIGNhbiBzdHlsZSBpbnRlcm5hbCBzaGFkb3ctZG9tXG4gICAgICogY29udGVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXG4gICAgICovXG4gICAgcmVtb3ZlQXR0cjogZnVuY3Rpb24obmFtZSkge1xuICAgICAgdmFyIGludGVybmFsID0gdGhpcy5zaGFkb3dSb290LmZpcnN0RWxlbWVudENoaWxkO1xuICAgICAgcmVtb3ZlQXR0cmlidXRlLmNhbGwoaW50ZXJuYWwsIG5hbWUpO1xuICAgICAgcmVtb3ZlQXR0cmlidXRlLmNhbGwodGhpcywgbmFtZSk7XG4gICAgfVxuICB9LFxuXG4gIGRlc2NyaXB0b3JzOiB7XG4gICAgdGV4dENvbnRlbnQ6IHtcbiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgdGV4dENvbnRlbnQuc2V0LmNhbGwodGhpcywgdmFsdWUpO1xuICAgICAgICBpZiAodGhpcy5saWdodFN0eWxlKSB7IHRoaXMuYXBwZW5kQ2hpbGQodGhpcy5saWdodFN0eWxlKTsgfVxuICAgICAgfSxcblxuICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRleHRDb250ZW50LmdldCgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBpbm5lckhUTUw6IHtcbiAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgaW5uZXJIVE1MLnNldC5jYWxsKHRoaXMsIHZhbHVlKTtcbiAgICAgICAgaWYgKHRoaXMubGlnaHRTdHlsZSkgeyB0aGlzLmFwcGVuZENoaWxkKHRoaXMubGlnaHRTdHlsZSk7IH1cbiAgICAgIH0sXG5cbiAgICAgIGdldDogaW5uZXJIVE1MLmdldFxuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBUaGUgZGVmYXVsdCBiYXNlIHByb3RvdHlwZSB0byB1c2VcbiAqIHdoZW4gYGV4dGVuZHNgIGlzIHVuZGVmaW5lZC5cbiAqXG4gKiBAdHlwZSB7T2JqZWN0fVxuICovXG52YXIgZGVmYXVsdFByb3RvdHlwZSA9IGNyZWF0ZVByb3RvKEhUTUxFbGVtZW50LnByb3RvdHlwZSwgYmFzZS5wcm9wZXJ0aWVzKTtcblxuLyoqXG4gKiBSZXR1cm5zIGEgc3VpdGFibGUgcHJvdG90eXBlIGJhc2VkXG4gKiBvbiB0aGUgb2JqZWN0IHBhc3NlZC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtICB7SFRNTEVsZW1lbnRQcm90b3R5cGV8dW5kZWZpbmVkfSBwcm90b1xuICogQHJldHVybiB7SFRNTEVsZW1lbnRQcm90b3R5cGV9XG4gKi9cbmZ1bmN0aW9uIGdldEJhc2VQcm90byhwcm90bykge1xuICBpZiAoIXByb3RvKSB7IHJldHVybiBkZWZhdWx0UHJvdG90eXBlOyB9XG4gIHByb3RvID0gcHJvdG8ucHJvdG90eXBlIHx8IHByb3RvO1xuICByZXR1cm4gIXByb3RvLkdhaWFDb21wb25lbnQgP1xuICAgIGNyZWF0ZVByb3RvKHByb3RvLCBiYXNlLnByb3BlcnRpZXMpIDogcHJvdG87XG59XG5cbi8qKlxuICogRXh0ZW5kcyB0aGUgZ2l2ZW4gcHJvdG8gYW5kIG1peGVzXG4gKiBpbiB0aGUgZ2l2ZW4gcHJvcGVydGllcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtICB7T2JqZWN0fSBwcm90b1xuICogQHBhcmFtICB7T2JqZWN0fSBwcm9wc1xuICogQHJldHVybiB7T2JqZWN0fVxuICovXG5mdW5jdGlvbiBjcmVhdGVQcm90byhwcm90bywgcHJvcHMpIHtcbiAgcmV0dXJuIG1peGluKE9iamVjdC5jcmVhdGUocHJvdG8pLCBwcm9wcyk7XG59XG5cbi8qKlxuICogRGV0ZWN0cyBwcmVzZW5jZSBvZiBzaGFkb3ctZG9tXG4gKiBDU1Mgc2VsZWN0b3JzLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcmV0dXJuIHtCb29sZWFufVxuICovXG52YXIgaGFzU2hhZG93Q1NTID0gKGZ1bmN0aW9uKCkge1xuICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHRyeSB7IGRpdi5xdWVyeVNlbGVjdG9yKCc6aG9zdCcpOyByZXR1cm4gdHJ1ZTsgfVxuICBjYXRjaCAoZSkgeyByZXR1cm4gZmFsc2U7IH1cbn0pKCk7XG5cbi8qKlxuICogUmVnZXhzIHVzZWQgdG8gZXh0cmFjdCBzaGFkb3ctY3NzXG4gKlxuICogQHR5cGUge09iamVjdH1cbiAqL1xudmFyIHJlZ2V4ID0ge1xuICBzaGFkb3dDc3M6IC8oPzpcXDpob3N0fFxcOlxcOmNvbnRlbnQpW157XSpcXHtbXn1dKlxcfS9nLFxuICAnOmhvc3QnOiAvKD86XFw6aG9zdCkvZyxcbiAgJzpob3N0KCknOiAvXFw6aG9zdFxcKCguKylcXCkoPzogXFw6XFw6Y29udGVudCk/L2csXG4gICc6aG9zdC1jb250ZXh0JzogL1xcOmhvc3QtY29udGV4dFxcKCguKylcXCkoW157LF0rKT8vZyxcbiAgJzo6Y29udGVudCc6IC8oPzpcXDpcXDpjb250ZW50KS9nXG59O1xuXG4vKipcbiAqIEV4dHJhY3RzIHRoZSA6aG9zdCBhbmQgOjpjb250ZW50IHJ1bGVzXG4gKiBmcm9tIHRoZSBzaGFkb3ctZG9tIENTUyBhbmQgcmV3cml0ZXNcbiAqIHRoZW0gdG8gd29yayBmcm9tIHRoZSA8c3R5bGUgc2NvcGVkPlxuICogaW5qZWN0ZWQgYXQgdGhlIHJvb3Qgb2YgdGhlIGNvbXBvbmVudC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHJldHVybiB7U3RyaW5nfVxuICovXG5mdW5jdGlvbiBwcm9jZXNzQ3NzKHRlbXBsYXRlLCBuYW1lKSB7XG4gIHZhciBnbG9iYWxDc3MgPSAnJztcbiAgdmFyIGxpZ2h0Q3NzID0gJyc7XG5cbiAgaWYgKCFoYXNTaGFkb3dDU1MpIHtcbiAgICB0ZW1wbGF0ZSA9IHRlbXBsYXRlLnJlcGxhY2UocmVnZXguc2hhZG93Q3NzLCBmdW5jdGlvbihtYXRjaCkge1xuICAgICAgdmFyIGhvc3RDb250ZXh0ID0gcmVnZXhbJzpob3N0LWNvbnRleHQnXS5leGVjKG1hdGNoKTtcblxuICAgICAgaWYgKGhvc3RDb250ZXh0KSB7XG4gICAgICAgIGdsb2JhbENzcyArPSBtYXRjaFxuICAgICAgICAgIC5yZXBsYWNlKHJlZ2V4Wyc6OmNvbnRlbnQnXSwgJycpXG4gICAgICAgICAgLnJlcGxhY2UocmVnZXhbJzpob3N0LWNvbnRleHQnXSwgJyQxICcgKyBuYW1lICsgJyQyJylcbiAgICAgICAgICAucmVwbGFjZSgvICsvZywgJyAnKTsgLy8gZXhjZXNzIHdoaXRlc3BhY2VcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpZ2h0Q3NzICs9IG1hdGNoXG4gICAgICAgICAgLnJlcGxhY2UocmVnZXhbJzpob3N0KCknXSwgbmFtZSArICckMScpXG4gICAgICAgICAgLnJlcGxhY2UocmVnZXhbJzpob3N0J10sIG5hbWUpXG4gICAgICAgICAgLnJlcGxhY2UocmVnZXhbJzo6Y29udGVudCddLCBuYW1lKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuICcnO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICB0ZW1wbGF0ZTogdGVtcGxhdGUsXG4gICAgbGlnaHRDc3M6IGxpZ2h0Q3NzLFxuICAgIGdsb2JhbENzczogZ2xvYmFsQ3NzXG4gIH07XG59XG5cbi8qKlxuICogU29tZSBDU1MgcnVsZXMsIHN1Y2ggYXMgQGtleWZyYW1lc1xuICogYW5kIEBmb250LWZhY2UgZG9uJ3Qgd29yayBpbnNpZGVcbiAqIHNjb3BlZCBvciBzaGFkb3cgPHN0eWxlPi4gU28gd2VcbiAqIGhhdmUgdG8gcHV0IHRoZW0gaW50byAnZ2xvYmFsJ1xuICogPHN0eWxlPiBpbiB0aGUgaGVhZCBvZiB0aGVcbiAqIGRvY3VtZW50LlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0gIHtTdHJpbmd9IGNzc1xuICovXG5mdW5jdGlvbiBpbmplY3RHbG9iYWxDc3MoY3NzKSB7XG4gIGlmICghY3NzKSB7cmV0dXJuO31cbiAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgc3R5bGUuaW5uZXJIVE1MID0gY3NzLnRyaW0oKTtcbiAgaGVhZFJlYWR5KCkudGhlbihmdW5jdGlvbigpIHtcbiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTtcbiAgfSk7XG59XG5cblxuLyoqXG4gKiBSZXNvbHZlcyBhIHByb21pc2Ugb25jZSBkb2N1bWVudC5oZWFkIGlzIHJlYWR5LlxuICpcbiAqIEBwcml2YXRlXG4gKi9cbmZ1bmN0aW9uIGhlYWRSZWFkeSgpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICBpZiAoZG9jdW1lbnQuaGVhZCkgeyByZXR1cm4gcmVzb2x2ZSgpOyB9XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiBmbigpIHtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdsb2FkJywgZm4pO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuXG4vKipcbiAqIFRoZSBHZWNrbyBwbGF0Zm9ybSBkb2Vzbid0IHlldCBoYXZlXG4gKiBgOjpjb250ZW50YCBvciBgOmhvc3RgLCBzZWxlY3RvcnMsXG4gKiB3aXRob3V0IHRoZXNlIHdlIGFyZSB1bmFibGUgdG8gc3R5bGVcbiAqIHVzZXItY29udGVudCBpbiB0aGUgbGlnaHQtZG9tIGZyb21cbiAqIHdpdGhpbiBvdXIgc2hhZG93LWRvbSBzdHlsZS1zaGVldC5cbiAqXG4gKiBUbyB3b3JrYXJvdW5kIHRoaXMsIHdlIGNsb25lIHRoZSA8c3R5bGU+XG4gKiBub2RlIGludG8gdGhlIHJvb3Qgb2YgdGhlIGNvbXBvbmVudCxcbiAqIHNvIG91ciBzZWxlY3RvcnMgYXJlIGFibGUgdG8gdGFyZ2V0XG4gKiBsaWdodC1kb20gY29udGVudC5cbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBpbmplY3RMaWdodENzcyhlbCkge1xuICBpZiAoaGFzU2hhZG93Q1NTKSB7IHJldHVybjsgfVxuICBlbC5saWdodFN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgZWwubGlnaHRTdHlsZS5zZXRBdHRyaWJ1dGUoJ3Njb3BlZCcsICcnKTtcbiAgZWwubGlnaHRTdHlsZS5pbm5lckhUTUwgPSBlbC5saWdodENzcztcbiAgZWwuYXBwZW5kQ2hpbGQoZWwubGlnaHRTdHlsZSk7XG59XG5cbi8qKlxuICogQ29udmVydCBoeXBoZW4gc2VwYXJhdGVkXG4gKiBzdHJpbmcgdG8gY2FtZWwtY2FzZS5cbiAqXG4gKiBFeGFtcGxlOlxuICpcbiAqICAgdG9DYW1lbENhc2UoJ2Zvby1iYXInKTsgLy89PiAnZm9vQmFyJ1xuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0gIHtTcmluZ30gc3RyaW5nXG4gKiBAcmV0dXJuIHtTdHJpbmd9XG4gKi9cbmZ1bmN0aW9uIHRvQ2FtZWxDYXNlKHN0cmluZykge1xuICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoLy0oLikvZywgZnVuY3Rpb24gcmVwbGFjZXIoc3RyaW5nLCBwMSkge1xuICAgIHJldHVybiBwMS50b1VwcGVyQ2FzZSgpO1xuICB9KTtcbn1cblxuLyoqXG4gKiBPYnNlcnZlciAoc2luZ2xldG9uKVxuICpcbiAqIEB0eXBlIHtNdXRhdGlvbk9ic2VydmVyfHVuZGVmaW5lZH1cbiAqL1xudmFyIGRpck9ic2VydmVyO1xuXG4vKipcbiAqIE9ic2VydmVzIHRoZSBkb2N1bWVudCBgZGlyYCAoZGlyZWN0aW9uKVxuICogYXR0cmlidXRlIGFuZCBkaXNwYXRjaGVzIGEgZ2xvYmFsIGV2ZW50XG4gKiB3aGVuIGl0IGNoYW5nZXMuXG4gKlxuICogQ29tcG9uZW50cyBjYW4gbGlzdGVuIHRvIHRoaXMgZXZlbnQgYW5kXG4gKiBtYWtlIGludGVybmFsIGNoYW5nZXMgaWYgbmVlZCBiZS5cbiAqXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiBhZGREaXJPYnNlcnZlcigpIHtcbiAgaWYgKGRpck9ic2VydmVyKSB7IHJldHVybjsgfVxuXG4gIGRpck9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIob25DaGFuZ2VkKTtcbiAgZGlyT2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHtcbiAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsnZGlyJ10sXG4gICAgYXR0cmlidXRlczogdHJ1ZVxuICB9KTtcblxuICBmdW5jdGlvbiBvbkNoYW5nZWQobXV0YXRpb25zKSB7XG4gICAgZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2RpcmNoYW5nZWQnKSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDb3B5IHRoZSB2YWx1ZXMgb2YgYWxsIHByb3BlcnRpZXMgZnJvbVxuICogc291cmNlIG9iamVjdCBgdGFyZ2V0YCB0byBhIHRhcmdldCBvYmplY3QgYHNvdXJjZWAuXG4gKiBJdCB3aWxsIHJldHVybiB0aGUgdGFyZ2V0IG9iamVjdC5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtICAge09iamVjdH0gdGFyZ2V0XG4gKiBAcGFyYW0gICB7T2JqZWN0fSBzb3VyY2VcbiAqIEByZXR1cm5zIHtPYmplY3R9XG4gKi9cbmZ1bmN0aW9uIG1peGluKHRhcmdldCwgc291cmNlKSB7XG4gIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHtcbiAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICB9XG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbn0pO30pKHR5cGVvZiBkZWZpbmU9PSdmdW5jdGlvbicmJmRlZmluZS5hbWQ/ZGVmaW5lXG46KGZ1bmN0aW9uKG4sdyl7J3VzZSBzdHJpY3QnO3JldHVybiB0eXBlb2YgbW9kdWxlPT0nb2JqZWN0Jz9mdW5jdGlvbihjKXtcbmMocmVxdWlyZSxleHBvcnRzLG1vZHVsZSk7fTpmdW5jdGlvbihjKXt2YXIgbT17ZXhwb3J0czp7fX07YyhmdW5jdGlvbihuKXtcbnJldHVybiB3W25dO30sbS5leHBvcnRzLG0pO3dbbl09bS5leHBvcnRzO307fSkoJ2dhaWEtY29tcG9uZW50Jyx0aGlzKSk7XG4iLCIvKiBnbG9iYWxzIGRlZmluZSAqL1xuKGZ1bmN0aW9uKGRlZmluZSl7J3VzZSBzdHJpY3QnO2RlZmluZShmdW5jdGlvbihyZXF1aXJlLGV4cG9ydHMsbW9kdWxlKXtcblxuLyoqXG4gKiBEZXBlbmRlbmNpZXNcbiAqL1xuXG52YXIgY29tcG9uZW50ID0gcmVxdWlyZSgnZ2FpYS1jb21wb25lbnQnKTtcblxuLyoqXG4gKiBTaW1wbGUgbG9nZ2VyXG4gKiBAdHlwZSB7RnVuY3Rpb259XG4gKi9cbnZhciBkZWJ1ZyA9IDAgPyBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpIDogZnVuY3Rpb24oKSB7fTtcblxuLyoqXG4gKiBFeHBvcnRzXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjb21wb25lbnQucmVnaXN0ZXIoJ3ZyLXNjZW5lJywge1xuICBleHRlbmRzOiBIVE1MRGl2RWxlbWVudC5wcm90b3R5cGUsXG5cbiAgY3JlYXRlZDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXR1cEV2ZW50SGFuZGxlcnMoKTtcbiAgICB0aGlzLnNldHVwU2hhZG93Um9vdCgpO1xuICAgIHRoaXMuc2V0dXBSZW5kZXJlcigpO1xuICAgIHRoaXMuc2V0dXBTY2VuZSgpO1xuICAgIHRoaXMuc2V0dXBDYW1lcmEoKTtcbiAgfSxcblxuICBzZXR1cEV2ZW50SGFuZGxlcnM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwcm9jZXNzRGV2aWNlcyA9IHRoaXMucHJvY2Vzc0RldmljZXMuYmluZCh0aGlzKTtcbiAgICB2YXIgb25mdWxsc2NyZWVuY2hhbmdlID0gdGhpcy5vbmZ1bGxzY3JlZW5jaGFuZ2UuYmluZCh0aGlzKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwid2Via2l0ZnVsbHNjcmVlbmNoYW5nZVwiLCBvbmZ1bGxzY3JlZW5jaGFuZ2UpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3pmdWxsc2NyZWVuY2hhbmdlXCIsICAgIG9uZnVsbHNjcmVlbmNoYW5nZSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImZ1bGxzY3JlZW5jaGFuZ2VcIiwgICAgICAgb25mdWxsc2NyZWVuY2hhbmdlKTtcbiAgICB0aGlzLmdldFZSRGV2aWNlcygpLnRoZW4ocHJvY2Vzc0RldmljZXMpWydjYXRjaCddKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIGNvbnNvbGUud2FybihlcnIpO1xuICAgIH0pO1xuICB9LFxuXG4gIG9uZnVsbHNjcmVlbmNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgaWYgKCAhZG9jdW1lbnQubW96RnVsbFNjcmVlbkVsZW1lbnQgJiYgIWRvY3VtZW50LndlYmtpdEZ1bGxTY3JlZW5FbGVtZW50ICkge1xuICAgICAgdGhpcy52aWV3cG9yVHJhbnNmb3JtID0gdGhpcy5jYW1lcmFQcm9qZWN0aW9uVHJhbnNmb3JtO1xuICAgICAgdGhpcy52ck1vZGUgPSBmYWxzZTtcbiAgICAgIHRoaXMudnJFZmZlY3Quc2NhbGUgPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZyTW9kZSA9IHRydWU7XG4gICAgICB0aGlzLnZpZXdwb3JUcmFuc2Zvcm0gPSBcInRyYW5zbGF0ZTNkKC01MCUsIC01MCUsIDBweClcIjtcbiAgICAgIHRoaXMudnJFZmZlY3Quc2NhbGUgPSAyNTAwO1xuICAgIH1cbiAgICB0aGlzLnJlc2l6ZUNhbnZhcygpO1xuICB9LFxuXG4gIGFkZE9iamVjdDogZnVuY3Rpb24oZWwsIHByb3ZpZGVkX29iaikge1xuICAgIHZhciBvYmogPSBlbC5vYmplY3QzRDtcbiAgICB2YXIgb2JqUGFyZW50ID0gZWwucGFyZW50Tm9kZTtcbiAgICBpZiAob2JqICYmIHRoaXMuc2NlbmUuZ2V0T2JqZWN0QnlJZChvYmouaWQpKSB7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cbiAgICBvYmogPSBlbC5vYmplY3QzRCA9IGVsLm9iamVjdDNEIHx8IHByb3ZpZGVkX29iaiB8fCBuZXcgVEhSRUUuT2JqZWN0M0QoKTtcbiAgICBvYmouc2NlbmUgPSB0aGlzO1xuICAgIGlmIChvYmpQYXJlbnQgJiYgb2JqUGFyZW50ICE9PSB0aGlzKSB7XG4gICAgICBvYmpQYXJlbnQgPSB0aGlzLmFkZE9iamVjdChlbC5wYXJlbnROb2RlKTtcbiAgICAgIG9ialBhcmVudC5hZGQob2JqKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zY2VuZS5hZGQob2JqKTtcbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbiAgfSxcblxuICBlcHNpbG9uOiBmdW5jdGlvbiAoIHZhbHVlICkge1xuICAgIHJldHVybiBNYXRoLmFicyggdmFsdWUgKSA8IDAuMDAwMDAxID8gMCA6IHZhbHVlO1xuICB9LFxuXG4gIGdldENTU01hdHJpeDogZnVuY3Rpb24gKG1hdHJpeCkge1xuICAgIHZhciBlcHNpbG9uID0gdGhpcy5lcHNpbG9uO1xuICAgIHZhciBlbGVtZW50cyA9IG1hdHJpeC5lbGVtZW50cztcblxuICAgIHJldHVybiAnbWF0cml4M2QoJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgMCBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDEgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyAyIF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgMyBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDQgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyA1IF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgNiBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDcgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyA4IF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgOSBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDEwIF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgMTEgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyAxMiBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDEzIF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgMTQgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyAxNSBdICkgK1xuICAgICcpJztcbiAgfSxcblxuICBzZXR1cENhbWVyYTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGZvdiA9IHBhcnNlRmxvYXQodGhpcy5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCctLWZvdicpKSB8fCA0NTtcbiAgICB2YXIgdmlld3BvcnQgPSB0aGlzLnZpZXdwb3J0ID0gdGhpcy5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoJy52aWV3cG9ydCcpO1xuICAgIHZhciB3b3JsZCA9IHRoaXMud29ybGQgPSB0aGlzLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignLndvcmxkJyk7XG4gICAgdGhpcy5wZXJzcGVjdGl2ZSA9IDAuNSAvIE1hdGgudGFuKCBUSFJFRS5NYXRoLmRlZ1RvUmFkKCBmb3YgKiAwLjUgKSApICogdGhpcy5vZmZzZXRIZWlnaHQ7XG5cbiAgICAvLyBET00gY2FtZXJhXG4gICAgdmFyIHBlcnNwZWN0aXZlTWF0cml4ID0gdGhpcy5wZXJzcGVjdGl2ZU1hdHJpeChUSFJFRS5NYXRoLmRlZ1RvUmFkKGZvdiksIHRoaXMub2Zmc2V0V2lkdGggLyB0aGlzLm9mZnNldEhlaWdodCwgMSwgMTAwMDApO1xuICAgIHZhciBzY2FsZWQgPSBwZXJzcGVjdGl2ZU1hdHJpeC5jbG9uZSgpLnNjYWxlKG5ldyBUSFJFRS5WZWN0b3IzKHRoaXMub2Zmc2V0V2lkdGgsIHRoaXMub2Zmc2V0SGVpZ2h0LCAxKSk7XG4gICAgdmFyIHN0eWxlID0gdGhpcy5jYW1lcmFQcm9qZWN0aW9uVHJhbnNmb3JtID0gdGhpcy5nZXRDU1NNYXRyaXgoc2NhbGVkKTtcbiAgICB0aGlzLnZpZXdwb3JUcmFuc2Zvcm0gPSBzdHlsZTtcblxuICAgIC8vIFdlYkdMIGNhbWVyYVxuICAgIHZhciBjYW1lcmEgPSB0aGlzLmNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYShmb3YsIHRoaXMub2Zmc2V0V2lkdGggLyB0aGlzLm9mZnNldEhlaWdodCwgMSwgMTAwMDApO1xuICAgIHRoaXMudnJDb250cm9scyA9IG5ldyBUSFJFRS5WUkNvbnRyb2xzKCBjYW1lcmEgKTtcblxuICB9LFxuXG4gIHBlcnNwZWN0aXZlTWF0cml4OiBmdW5jdGlvbihmb3YsIGFzcGVjdCwgbmVhcnosIGZhcnopIHtcbiAgICB2YXIgbWF0cml4ID0gbmV3IFRIUkVFLk1hdHJpeDQoKTtcbiAgICB2YXIgcmFuZ2UgPSBNYXRoLnRhbihmb3YgKiAwLjUpICogbmVhcno7XG5cbiAgICBtYXRyaXguZWxlbWVudHNbMF0gPSAoMiAqIG5lYXJ6KSAvICgocmFuZ2UgKiBhc3BlY3QpIC0gKC1yYW5nZSAqIGFzcGVjdCkpO1xuICAgIG1hdHJpeC5lbGVtZW50c1sxXSA9IDA7XG4gICAgbWF0cml4LmVsZW1lbnRzWzJdID0gMDtcbiAgICBtYXRyaXguZWxlbWVudHNbM10gPSAwO1xuICAgIG1hdHJpeC5lbGVtZW50c1s0XSA9IDA7XG4gICAgbWF0cml4LmVsZW1lbnRzWzVdID0gKDIgKiBuZWFyeikgLyAoMiAqIHJhbmdlKTtcbiAgICBtYXRyaXguZWxlbWVudHNbNl0gPSAwO1xuICAgIG1hdHJpeC5lbGVtZW50c1s3XSA9IDA7XG4gICAgbWF0cml4LmVsZW1lbnRzWzhdID0gMDtcbiAgICBtYXRyaXguZWxlbWVudHNbOV0gPSAwO1xuICAgIG1hdHJpeC5lbGVtZW50c1sxMF0gPSAtKGZhcnogKyBuZWFyeikgLyAoZmFyeiAtIG5lYXJ6KTtcbiAgICBtYXRyaXguZWxlbWVudHNbMTFdID0gLTE7XG4gICAgbWF0cml4LmVsZW1lbnRzWzEyXSA9IDA7XG4gICAgbWF0cml4LmVsZW1lbnRzWzEzXSA9IDA7XG4gICAgbWF0cml4LmVsZW1lbnRzWzE0XSA9IC0oMiAqIGZhcnogKiBuZWFyeikgLyAoZmFyeiAtIG5lYXJ6KTtcbiAgICBtYXRyaXguZWxlbWVudHNbMTVdID0gMDtcbiAgICByZXR1cm4gbWF0cml4LnRyYW5zcG9zZSgpO1xuICB9LFxuXG4gIHNldHVwUmVuZGVyZXI6IGZ1bmN0aW9uKCkge1xuICAgIC8vIEFsbCBXZWJHTCBzZXR1cFxuICAgIHZhciBjYW52YXMgPSB0aGlzLmNhbnZhcyA9IHRoaXMuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKCdjYW52YXMnKTtcblxuICAgIHRoaXMucmVzaXplQ2FudmFzKCk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMucmVzaXplQ2FudmFzLmJpbmQodGhpcyksIGZhbHNlKTtcblxuICAgIHZhciByZW5kZXJlciA9IHRoaXMucmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlciggeyBjYW52YXM6IGNhbnZhcywgYW50aWFsaWFzOiB0cnVlLCBhbHBoYTogdHJ1ZSB9ICk7XG4gICAgcmVuZGVyZXIuc2V0UGl4ZWxSYXRpbyggd2luZG93LmRldmljZVBpeGVsUmF0aW8gKTtcbiAgICByZW5kZXJlci5zZXRTaXplKCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0ICk7XG4gICAgcmVuZGVyZXIuc29ydE9iamVjdHMgPSBmYWxzZTtcbiAgICB0aGlzLnZyRWZmZWN0ID0gbmV3IFRIUkVFLlZSRWZmZWN0KHJlbmRlcmVyKTtcbiAgfSxcblxuICBzZXR1cFNjZW5lOiBmdW5jdGlvbigpIHtcbiAgICAvLyBBbGwgV2ViR0wgU2V0dXBcbiAgICB2YXIgc2NlbmUgPSB0aGlzLnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XG4gICAgY3JlYXRlTGlnaHRzKCk7XG4gICAgZnVuY3Rpb24gY3JlYXRlTGlnaHRzKCkge1xuICAgICAgdmFyIGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCgweGZmZmZmZik7XG4gICAgICBkaXJlY3Rpb25hbExpZ2h0LnBvc2l0aW9uLnNldCgxLCAxLCAxKS5ub3JtYWxpemUoKTtcbiAgICAgIHNjZW5lLmFkZChkaXJlY3Rpb25hbExpZ2h0KTtcbiAgICB9XG4gIH0sXG5cbiAgdXBkYXRlQ2hpbGRyZW46IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjaGlsZDtcbiAgICB2YXIgaTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgY2hpbGQgPSB0aGlzLmNoaWxkcmVuW2ldO1xuICAgICAgaWYgKHR5cGVvZiBjaGlsZC51cGRhdGUgPT0gJ2Z1bmN0aW9uJykgeyBjaGlsZC51cGRhdGUoKTsgfVxuICAgICAgaWYgKHR5cGVvZiBjaGlsZC51cGRhdGVDaGlsZHJlbiA9PSAnZnVuY3Rpb24nKSB7IGNoaWxkLnVwZGF0ZUNoaWxkcmVuKCk7IH1cbiAgICB9XG4gIH0sXG5cbiAgcmVzaXplQ2FudmFzOiBmdW5jdGlvbihyZW5kZXJlciwgY2FtZXJhKXtcbiAgICB2YXIgY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgLy8gTWFrZSBpdCB2aXN1YWxseSBmaWxsIHRoZSBwb3NpdGlvbmVkIHBhcmVudFxuICAgIGNhbnZhcy5zdHlsZS53aWR0aCA9JzEwMCUnO1xuICAgIGNhbnZhcy5zdHlsZS5oZWlnaHQ9JzEwMCUnO1xuICAgIC8vIC4uLnRoZW4gc2V0IHRoZSBpbnRlcm5hbCBzaXplIHRvIG1hdGNoXG4gICAgY2FudmFzLndpZHRoICA9IGNhbnZhcy5vZmZzZXRXaWR0aDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gY2FudmFzLm9mZnNldEhlaWdodDtcblxuICAgIGlmICh0aGlzLmNhbWVyYSkge1xuICAgICAgdGhpcy5jYW1lcmEuYXNwZWN0ID0gY2FudmFzLndpZHRoIC8gY2FudmFzLmhlaWdodDtcbiAgICAgIHRoaXMuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZW5kZXJlcikge1xuICAgICAgLy8gbm90aWZ5IHRoZSByZW5kZXJlciBvZiB0aGUgc2l6ZSBjaGFuZ2VcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U2l6ZSggY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0ICk7XG4gICAgfVxuXG4gIH0sXG5cbiAgYW5pbWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHJlbmRlcmVyID0gdGhpcy52ck1vZGU/IHRoaXMudnJFZmZlY3QgOiB0aGlzLnJlbmRlcmVyO1xuICAgIHRoaXMudXBkYXRlQ2hpbGRyZW4oKTtcbiAgICB0aGlzLnZyQ29udHJvbHMudXBkYXRlKCk7XG4gICAgdmFyIG9yaWVudGF0aW9uID0gdGhpcy52ckNvbnRyb2xzLnN0YXRlLm9yaWVudGF0aW9uO1xuICAgIHZhciBvcmllbnRhdGlvbk1hdHJpeDtcbiAgICB2YXIgcXVhdGVybmlvbjtcbiAgICBpZiAob3JpZW50YXRpb24pIHtcbiAgICAgIHF1YXRlcm5pb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbihvcmllbnRhdGlvbi54LCAtb3JpZW50YXRpb24ueSwgb3JpZW50YXRpb24ueiwgb3JpZW50YXRpb24udyk7XG4gICAgICBvcmllbnRhdGlvbk1hdHJpeCA9IG5ldyBUSFJFRS5NYXRyaXg0KCkubWFrZVJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocXVhdGVybmlvbik7XG4gICAgICB0aGlzLnZpZXdwb3J0LnN0eWxlLnRyYW5zZm9ybSA9IHRoaXMudmlld3BvclRyYW5zZm9ybSArICcgJyArIHRoaXMuZ2V0Q1NTTWF0cml4KG9yaWVudGF0aW9uTWF0cml4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52aWV3cG9ydC5zdHlsZS50cmFuc2Zvcm0gPSB0aGlzLnZpZXdwb3JUcmFuc2Zvcm07XG4gICAgICAvL3RoaXMudmlld3BvcnQuc3R5bGUucGVyc3BlY3RpdmUgPSB0aGlzLnBlcnNwZWN0aXZlICsgJ3B4JztcbiAgICAgIC8vdGhpcy53b3JsZC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS16JywgLXRoaXMucGVyc3BlY3RpdmUpO1xuICAgIH1cbiAgICByZW5kZXJlci5yZW5kZXIodGhpcy5zY2VuZSwgdGhpcy5jYW1lcmEpO1xuICB9LFxuXG4gIGF0dHJpYnV0ZUNoYW5nZWQ6IGZ1bmN0aW9uKG5hbWUsIGZyb20sIHRvKSB7XG4gICAgaWYgKG5hbWUgPT09IFwiYW5nbGVcIikge1xuICAgICAgdGhpcy5zdHlsZS50cmFuc2Zvcm0gPSAncm90YXRlWSggJyArIHRoaXMuYW5nbGUgKyAnZGVnICknO1xuICAgIH1cbiAgfSxcblxuICBmaWx0ZXJJbnZhbGlkRGV2aWNlczogZnVuY3Rpb24oZGV2aWNlcykge1xuICAgIHZhciBvY3VsdXNEZXZpY2VzID0gZGV2aWNlcy5maWx0ZXIoZnVuY3Rpb24gKGRldmljZSkge1xuICAgICAgcmV0dXJuIGRldmljZS5kZXZpY2VOYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZignb2N1bHVzJykgIT09IC0xO1xuICAgIH0pO1xuXG4gICAgaWYgKG9jdWx1c0RldmljZXMubGVuZ3RoID49IDEpIHtcbiAgICAgIHJldHVybiBkZXZpY2VzLmZpbHRlcihmdW5jdGlvbiAoZGV2aWNlKSB7XG4gICAgICAgIHJldHVybiBkZXZpY2UuZGV2aWNlTmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ2NhcmRib2FyZCcpID09PSAtMTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZGV2aWNlcztcbiAgICB9XG4gIH0sXG5cbiAgIHByb2Nlc3NEZXZpY2VzOiBmdW5jdGlvbihkZXZpY2VzKSB7XG4gICAgICBkZXZpY2VzID0gdGhpcy5maWx0ZXJJbnZhbGlkRGV2aWNlcyhkZXZpY2VzKTtcblxuICAgICAgdmFyIGhlYWRzZXQgPSB1bmRlZmluZWQ7XG4gICAgICB2YXIgcG9zaXRpb24gPSB1bmRlZmluZWQ7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGV2aWNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgZGV2aWNlID0gZGV2aWNlc1tpXTtcbiAgICAgICAgaWYgKGRldmljZSBpbnN0YW5jZW9mIEhNRFZSRGV2aWNlKSB7XG4gICAgICAgICAgaGVhZHNldCA9IGRldmljZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGV2aWNlIGluc3RhbmNlb2YgUG9zaXRpb25TZW5zb3JWUkRldmljZSkge1xuICAgICAgICAgIHBvc2l0aW9uID0gZGV2aWNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwb3NpdGlvbiAmJiBoZWFkc2V0KSB7XG4gICAgICAgICAgdGhpcy52ciA9IHtcbiAgICAgICAgICAgIGhlYWRzZXQ6IGhlYWRzZXQsXG4gICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb25cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gIH0sXG5cbiAgZ2V0VlJEZXZpY2VzOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZiAobmF2aWdhdG9yLmdldFZSRGV2aWNlcykge1xuICAgICAgICBuYXZpZ2F0b3IuZ2V0VlJEZXZpY2VzKCkudGhlbihmdW5jdGlvbiAoZGV2aWNlcykge1xuICAgICAgICAgIHJlc29sdmUoZGV2aWNlcyk7XG4gICAgICAgIH0sIHJlamVjdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZWplY3QoJ05vIFZSIGRldmljZXMgZm91bmQuJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG5cbiAgc3RhcnRWUjogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb3pSZXF1ZXN0RnVsbFNjcmVlbih7XG4gICAgICB2ckRpc3BsYXk6IHRoaXMudnIuaGVhZHNldFxuICAgIH0pO1xuICB9LFxuXG4gIHJlc2V0U2Vuc29yOiBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy52ci5wb3NpdGlvbikge1xuICAgICAgdGhpcy52ci5wb3NpdGlvbi5yZXNldFNlbnNvcigpO1xuICAgIH1cbiAgfSxcblxuICB0ZW1wbGF0ZTogYFxuICAgIDxjYW52YXMgd2lkdGg9XCIxMDAlXCIgaGVpZ2h0PVwiMTAwJVwiPjwvY2FudmFzPlxuICAgIDxkaXYgY2xhc3M9XCJ2aWV3cG9ydFwiPlxuICAgICAgICA8Y29udGVudD48L2NvbnRlbnQ+XG4gICAgPC9kaXY+XG5cbiAgICA8c3R5bGU+XG4gICAgICA6aG9zdCB7XG4gICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgICBiYWNrZ3JvdW5kLWltYWdlOlxuICAgICAgICAgIHJhZGlhbC1ncmFkaWVudChcbiAgICAgICAgICAgICMwQjY3OTAsXG4gICAgICAgICAgICAjMTQzNjRBXG4gICAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLnZpZXdwb3J0IHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICAgIHRyYW5zZm9ybS1zdHlsZTogcHJlc2VydmUtM2Q7XG4gICAgICB9XG5cbiAgICAgIGNhbnZhcyB7XG4gICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgdG9wOiAwO1xuICAgICAgICBsZWZ0OiAwO1xuICAgICAgICB3aWR0aDogMTAwJTtcbiAgICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgfVxuICAgIDwvc3R5bGU+YFxufSk7XG5cbn0pO30pKHR5cGVvZiBkZWZpbmU9PSdmdW5jdGlvbicmJmRlZmluZS5hbWQ/ZGVmaW5lXG46KGZ1bmN0aW9uKG4sdyl7J3VzZSBzdHJpY3QnO3JldHVybiB0eXBlb2YgbW9kdWxlPT0nb2JqZWN0Jz9mdW5jdGlvbihjKXtcbmMocmVxdWlyZSxleHBvcnRzLG1vZHVsZSk7fTpmdW5jdGlvbihjKXt2YXIgbT17ZXhwb3J0czp7fX07YyhmdW5jdGlvbihuKXtcbnJldHVybiB3W25dO30sbS5leHBvcnRzLG0pO3dbbl09bS5leHBvcnRzO307fSkoJ1ZSU0NlbmUnLHRoaXMpKTtcbiIsIi8qIGdsb2JhbHMgZGVmaW5lICovXG4oZnVuY3Rpb24oZGVmaW5lKXsndXNlIHN0cmljdCc7ZGVmaW5lKGZ1bmN0aW9uKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpe1xuXG4vKipcbiAqIERlcGVuZGVuY2llc1xuICovXG5cbnZhciBjb21wb25lbnQgPSByZXF1aXJlKCdnYWlhLWNvbXBvbmVudCcpO1xuXG4vKipcbiAqIFNpbXBsZSBsb2dnZXJcbiAqIEB0eXBlIHtGdW5jdGlvbn1cbiAqL1xudmFyIGRlYnVnID0gMCA/IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSkgOiBmdW5jdGlvbigpIHt9O1xuXG4vKipcbiAqIEV4cG9ydHNcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNvbXBvbmVudC5yZWdpc3RlcigndnItb2JqZWN0Jywge1xuICBleHRlbmRzOiBIVE1MRGl2RWxlbWVudC5wcm90b3R5cGUsXG5cbiAgY3JlYXRlZDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXR1cFNoYWRvd1Jvb3QoKTtcbiAgICB0aGlzLmZpbmRTY2VuZSgpO1xuICAgIHRoaXMuc2NlbmUuYWRkT2JqZWN0KHRoaXMpO1xuICAgIHRoaXMudXBkYXRlVHJhbnNmb3JtKCk7XG4gICAgLy90aGlzLnJlcG9ydFNpemUoKTtcbiAgfSxcblxuICBnZXRDaGlsZHJlbjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZE5vZGVzO1xuICAgIHZhciBvYmpzID0gW107XG4gICAgdmFyIGk7XG4gICAgdmFyIGNoaWxkO1xuICAgIGZvciAoaT0wOyBpPGNoaWxkcmVuLmxlbmd0aDsgKytpKSB7XG4gICAgICBjaGlsZCA9IGNoaWxkcmVuW2ldO1xuICAgICAgaWYgKGNoaWxkLnRhZ05hbWUgPT09IFwiVlItT0JKRUNUXCIpIHtcbiAgICAgICAgb2Jqcy5wdXNoKGNoaWxkKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9ianM7XG4gIH0sXG5cbiAgdXBkYXRlU2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGVsUmVjdDtcbiAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmdldENoaWxkcmVuKCk7XG4gICAgdmFyIHJlY3QgPSB7fTtcbiAgICB2YXIgaTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICAgIGVsUmVjdCA9IGNoaWxkcmVuW2ldLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgaWYgKHR5cGVvZiByZWN0LnRvcCA9PT0gJ3VuZGVmaW5lZCcgfHxcbiAgICAgICAgICBlbFJlY3QudG9wIDwgcmVjdC50b3ApIHtcbiAgICAgICAgcmVjdC50b3AgPSBlbFJlY3QudG9wO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGVvZiByZWN0LmxlZnQgPT09ICd1bmRlZmluZWQnIHx8XG4gICAgICAgICAgZWxSZWN0LmxlZnQgPCByZWN0LmxlZnQpIHtcbiAgICAgICAgcmVjdC5sZWZ0ID0gZWxSZWN0LmxlZnQ7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIHJlY3QuYm90dG9tID09PSAndW5kZWZpbmVkJyB8fFxuICAgICAgICAgIGVsUmVjdC5ib3R0b20gPiByZWN0LmJvdHRvbSkge1xuICAgICAgICByZWN0LmJvdHRvbSA9IGVsUmVjdC5ib3R0b207XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIHJlY3QucmlnaHQgPT09ICd1bmRlZmluZWQnIHx8XG4gICAgICAgICBlbFJlY3QucmlnaHQgPiByZWN0LnJpZ2h0KSB7XG4gICAgICAgIHJlY3QucmlnaHQgPSBlbFJlY3QucmlnaHQ7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuc3R5bGUudG9wID0gcmVjdC50b3A7XG4gICAgdGhpcy5zdHlsZS5sZWZ0ID0gcmVjdC5sZWZ0O1xuICAgIHRoaXMuc3R5bGUud2lkdGggPSAocmVjdC5yaWdodCAtIHJlY3QubGVmdCkgKyAncHgnO1xuICAgIHRoaXMuc3R5bGUuaGVpZ2h0ID0gKHJlY3QuYm90dG9tIC0gcmVjdC50b3ApICsgJ3B4JztcbiAgICAvL3RoaXMucmVwb3J0U2l6ZSgpO1xuICAgIHJldHVybiByZWN0O1xuICB9LFxuXG4gIHJlcG9ydFNpemU6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLnBhcmVudE5vZGUgJiYgdGhpcy5wYXJlbnROb2RlLnRhZ05hbWUgPT09IFwiVlItT0JKRUNUXCIpIHtcbiAgICAgIHRoaXMucGFyZW50Tm9kZS51cGRhdGVTaXplKCk7XG4gICAgfVxuICB9LFxuXG4gIGF0dHJpYnV0ZUNoYW5nZWQ6IGZ1bmN0aW9uKG5hbWUsIGZyb20sIHRvKSB7XG4gICAgdGhpcy51cGRhdGVUcmFuc2Zvcm0oKTtcbiAgfSxcblxuICBlcHNpbG9uOiBmdW5jdGlvbiAoIHZhbHVlICkge1xuICAgIHJldHVybiBNYXRoLmFicyggdmFsdWUgKSA8IDAuMDAwMDAxID8gMCA6IHZhbHVlO1xuICB9LFxuXG4gIHVwZGF0ZTogZnVuY3Rpb24oKSB7IC8qIE5PT1AgKi8gfSxcblxuICB1cGRhdGVDaGlsZHJlbjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNoaWxkO1xuICAgIHZhciBpO1xuICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgKytpKSB7XG4gICAgICBjaGlsZCA9IHRoaXMuY2hpbGRyZW5baV07XG4gICAgICBpZiAodHlwZW9mIGNoaWxkLnVwZGF0ZSA9PSAnZnVuY3Rpb24nKSB7IGNoaWxkLnVwZGF0ZSgpOyB9XG4gICAgICBpZiAodHlwZW9mIGNoaWxkLnVwZGF0ZUNoaWxkcmVuID09ICdmdW5jdGlvbicpIHsgY2hpbGQudXBkYXRlQ2hpbGRyZW4oKTsgfVxuICAgIH1cbiAgfSxcblxuICBnZXRDU1NNYXRyaXg6IGZ1bmN0aW9uIChtYXRyaXgpIHtcbiAgICB2YXIgZXBzaWxvbiA9IHRoaXMuZXBzaWxvbjtcbiAgICB2YXIgZWxlbWVudHMgPSBtYXRyaXguZWxlbWVudHM7XG5cbiAgICByZXR1cm4gJ21hdHJpeDNkKCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDAgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyAxIF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgMiBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDMgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyA0IF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgNSBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDYgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyA3IF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgOCBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDkgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyAxMCBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDExIF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgMTIgXSApICsgJywnICtcbiAgICAgIGVwc2lsb24oIGVsZW1lbnRzWyAxMyBdICkgKyAnLCcgK1xuICAgICAgZXBzaWxvbiggZWxlbWVudHNbIDE0IF0gKSArICcsJyArXG4gICAgICBlcHNpbG9uKCBlbGVtZW50c1sgMTUgXSApICtcbiAgICAnKSc7XG4gIH0sXG5cbiAgLy8gSWYgbm90IGRlZmluZWQgdGhlc2UgdmFyaWFibGVzIERPIE5PVFxuICAvLyBjYXNjYWRlIGZyb20gdGhlIHBhcmVudFxuICBub3RQcm9wYWdhdGluZ1ZhcmlhYmxlczoge1xuICAgIFwiLS14XCI6IHRydWUsXG4gICAgXCItLXlcIjogdHJ1ZSxcbiAgICBcIi0telwiOiB0cnVlLFxuICAgIFwiLS1yb3RYXCI6IHRydWUsXG4gICAgXCItLXJvdFlcIjogdHJ1ZSxcbiAgICBcIi0tcm90WlwiOiB0cnVlXG4gIH0sXG5cbiAgZ2V0UHJvcGVydHlWYWx1ZTogZnVuY3Rpb24ocHJvcGVydHkpIHtcbiAgICB2YXIgc3R5bGUgPSB0aGlzLm5vdFByb3BhZ2F0aW5nVmFyaWFibGVzW3Byb3BlcnR5XT9cbiAgICAgIHRoaXMuc3R5bGUgOiB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzKTtcbiAgICByZXR1cm4gc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZShwcm9wZXJ0eSk7XG4gIH0sXG5cbiAgdXBkYXRlVHJhbnNmb3JtOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcHJldmlvdXNQb3NpdGlvbiA9IHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IHRoaXMucHJldmlvdXNQb3NpdGlvbiB8fCB7fTtcbiAgICAvLyBQb3NpdGlvblxuICAgIHZhciB4ID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BlcnR5VmFsdWUoJy0teCcpKSB8fCAwO1xuICAgIHZhciB5ID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BlcnR5VmFsdWUoJy0teScpKSB8fCAwO1xuICAgIHZhciB6ID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BlcnR5VmFsdWUoJy0teicpKSB8fCAwO1xuICAgIHZhciB0cmFuc2xhdGlvbiA9IG5ldyBUSFJFRS5NYXRyaXg0KCkubWFrZVRyYW5zbGF0aW9uKHgsIHksIC16KTtcblxuICAgIC8vIE9yaWVudGF0aW9uXG4gICAgdmFyIG9yaWVudGF0aW9uWCA9IHBhcnNlRmxvYXQodGhpcy5nZXRQcm9wZXJ0eVZhbHVlKCctLXJvdFgnKSkgfHwgMDtcbiAgICB2YXIgb3JpZW50YXRpb25ZID0gcGFyc2VGbG9hdCh0aGlzLmdldFByb3BlcnR5VmFsdWUoJy0tcm90WScpKSB8fCAwO1xuICAgIHZhciBvcmllbnRhdGlvblogPSBwYXJzZUZsb2F0KHRoaXMuZ2V0UHJvcGVydHlWYWx1ZSgnLS1yb3RaJykpIHx8IDA7XG5cbiAgICB2YXIgcm90WCA9IFRIUkVFLk1hdGguZGVnVG9SYWQob3JpZW50YXRpb25YKTtcbiAgICB2YXIgcm90WSA9IFRIUkVFLk1hdGguZGVnVG9SYWQob3JpZW50YXRpb25ZKTtcbiAgICB2YXIgcm90WiA9IFRIUkVFLk1hdGguZGVnVG9SYWQob3JpZW50YXRpb25aKTtcbiAgICB2YXIgcm90YXRpb25YID0gbmV3IFRIUkVFLk1hdHJpeDQoKS5tYWtlUm90YXRpb25YKHJvdFgpO1xuICAgIHZhciByb3RhdGlvblkgPSBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvblkocm90WSk7XG4gICAgdmFyIHJvdGF0aW9uWiA9IG5ldyBUSFJFRS5NYXRyaXg0KCkubWFrZVJvdGF0aW9uWihyb3RaKTtcbiAgICB0aGlzLnN0eWxlLnRyYW5zZm9ybSA9IFwidHJhbnNsYXRlM2QoLTUwJSwgLTUwJSwgMCkgXCIgKyB0aGlzLmdldENTU01hdHJpeCh0cmFuc2xhdGlvbi5tdWx0aXBseShyb3RhdGlvbloubXVsdGlwbHkocm90YXRpb25ZLm11bHRpcGx5KHJvdGF0aW9uWCkpKSk7XG4gICAgdGhpcy5vYmplY3QzRC5wb3NpdGlvbi5zZXQoeCwgLXksIC16KTtcbiAgICB0aGlzLm9iamVjdDNELnJvdGF0aW9uLm9yZGVyID0gJ1lYWic7XG4gICAgdGhpcy5vYmplY3QzRC5yb3RhdGlvbi5zZXQoLXJvdFgsIHJvdFksIHJvdFopO1xuXG4gICAgLy8gUmVwb3J0IHBvc2l0aW9uPyBPbmx5IGlmIGNoYW5nZWRcbiAgICAvLyBpZiAoeCAhPT0gcHJldmlvdXNQb3NpdGlvbi54IHx8XG4gICAgLy8gICAgIHkgIT09IHByZXZpb3VzUG9zaXRpb24ueSB8fFxuICAgIC8vICAgICB6ICE9PSBwcmV2aW91c1Bvc2l0aW9uLnogKSB7XG4gICAgLy8gICBkZWJ1Z2dlcjtcbiAgICAvLyAgIHRoaXMucmVwb3J0U2l6ZSgpO1xuICAgIC8vICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uID0ge1xuICAgIC8vICAgICB4OiB4LFxuICAgIC8vICAgICB5OiB5LFxuICAgIC8vICAgICB6OiB6XG4gICAgLy8gICB9O1xuICAgIC8vIH1cbiAgfSxcblxuICBmaW5kU2NlbmU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzY2VuZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCd2ci1zY2VuZScpO1xuICAgIHZhciBwZXJzcGVjdGl2ZTtcbiAgICBmb3IgKHZhciBpPTA7IGkgPCBzY2VuZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZXNbaV07XG4gICAgfVxuICB9LFxuXG4gIHRlbXBsYXRlOiBgXG4gICAgPGNvbnRlbnQ+PC9jb250ZW50PlxuICAgIDxzdHlsZT5cbiAgICAgIDpob3N0IHtcbiAgICAgICAgbGVmdDogNTAlO1xuICAgICAgICB0b3A6IDUwJTtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICB0cmFuc2Zvcm0tc3R5bGU6IHByZXNlcnZlLTNkO1xuICAgICAgfVxuICAgIDwvc3R5bGU+XG4gIGBcbn0pO1xuXG59KTt9KSh0eXBlb2YgZGVmaW5lPT0nZnVuY3Rpb24nJiZkZWZpbmUuYW1kP2RlZmluZVxuOihmdW5jdGlvbihuLHcpeyd1c2Ugc3RyaWN0JztyZXR1cm4gdHlwZW9mIG1vZHVsZT09J29iamVjdCc/ZnVuY3Rpb24oYyl7XG5jKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpO306ZnVuY3Rpb24oYyl7dmFyIG09e2V4cG9ydHM6e319O2MoZnVuY3Rpb24obil7XG5yZXR1cm4gd1tuXTt9LG0uZXhwb3J0cyxtKTt3W25dPW0uZXhwb3J0czt9O30pKCdWUk9iamVjdCcsdGhpcykpO1xuIiwiLyogZ2xvYmFscyBkZWZpbmUgKi9cbihmdW5jdGlvbihkZWZpbmUpeyd1c2Ugc3RyaWN0JztkZWZpbmUoZnVuY3Rpb24ocmVxdWlyZSxleHBvcnRzLG1vZHVsZSl7XG5cbi8qKlxuICogRGVwZW5kZW5jaWVzXG4gKi9cblxudmFyIGNvbXBvbmVudCA9IHJlcXVpcmUoJ2dhaWEtY29tcG9uZW50Jyk7XG5cbi8qKlxuICogU2ltcGxlIGxvZ2dlclxuICogQHR5cGUge0Z1bmN0aW9ufVxuICovXG52YXIgZGVidWcgPSAwID8gY29uc29sZS5sb2cuYmluZChjb25zb2xlKSA6IGZ1bmN0aW9uKCkge307XG5cbi8qKlxuICogRXhwb3J0c1xuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY29tcG9uZW50LnJlZ2lzdGVyKCd2ci1jYW1lcmEnLCB7XG4gIGV4dGVuZHM6IFZST2JqZWN0LnByb3RvdHlwZSxcblxuICB1cGRhdGVUcmFuc2Zvcm06IGZ1bmN0aW9uKCkge1xuICAgIHZhciBlbFN0eWxlcyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMpO1xuICAgIC8vIFBvc2l0aW9uXG4gICAgdmFyIHggPSBwYXJzZUZsb2F0KHRoaXMuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS14JykpIHx8IDA7XG4gICAgdmFyIHkgPSBwYXJzZUZsb2F0KHRoaXMuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS15JykpIHx8IDA7XG4gICAgdmFyIHogPSBwYXJzZUZsb2F0KHRoaXMuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS16JykpIHx8IDA7XG4gICAgdmFyIHRyYW5zbGF0aW9uID0gbmV3IFRIUkVFLk1hdHJpeDQoKS5tYWtlVHJhbnNsYXRpb24oeCwgeSwgLXopO1xuXG4gICAgLy8gT3JpZW50YXRpb25cbiAgICB2YXIgb3JpZW50YXRpb25YID0gcGFyc2VGbG9hdCh0aGlzLnN0eWxlLmdldFByb3BlcnR5VmFsdWUoJy0tcm90WCcpKSB8fCAwO1xuICAgIHZhciBvcmllbnRhdGlvblkgPSBwYXJzZUZsb2F0KHRoaXMuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS1yb3RZJykpIHx8IDA7XG4gICAgdmFyIG9yaWVudGF0aW9uWiA9IHBhcnNlRmxvYXQodGhpcy5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCctLXJvdFonKSkgfHwgMDtcblxuICAgIHZhciByb3RYID0gVEhSRUUuTWF0aC5kZWdUb1JhZChvcmllbnRhdGlvblgpO1xuICAgIHZhciByb3RZID0gVEhSRUUuTWF0aC5kZWdUb1JhZChvcmllbnRhdGlvblkpO1xuICAgIHZhciByb3RaID0gVEhSRUUuTWF0aC5kZWdUb1JhZChvcmllbnRhdGlvblopO1xuICAgIHZhciByb3RhdGlvblggPSBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvblgocm90WCk7XG4gICAgdmFyIHJvdGF0aW9uWSA9IG5ldyBUSFJFRS5NYXRyaXg0KCkubWFrZVJvdGF0aW9uWShyb3RZKTtcbiAgICB2YXIgcm90YXRpb25aID0gbmV3IFRIUkVFLk1hdHJpeDQoKS5tYWtlUm90YXRpb25aKHJvdFopO1xuICAgIHZhciBtYXRyaXhDU1MgPSByb3RhdGlvbloubXVsdGlwbHkocm90YXRpb25ZLm11bHRpcGx5KHJvdGF0aW9uWC5tdWx0aXBseSh0cmFuc2xhdGlvbikpKTtcblxuICAgIHRoaXMuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKC01MCUsIC01MCUsIDApICcgKyB0aGlzLmdldENTU01hdHJpeChtYXRyaXhDU1MpO1xuXG4gICAgLy8gTWF0cml4IHRocmVlanNcbiAgICByb3RhdGlvblggPSBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvblgoLXJvdFgpO1xuICAgIHJvdGF0aW9uWSA9IG5ldyBUSFJFRS5NYXRyaXg0KCkubWFrZVJvdGF0aW9uWShyb3RZKTtcbiAgICByb3RhdGlvblogPSBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvblgocm90Wik7XG4gICAgdHJhbnNsYXRpb24gPSBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VUcmFuc2xhdGlvbih4LCAteSwgLXopO1xuICAgIHZhciBtYXRyaXggPSByb3RhdGlvbloubXVsdGlwbHkocm90YXRpb25ZLm11bHRpcGx5KHJvdGF0aW9uWC5tdWx0aXBseSh0cmFuc2xhdGlvbikpKTtcblxuICAgIHZhciBvYmplY3QzRCA9IHRoaXMub2JqZWN0M0Q7XG4gICAgb2JqZWN0M0QubWF0cml4ID0gbWF0cml4O1xuICAgIG9iamVjdDNELm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTtcbiAgICBvYmplY3QzRC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTtcbiAgfVxuXG59KTtcblxufSk7fSkodHlwZW9mIGRlZmluZT09J2Z1bmN0aW9uJyYmZGVmaW5lLmFtZD9kZWZpbmVcbjooZnVuY3Rpb24obix3KXsndXNlIHN0cmljdCc7cmV0dXJuIHR5cGVvZiBtb2R1bGU9PSdvYmplY3QnP2Z1bmN0aW9uKGMpe1xuYyhyZXF1aXJlLGV4cG9ydHMsbW9kdWxlKTt9OmZ1bmN0aW9uKGMpe3ZhciBtPXtleHBvcnRzOnt9fTtjKGZ1bmN0aW9uKG4pe1xucmV0dXJuIHdbbl07fSxtLmV4cG9ydHMsbSk7d1tuXT1tLmV4cG9ydHM7fTt9KSgnVlJDYW1lcmEnLHRoaXMpKTtcbiIsIi8qIGdsb2JhbHMgZGVmaW5lICovXG4oZnVuY3Rpb24oZGVmaW5lKXsndXNlIHN0cmljdCc7ZGVmaW5lKGZ1bmN0aW9uKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpe1xuXG4vKipcbiAqIERlcGVuZGVuY2llc1xuICovXG5cbnZhciBjb21wb25lbnQgPSByZXF1aXJlKCdnYWlhLWNvbXBvbmVudCcpO1xuXG4vKipcbiAqIFNpbXBsZSBsb2dnZXJcbiAqIEB0eXBlIHtGdW5jdGlvbn1cbiAqL1xudmFyIGRlYnVnID0gMCA/IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSkgOiBmdW5jdGlvbigpIHt9O1xuXG4vKipcbiAqIEV4cG9ydHNcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNvbXBvbmVudC5yZWdpc3RlcigndnItbW9kZWwnLCB7XG4gIGV4dGVuZHM6IFZST2JqZWN0LnByb3RvdHlwZSxcblxuICBjcmVhdGVkOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldHVwU2NlbmUoKTtcbiAgICBWUk9iamVjdC5wcm90b3R5cGUuY3JlYXRlZC5jYWxsKHRoaXMpO1xuICB9LFxuXG4gIHNldHVwU2NlbmU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKHsgY29sb3I6ICdtYWdlbnRhJyB9KTtcbiAgICB2YXIgbW9kZWwgPSB0aGlzLm1vZGVsID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkJveEdlb21ldHJ5KDI1MCwgMjUwLCAyNTApLCBtYXRlcmlhbCk7XG4gICAgdmFyIHggPSB0aGlzLnN0eWxlLmdldFByb3BlcnR5VmFsdWUoJy0teCcpIHx8IDA7XG4gICAgdmFyIHkgPSB0aGlzLnN0eWxlLmdldFByb3BlcnR5VmFsdWUoJy0teScpIHx8IDA7XG4gICAgdmFyIHogPSB0aGlzLnN0eWxlLmdldFByb3BlcnR5VmFsdWUoJy0teicpO1xuICAgIHRoaXMucmF5Y2FzdGVyID0gbmV3IFRIUkVFLlJheWNhc3RlcigpO1xuICAgIG1vZGVsLm92ZXJkcmF3ID0gdHJ1ZTtcbiAgICBtb2RlbC5wb3NpdGlvbi5zZXQoeCwgeSwgLXopO1xuICAgIHRoaXMub2JqZWN0M0QgPSBtb2RlbDtcbiAgICB0aGlzLmF0dGFjaENsaWNrSGFuZGxlcigpO1xuICAgIC8vdGhpcy5hbmltYXRlKCk7XG4gIH0sXG5cbiAgYXR0YWNoQ2xpY2tIYW5kbGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5tb3VzZVBvcyA9IG5ldyBUSFJFRS5WZWN0b3IyKDAsIDApO1xuICAgIC8vdGhpcy5zY2VuZS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZWQsIGZhbHNlKTtcbiAgICAvL2RvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdtb3VzZWRvd24nLCBvbkRvY3VtZW50TW91c2VEb3duLCBmYWxzZSApO1xuXG4gICAgZnVuY3Rpb24gb25Nb3VzZU1vdmVkICggZSApIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHNlbGYubW91c2VQb3MueCA9ICggZS5jbGllbnRYIC8gd2luZG93LmlubmVyV2lkdGggKSAqIDIgLSAxO1xuICAgICAgc2VsZi5tb3VzZVBvcy55ID0gLSAoIGUuY2xpZW50WSAvIHdpbmRvdy5pbm5lckhlaWdodCApICogMiArIDE7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb25Eb2N1bWVudE1vdXNlRG93biggZSApIHtcbiAgICAgIGlmIChzZWxmLmludGVyc2VjdGVkKSB7XG4gICAgICAgIHNlbGYuZXhwbG9kZSgpO1xuICAgICAgfVxuICAgICAgLy8gZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgLy8gdmFyIG1vdXNlVmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcbiAgICAgIC8vIG1vdXNlVmVjdG9yLnggPSAyICogKGUuY2xpZW50WCAvIFNDUkVFTl9XSURUSCkgLSAxO1xuICAgICAgLy8gbW91c2VWZWN0b3IueSA9IDEgLSAyICogKCBlLmNsaWVudFkgLyBTQ1JFRU5fSEVJR0hUICk7XG4gICAgICAvLyB2YXIgcmF5Y2FzdGVyID0gcHJvamVjdG9yLnBpY2tpbmdSYXkoIG1vdXNlVmVjdG9yLmNsb25lKCksIGNhbWVyYSApO1xuICAgICAgLy8gdmFyIGludGVyc2VjdHMgPSByYXljYXN0ZXIuaW50ZXJzZWN0T2JqZWN0KCBUQVJHRVQgKTtcbiAgICAgIC8vIGZvciggdmFyIGkgPSAwOyBpIDwgaW50ZXJzZWN0cy5sZW5ndGg7IGkrKyApIHtcbiAgICAgIC8vICAgdmFyIGludGVyc2VjdGlvbiA9IGludGVyc2VjdHNbIGkgXSxcbiAgICAgIC8vICAgb2JqID0gaW50ZXJzZWN0aW9uLm9iamVjdDtcbiAgICAgIC8vICAgY29ucyBvbGUubG9nKFwiSW50ZXJzZWN0ZWQgb2JqZWN0XCIsIG9iaik7XG4gICAgICAvLyB9XG4gICAgfVxuICB9LFxuXG4gIGV4cGxvZGU6IGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIGJveCA9IHRoaXMub2JqZWN0M0Q7XG4gICAgdmFyIHNjZW5lID0gdGhpcy5zY2VuZTtcbiAgICB2YXIgZHVyYXRpb24gPSA4MDAwO1xuICAgIHRoaXMuZXhwbG9kaW5nID0gdHJ1ZTtcblxuICAgIC8vIGV4cGxvZGUgZ2VvbWV0cnkgaW50byBvYmplY3RzXG4gICAgdmFyIHBpZWNlcyA9IGV4cGxvZGUoIGJveC5nZW9tZXRyeSwgYm94Lm1hdGVyaWFsICk7XG5cbiAgICBib3gubWF0ZXJpYWwudmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgLy8gYW5pbWF0ZSBvYmplY3RzXG4gICAgZm9yICggdmFyIGkgPSAwOyBpIDwgcGllY2VzLmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHtcblxuICAgICAgdmFyIG9iamVjdCA9IHBpZWNlcy5jaGlsZHJlblsgaSBdO1xuXG4gICAgICBvYmplY3QuZ2VvbWV0cnkuY29tcHV0ZUZhY2VOb3JtYWxzKCk7XG4gICAgICB2YXIgbm9ybWFsID0gb2JqZWN0Lmdlb21ldHJ5LmZhY2VzWzBdLm5vcm1hbC5jbG9uZSgpO1xuICAgICAgdmFyIHRhcmdldFBvc2l0aW9uID0gb2JqZWN0LnBvc2l0aW9uLmNsb25lKCkuYWRkKCBub3JtYWwubXVsdGlwbHlTY2FsYXIoIDMwMDAgKSApO1xuICAgICAgLy9yZW1vdmVCb3hGcm9tTGlzdCggYm94ICk7XG4gICAgICBuZXcgVFdFRU4uVHdlZW4oIG9iamVjdC5wb3NpdGlvbiApXG4gICAgICAgIC50byggdGFyZ2V0UG9zaXRpb24sIGR1cmF0aW9uIClcbiAgICAgICAgLm9uQ29tcGxldGUoIGRlbGV0ZUJveCApXG4gICAgICAgIC5zdGFydCgpO1xuXG4gICAgICBvYmplY3QubWF0ZXJpYWwub3BhY2l0eSA9IDA7XG4gICAgICBuZXcgVFdFRU4uVHdlZW4oIG9iamVjdC5tYXRlcmlhbCApXG4gICAgICAgIC50byggeyBvcGFjaXR5OiAxIH0sIGR1cmF0aW9uIClcbiAgICAgICAgLnN0YXJ0KCk7XG5cbiAgICAgIHZhciByb3RhdGlvbiA9IDIgKiBNYXRoLlBJO1xuICAgICAgdmFyIHRhcmdldFJvdGF0aW9uID0geyB4OiByb3RhdGlvbiwgeTogcm90YXRpb24sIHo6cm90YXRpb24gfTtcbiAgICAgIG5ldyBUV0VFTi5Ud2Vlbiggb2JqZWN0LnJvdGF0aW9uIClcbiAgICAgICAgLnRvKCB0YXJnZXRSb3RhdGlvbiwgZHVyYXRpb24gKVxuICAgICAgICAuc3RhcnQoKTtcblxuICAgIH1cblxuICAgIGJveC5hZGQoIHBpZWNlcyApO1xuXG4gICAgZnVuY3Rpb24gcmVtb3ZlQm94RnJvbUxpc3QoIGJveCApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2JqZWN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAob2JqZWN0c1tpXSA9PT0gYm94KSB7XG4gICAgICAgICAgb2JqZWN0cy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGVsZXRlQm94KCkge1xuICAgICAgYm94LnJlbW92ZSggcGllY2VzIClcbiAgICAgIC8vc2NlbmUucmVtb3ZlKCBib3ggKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleHBsb2RlKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKSB7XG5cbiAgICAgIHZhciBwaWVjZXMgPSBuZXcgVEhSRUUuR3JvdXAoKTtcbiAgICAgIHZhciBtYXRlcmlhbCA9IG1hdGVyaWFsLmNsb25lKCk7XG4gICAgICBtYXRlcmlhbC5zaWRlID0gVEhSRUUuRG91YmxlU2lkZTtcblxuICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZ2VvbWV0cnkuZmFjZXMubGVuZ3RoOyBpICsrICkge1xuXG4gICAgICAgIHZhciBmYWNlID0gZ2VvbWV0cnkuZmFjZXNbIGkgXTtcblxuICAgICAgICB2YXIgdmVydGV4QSA9IGdlb21ldHJ5LnZlcnRpY2VzWyBmYWNlLmEgXS5jbG9uZSgpO1xuICAgICAgICB2YXIgdmVydGV4QiA9IGdlb21ldHJ5LnZlcnRpY2VzWyBmYWNlLmIgXS5jbG9uZSgpO1xuICAgICAgICB2YXIgdmVydGV4QyA9IGdlb21ldHJ5LnZlcnRpY2VzWyBmYWNlLmMgXS5jbG9uZSgpO1xuXG4gICAgICAgIHZhciBnZW9tZXRyeTIgPSBuZXcgVEhSRUUuR2VvbWV0cnkoKTtcbiAgICAgICAgZ2VvbWV0cnkyLnZlcnRpY2VzLnB1c2goIHZlcnRleEEsIHZlcnRleEIsIHZlcnRleEMgKTtcbiAgICAgICAgZ2VvbWV0cnkyLmZhY2VzLnB1c2goIG5ldyBUSFJFRS5GYWNlMyggMCwgMSwgMiApICk7XG5cbiAgICAgICAgdmFyIG1lc2ggPSBuZXcgVEhSRUUuTWVzaCggZ2VvbWV0cnkyLCBtYXRlcmlhbCApO1xuICAgICAgICBtZXNoLnBvc2l0aW9uLnN1YiggZ2VvbWV0cnkyLmNlbnRlcigpICk7XG4gICAgICAgIHBpZWNlcy5hZGQoIG1lc2ggKTtcblxuICAgICAgfVxuXG4gICAgICAvL3NvcnQgdGhlIHBpZWNlc1xuICAgICAgcGllY2VzLmNoaWxkcmVuLnNvcnQoIGZ1bmN0aW9uICggYSwgYiApIHtcblxuICAgICAgICByZXR1cm4gYS5wb3NpdGlvbi56IC0gYi5wb3NpdGlvbi56O1xuICAgICAgICAvL3JldHVybiBhLnBvc2l0aW9uLnggLSBiLnBvc2l0aW9uLng7ICAgICAvLyBzb3J0IHhcbiAgICAgICAgLy9yZXR1cm4gYi5wb3NpdGlvbi55IC0gYS5wb3NpdGlvbi55OyAgIC8vIHNvcnQgeVxuXG4gICAgICB9ICk7XG5cbiAgICAgIHBpZWNlcy5yb3RhdGlvbi5zZXQoIDAsIDAsIDAgKVxuXG4gICAgICByZXR1cm4gcGllY2VzO1xuXG4gICAgfVxuXG4gIH0sXG5cbiAgYW5pbWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBsYXN0VGltZSA9IHNlbGYubGFzdFRpbWUgfHwgMDtcbiAgICB2YXIgYW5ndWxhclNwZWVkID0gc2VsZi5hbmd1bGFyU3BlZWQgfHwgMC4yO1xuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHtcbiAgICAgIHNlbGYuYW5pbWF0ZSgpO1xuICAgICAgVFdFRU4udXBkYXRlKCk7XG4gICAgfSk7XG5cbiAgICBpZiAoIXRoaXMuZXhwbG9kaW5nKSB7XG4gICAgICB2YXIgdGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG4gICAgICB2YXIgdGltZURpZmYgPSB0aW1lIC0gbGFzdFRpbWU7XG4gICAgICB2YXIgYW5nbGVDaGFuZ2UgPSBhbmd1bGFyU3BlZWQgKiB0aW1lRGlmZiAqIDIgKiBNYXRoLlBJIC8gMTAwMDtcbiAgICAgIHNlbGYubW9kZWwucm90YXRpb24ueSArPSBhbmdsZUNoYW5nZTtcbiAgICAgIHNlbGYubGFzdFRpbWUgPSB0aW1lO1xuICAgICAgLy90aGlzLmludGVyc2VjdE1vdXNlKCk7XG4gICAgfVxuICB9LFxuXG4gIC8vIGZpbmQgaW50ZXJzZWN0aW9uc1xuICBpbnRlcnNlY3RNb3VzZTogZnVuY3Rpb24gaW50ZXJzZWN0KCkge1xuICAgIHZhciByYXljYXN0ZXIgPSB0aGlzLnJheWNhc3RlcjtcbiAgICB2YXIgb2JqZWN0cyA9IFt0aGlzLm9iamVjdDNEXTtcbiAgICByYXljYXN0ZXIuc2V0RnJvbUNhbWVyYSggdGhpcy5tb3VzZVBvcywgdGhpcy5zY2VuZS5jYW1lcmEgKTtcbiAgICB2YXIgaW50ZXJzZWN0cyA9IHJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3RzKCBvYmplY3RzICk7XG5cbiAgICBpZiAoIGludGVyc2VjdHMubGVuZ3RoID4gMCApIHtcblxuICAgICAgaWYgKCB0aGlzLm9iamVjdDNEID09IGludGVyc2VjdHNbIDAgXS5vYmplY3QgJiYgIXRoaXMuaW50ZXJzZWN0ZWQpIHtcblxuICAgICAgICB0aGlzLmludGVyc2VjdGVkID0gdGhpcy5vYmplY3QzRC5tYXRlcmlhbC5lbWlzc2l2ZS5nZXRIZXgoKTtcbiAgICAgICAgdGhpcy5vYmplY3QzRC5tYXRlcmlhbC5lbWlzc2l2ZS5zZXRIZXgoIDB4ZmZmZjAwICk7XG5cbiAgICAgIH1cblxuICAgIH0gZWxzZSB7XG5cbiAgICAgIGlmICggdGhpcy5pbnRlcnNlY3RlZCApIHRoaXMub2JqZWN0M0QubWF0ZXJpYWwuZW1pc3NpdmUuc2V0KCAnYmxhY2snICk7XG4gICAgICB0aGlzLmludGVyc2VjdGVkID0gbnVsbDtcblxuICAgIH1cbiAgfVxuXG59KTtcblxufSk7fSkodHlwZW9mIGRlZmluZT09J2Z1bmN0aW9uJyYmZGVmaW5lLmFtZD9kZWZpbmVcbjooZnVuY3Rpb24obix3KXsndXNlIHN0cmljdCc7cmV0dXJuIHR5cGVvZiBtb2R1bGU9PSdvYmplY3QnP2Z1bmN0aW9uKGMpe1xuYyhyZXF1aXJlLGV4cG9ydHMsbW9kdWxlKTt9OmZ1bmN0aW9uKGMpe3ZhciBtPXtleHBvcnRzOnt9fTtjKGZ1bmN0aW9uKG4pe1xucmV0dXJuIHdbbl07fSxtLmV4cG9ydHMsbSk7d1tuXT1tLmV4cG9ydHM7fTt9KSgnVlJNb2RlbCcsdGhpcykpO1xuIiwiLyogZ2xvYmFscyBkZWZpbmUgKi9cbihmdW5jdGlvbihkZWZpbmUpeyd1c2Ugc3RyaWN0JztkZWZpbmUoZnVuY3Rpb24ocmVxdWlyZSxleHBvcnRzLG1vZHVsZSl7XG5cbi8qKlxuICogRGVwZW5kZW5jaWVzXG4gKi9cblxudmFyIGNvbXBvbmVudCA9IHJlcXVpcmUoJ2dhaWEtY29tcG9uZW50Jyk7XG5cbi8qKlxuICogU2ltcGxlIGxvZ2dlclxuICogQHR5cGUge0Z1bmN0aW9ufVxuICovXG52YXIgZGVidWcgPSAwID8gY29uc29sZS5sb2cuYmluZChjb25zb2xlKSA6IGZ1bmN0aW9uKCkge307XG5cbi8qKlxuICogRXhwb3J0c1xuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY29tcG9uZW50LnJlZ2lzdGVyKCd2ci1iaWxsYm9hcmQnLCB7XG4gIGV4dGVuZHM6IFZST2JqZWN0LnByb3RvdHlwZSxcblxuICBjcmVhdGVkOiBmdW5jdGlvbigpIHtcbiAgICBWUk9iamVjdC5wcm90b3R5cGUuY3JlYXRlZC5jYWxsKHRoaXMpO1xuICAgIHRoaXMudXBkYXRlVHJhbnNmb3JtKCk7XG4gIH0sXG5cbiAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnVwZGF0ZVRyYW5zZm9ybSgpO1xuICB9LFxuXG4gIHVwZGF0ZVRyYW5zZm9ybTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNhbWVyYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ3ZyLWNhbWVyYScpO1xuICAgIHZhciBtYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4NCgpO1xuICAgIG1hdHJpeC5jb3B5KCBtYXRyaXguZ2V0SW52ZXJzZShjYW1lcmEub2JqZWN0M0QubWF0cml4V29ybGQpICk7XG4gICAgbWF0cml4LmNvcHkoIGNhbWVyYS5vYmplY3QzRC5tYXRyaXhXb3JsZCApO1xuXG4gICAgbWF0cml4LnRyYW5zcG9zZSgpO1xuXG4gICAgbWF0cml4LmVsZW1lbnRzWyAzIF0gPSAwO1xuICAgIG1hdHJpeC5lbGVtZW50c1sgNyBdID0gMDtcbiAgICBtYXRyaXguZWxlbWVudHNbIDExIF0gPSAwO1xuICAgIG1hdHJpeC5lbGVtZW50c1sgMTUgXSA9IDE7XG5cbiAgICAvLyBQb3NpdGlvblxuICAgIHZhciB4ID0gdGhpcy5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCctLXgnKSB8fCAwO1xuICAgIHZhciB5ID0gdGhpcy5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCctLXknKSB8fCAwO1xuICAgIHZhciB6ID0gdGhpcy5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCctLXonKSB8fCAwO1xuICAgIHZhciB0cmFuc2xhdGlvbiA9IG5ldyBUSFJFRS5NYXRyaXg0KCkubWFrZVRyYW5zbGF0aW9uKHgsIHksIC16KTtcblxuICAgIC8vIE9yaWVudGF0aW9uXG4gICAgdmFyIG9yaWVudGF0aW9uWCA9IHRoaXMuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS1yb3RYJykgfHwgMDtcbiAgICB2YXIgb3JpZW50YXRpb25ZID0gdGhpcy5zdHlsZS5nZXRQcm9wZXJ0eVZhbHVlKCctLXJvdFknKSB8fCAwO1xuICAgIHZhciBvcmllbnRhdGlvblogPSB0aGlzLnN0eWxlLmdldFByb3BlcnR5VmFsdWUoJy0tcm90WicpIHx8IDA7XG5cbiAgICB2YXIgcm90WCA9IFRIUkVFLk1hdGguZGVnVG9SYWQob3JpZW50YXRpb25YKTtcbiAgICB2YXIgcm90WSA9IFRIUkVFLk1hdGguZGVnVG9SYWQob3JpZW50YXRpb25ZKTtcbiAgICB2YXIgcm90WiA9IFRIUkVFLk1hdGguZGVnVG9SYWQob3JpZW50YXRpb25aKTtcbiAgICB2YXIgcm90YXRpb25YID0gbmV3IFRIUkVFLk1hdHJpeDQoKS5tYWtlUm90YXRpb25YKHJvdFgpO1xuICAgIHZhciByb3RhdGlvblkgPSBuZXcgVEhSRUUuTWF0cml4NCgpLm1ha2VSb3RhdGlvblkocm90WSk7XG4gICAgdmFyIHJvdGF0aW9uWiA9IG5ldyBUSFJFRS5NYXRyaXg0KCkubWFrZVJvdGF0aW9uWChyb3RaKTtcblxuICAgIHRoaXMuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKC01MCUsIC01MCUsIDApICcgKyB0aGlzLmdldENTU01hdHJpeCh0cmFuc2xhdGlvbi5tdWx0aXBseShyb3RhdGlvbloubXVsdGlwbHkocm90YXRpb25ZLm11bHRpcGx5KHJvdGF0aW9uWC5tdWx0aXBseShtYXRyaXgpKSkpKTtcbiAgICB0aGlzLm9iamVjdDNELnBvc2l0aW9uLnNldCh4LCAteSwgLXopO1xuICAgIHRoaXMub2JqZWN0M0Qucm90YXRpb24ub3JkZXIgPSAnWVhaJztcbiAgICB0aGlzLm9iamVjdDNELnJvdGF0aW9uLnNldCgtcm90WCwgcm90WSwgcm90Wik7XG4gIH1cblxufSk7XG5cbn0pO30pKHR5cGVvZiBkZWZpbmU9PSdmdW5jdGlvbicmJmRlZmluZS5hbWQ/ZGVmaW5lXG46KGZ1bmN0aW9uKG4sdyl7J3VzZSBzdHJpY3QnO3JldHVybiB0eXBlb2YgbW9kdWxlPT0nb2JqZWN0Jz9mdW5jdGlvbihjKXtcbmMocmVxdWlyZSxleHBvcnRzLG1vZHVsZSk7fTpmdW5jdGlvbihjKXt2YXIgbT17ZXhwb3J0czp7fX07YyhmdW5jdGlvbihuKXtcbnJldHVybiB3W25dO30sbS5leHBvcnRzLG0pO3dbbl09bS5leHBvcnRzO307fSkoJ1ZSQmlsbGJvYXJkJyx0aGlzKSk7XG4iLCIvKiBnbG9iYWxzIGRlZmluZSAqL1xuKGZ1bmN0aW9uKGRlZmluZSl7J3VzZSBzdHJpY3QnO2RlZmluZShmdW5jdGlvbihyZXF1aXJlLGV4cG9ydHMsbW9kdWxlKXtcblxuLyoqXG4gKiBEZXBlbmRlbmNpZXNcbiAqL1xuXG52YXIgY29tcG9uZW50ID0gcmVxdWlyZSgnZ2FpYS1jb21wb25lbnQnKTtcblxuLyoqXG4gKiBTaW1wbGUgbG9nZ2VyXG4gKiBAdHlwZSB7RnVuY3Rpb259XG4gKi9cbnZhciBkZWJ1ZyA9IDAgPyBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpIDogZnVuY3Rpb24oKSB7fTtcblxuLyoqXG4gKiBFeHBvcnRzXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSBjb21wb25lbnQucmVnaXN0ZXIoJ3ZyLXRlcnJhaW4nLCB7XG4gIGV4dGVuZHM6IFZST2JqZWN0LnByb3RvdHlwZSxcblxuICBjcmVhdGVkOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5zZXR1cFNjZW5lKG9uTG9hZGVkKTtcbiAgICBmdW5jdGlvbiBvbkxvYWRlZCgpIHtcbiAgICAgIFZST2JqZWN0LnByb3RvdHlwZS5jcmVhdGVkLmNhbGwoc2VsZik7XG4gICAgICBzZWxmLmdlbmVyYXRlTGFiZWxzKG5vaXNlKTtcbiAgICB9XG4gIH0sXG5cbiAgc2V0dXBTY2VuZTogZnVuY3Rpb24ob25Mb2FkZWQpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy50ZXJyYWluU2l6ZSA9IDEwMjQ7XG4gICAgbmV3IFRlcnJhaW4obm9pc2UsIHRoaXMudGVycmFpblNpemUsIDIsIDY0LCBmdW5jdGlvbihtb2RlbCkgeztcbiAgICAgIHNlbGYub2JqZWN0M0QgPSBtb2RlbDtcbiAgICAgIG9uTG9hZGVkKCk7XG4gICAgfSk7XG4gIH0sXG5cbiAgZ2VuZXJhdGVMYWJlbHM6IGZ1bmN0aW9uKG5vaXNlKSB7XG4gICAgdmFyIGxhYmVsO1xuICAgIHZhciBtYXggPSAxNTtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgbm9pc2UuaW1hZ2UuZGF0YS5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIG5vaXNlVmFsdWUgPSBub2lzZS5pbWFnZS5kYXRhW2ldO1xuICAgICAgdmFyIHNpZ24xID0gKE1hdGgucmFuZG9tKCkqMTApLnRvRml4ZWQoMCkgJSAyID09PSAwPyAtMTogMTtcbiAgICAgIHZhciBzaWduMiA9IChNYXRoLnJhbmRvbSgpKjEwKS50b0ZpeGVkKDApICUgMiA9PT0gMD8gLTE6IDE7XG4gICAgICBpZiAobm9pc2VWYWx1ZSA+IDgwKSB7XG4gICAgICAgIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndnItYmlsbGJvYXJkJyk7XG4gICAgICAgIGxhYmVsLmNsYXNzTGlzdC5hZGQoJ3BlYWstbGFiZWwnKTtcbiAgICAgICAgbGFiZWwuc3R5bGUuc2V0UHJvcGVydHkoJy0teCcsICBzaWduMSAqIChNYXRoLnJhbmRvbSgpICogdGhpcy50ZXJyYWluU2l6ZSkpO1xuICAgICAgICBsYWJlbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS15JywgIHNpZ24yICogKE1hdGgucmFuZG9tKCkgKiB0aGlzLnRlcnJhaW5TaXplKSk7XG4gICAgICAgIGxhYmVsLnN0eWxlLnNldFByb3BlcnR5KCctLXonLCAgLW5vaXNlVmFsdWUpO1xuICAgICAgICBsYWJlbC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1yb3RYJywgIC05MCk7XG4gICAgICAgIGxhYmVsLmlubmVySFRNTCA9IFwiTGFuZG1hcmsgXCIgKyBpO1xuICAgICAgICB0aGlzLmFwcGVuZENoaWxkKGxhYmVsKTtcbiAgICAgICAgbWF4LT0xO1xuICAgICAgICBpZiAobWF4ID09IDApIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxufSk7XG5cbn0pO30pKHR5cGVvZiBkZWZpbmU9PSdmdW5jdGlvbicmJmRlZmluZS5hbWQ/ZGVmaW5lXG46KGZ1bmN0aW9uKG4sdyl7J3VzZSBzdHJpY3QnO3JldHVybiB0eXBlb2YgbW9kdWxlPT0nb2JqZWN0Jz9mdW5jdGlvbihjKXtcbmMocmVxdWlyZSxleHBvcnRzLG1vZHVsZSk7fTpmdW5jdGlvbihjKXt2YXIgbT17ZXhwb3J0czp7fX07YyhmdW5jdGlvbihuKXtcbnJldHVybiB3W25dO30sbS5leHBvcnRzLG0pO3dbbl09bS5leHBvcnRzO307fSkoJ1ZSVGVycmFpbicsdGhpcykpO1xuIiwiLyogZ2xvYmFscyBkZWZpbmUgKi9cbihmdW5jdGlvbihkZWZpbmUpeyd1c2Ugc3RyaWN0JztkZWZpbmUoZnVuY3Rpb24ocmVxdWlyZSxleHBvcnRzLG1vZHVsZSl7XG5cbi8qKlxuICogRGVwZW5kZW5jaWVzXG4gKi9cblxudmFyIGNvbXBvbmVudCA9IHJlcXVpcmUoJ2dhaWEtY29tcG9uZW50Jyk7XG5cbi8qKlxuICogU2ltcGxlIGxvZ2dlclxuICogQHR5cGUge0Z1bmN0aW9ufVxuICovXG52YXIgZGVidWcgPSAwID8gY29uc29sZS5sb2cuYmluZChjb25zb2xlKSA6IGZ1bmN0aW9uKCkge307XG5cbi8qKlxuICogRXhwb3J0c1xuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY29tcG9uZW50LnJlZ2lzdGVyKCd2ci1heGlzLWdsJywge1xuICBleHRlbmRzOiBWUk9iamVjdC5wcm90b3R5cGUsXG5cbiAgY3JlYXRlZDogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXR1cFNjZW5lKCk7XG4gICAgVlJPYmplY3QucHJvdG90eXBlLmNyZWF0ZWQuY2FsbCh0aGlzKTtcbiAgfSxcblxuICBzZXR1cFNjZW5lOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9iamVjdDNEID0gbmV3IFRIUkVFLkF4aXNIZWxwZXIoIDUwMCApO1xuICB9XG5cbn0pO1xuXG59KTt9KSh0eXBlb2YgZGVmaW5lPT0nZnVuY3Rpb24nJiZkZWZpbmUuYW1kP2RlZmluZVxuOihmdW5jdGlvbihuLHcpeyd1c2Ugc3RyaWN0JztyZXR1cm4gdHlwZW9mIG1vZHVsZT09J29iamVjdCc/ZnVuY3Rpb24oYyl7XG5jKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpO306ZnVuY3Rpb24oYyl7dmFyIG09e2V4cG9ydHM6e319O2MoZnVuY3Rpb24obil7XG5yZXR1cm4gd1tuXTt9LG0uZXhwb3J0cyxtKTt3W25dPW0uZXhwb3J0czt9O30pKCdWUkF4aXNHTCcsdGhpcykpO1xuIiwiLyogZ2xvYmFscyBkZWZpbmUgKi9cbihmdW5jdGlvbihkZWZpbmUpeyd1c2Ugc3RyaWN0JztkZWZpbmUoZnVuY3Rpb24ocmVxdWlyZSxleHBvcnRzLG1vZHVsZSl7XG5cbi8qKlxuICogRGVwZW5kZW5jaWVzXG4gKi9cblxudmFyIGNvbXBvbmVudCA9IHJlcXVpcmUoJ2dhaWEtY29tcG9uZW50Jyk7XG5cbi8qKlxuICogU2ltcGxlIGxvZ2dlclxuICogQHR5cGUge0Z1bmN0aW9ufVxuICovXG52YXIgZGVidWcgPSAwID8gY29uc29sZS5sb2cuYmluZChjb25zb2xlKSA6IGZ1bmN0aW9uKCkge307XG5cbi8qKlxuICogRXhwb3J0c1xuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY29tcG9uZW50LnJlZ2lzdGVyKCd2ci1heGlzLWRvbScsIHtcbiAgZXh0ZW5kczogVlJPYmplY3QucHJvdG90eXBlLFxuXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBjbGFzcz1cImF4aXMgeC1heGlzXCI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImF4aXMgeS1heGlzXCI+PC9kaXY+XG4gICAgPGRpdiBjbGFzcz1cImF4aXMgei1heGlzXCI+PC9kaXY+XG4gICAgPHN0eWxlPlxuICAgIDpob3N0IHtcbiAgICAgIGxlZnQ6IDUwJTtcbiAgICAgIHRvcDogNTAlO1xuICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgdHJhbnNmb3JtLXN0eWxlOiBwcmVzZXJ2ZS0zZDtcbiAgICB9XG5cbiAgICAuYXhpcyB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgfVxuXG4gICAgLngtYXhpcyB7XG4gICAgICBoZWlnaHQ6IDFweDtcbiAgICAgIHdpZHRoOiA1MDBweDtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IHBpbms7XG4gICAgfVxuXG4gICAgLnktYXhpcyB7XG4gICAgICBoZWlnaHQ6IDUwMHB4O1xuICAgICAgd2lkdGg6IDFweDtcbiAgICAgIGJhY2tncm91bmQtY29sb3I6IG1hZ2VudDtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgLTUwMHB4LCAwKTtcbiAgICB9XG5cbiAgICAuei1heGlzIHtcbiAgICAgIGhlaWdodDogMXB4O1xuICAgICAgd2lkdGg6IDUwMHB4O1xuICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmlvbGV0O1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgtNTAlLCAwLCAyNTBweCkgcm90YXRlWSg5MGRlZyk7XG4gICAgfVxuICAgIDwvc3R5bGU+XG4gIGBcblxufSk7XG5cbn0pO30pKHR5cGVvZiBkZWZpbmU9PSdmdW5jdGlvbicmJmRlZmluZS5hbWQ/ZGVmaW5lXG46KGZ1bmN0aW9uKG4sdyl7J3VzZSBzdHJpY3QnO3JldHVybiB0eXBlb2YgbW9kdWxlPT0nb2JqZWN0Jz9mdW5jdGlvbihjKXtcbmMocmVxdWlyZSxleHBvcnRzLG1vZHVsZSk7fTpmdW5jdGlvbihjKXt2YXIgbT17ZXhwb3J0czp7fX07YyhmdW5jdGlvbihuKXtcbnJldHVybiB3W25dO30sbS5leHBvcnRzLG0pO3dbbl09bS5leHBvcnRzO307fSkoJ1ZSQXhpc0RPTScsdGhpcykpO1xuIiwiLyogZ2xvYmFscyBkZWZpbmUgKi9cbihmdW5jdGlvbihkZWZpbmUpeyd1c2Ugc3RyaWN0JztkZWZpbmUoZnVuY3Rpb24ocmVxdWlyZSxleHBvcnRzLG1vZHVsZSl7XG5cbi8qKlxuICogRGVwZW5kZW5jaWVzXG4gKi9cblxudmFyIGNvbXBvbmVudCA9IHJlcXVpcmUoJ2dhaWEtY29tcG9uZW50Jyk7XG5cbi8qKlxuICogU2ltcGxlIGxvZ2dlclxuICogQHR5cGUge0Z1bmN0aW9ufVxuICovXG52YXIgZGVidWcgPSAwID8gY29uc29sZS5sb2cuYmluZChjb25zb2xlKSA6IGZ1bmN0aW9uKCkge307XG5cbnZhciByID0gXCJ0ZXh0dXJlcy9icmlkZ2UvXCI7XG52YXIgdXJscyA9IFsgciArIFwicG9zeC5qcGdcIiwgciArIFwibmVneC5qcGdcIixcbiAgICAgICAgICAgICByICsgXCJwb3N5LmpwZ1wiLCByICsgXCJuZWd5LmpwZ1wiLFxuICAgICAgICAgICAgIHIgKyBcInBvc3ouanBnXCIsIHIgKyBcIm5lZ3ouanBnXCIgXTtcbnZhciB0ZXh0dXJlQ3ViZSA9IFRIUkVFLkltYWdlVXRpbHMubG9hZFRleHR1cmVDdWJlKCB1cmxzICk7XG50ZXh0dXJlQ3ViZS5mb3JtYXQgPSBUSFJFRS5SR0JGb3JtYXQ7XG5cbi8qKlxuICogRXhwb3J0c1xuICovXG5cbm1vZHVsZS5leHBvcnRzID0gY29tcG9uZW50LnJlZ2lzdGVyKCd2ci1sYW1ibycsIHtcbiAgZXh0ZW5kczogVlJPYmplY3QucHJvdG90eXBlLFxuXG4gIGNyZWF0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgbW9kZWxJbmZvID0gdGhpcy5tb2RlbEluZm87XG4gICAgdmFyIG1hdGVyaWFscyA9IHRoaXMubWF0ZXJpYWxzO1xuICAgIG1vZGVsSW5mby5tYXRlcmlhbHMgPSB7XG4gICAgICBib2R5OiBbXG4gICAgICAgIFsgXCJPcmFuZ2UgbWV0YWxcIiwgIG1hdGVyaWFsc1sgXCJPcmFuZ2UgbWV0YWxcIiBdIF0sXG4gICAgICAgIFsgXCJCbHVlIG1ldGFsXCIsICAgbWF0ZXJpYWxzWyBcIkJsdWUgbWV0YWxcIiBdIF0sXG4gICAgICAgIFsgXCJSZWQgbWV0YWxcIiwgICAgbWF0ZXJpYWxzWyBcIlJlZCBtZXRhbFwiIF0gXSxcbiAgICAgICAgWyBcIkdyZWVuIG1ldGFsXCIsICBtYXRlcmlhbHNbIFwiR3JlZW4gbWV0YWxcIiBdIF0sXG4gICAgICAgIFsgXCJCbGFjayBtZXRhbFwiLCAgbWF0ZXJpYWxzWyBcIkJsYWNrIG1ldGFsXCIgXSBdLFxuICAgICAgICBbIFwiR29sZFwiLCAgICAgbWF0ZXJpYWxzWyBcIkdvbGRcIiBdIF0sXG4gICAgICAgIFsgXCJCcm9uemVcIiwgICBtYXRlcmlhbHNbIFwiQnJvbnplXCIgXSBdLFxuICAgICAgICBbIFwiQ2hyb21lXCIsICAgbWF0ZXJpYWxzWyBcIkNocm9tZVwiIF0gXVxuICAgICAgXSxcbiAgICAgIG1tYXA6IHtcbiAgICAgICAgMDogbWF0ZXJpYWxzWyBcIkJsYWNrIHJvdWdoXCIgXSwgICAvLyB0aXJlcyArIGluc2lkZVxuICAgICAgICAxOiBtYXRlcmlhbHNbIFwiUHVyZSBjaHJvbWVcIiBdLCAgIC8vIHdoZWVscyArIGV4dHJhcyBjaHJvbWVcbiAgICAgICAgMjogbWF0ZXJpYWxzWyBcIkJyb256ZVwiIF0sICAgICAgIC8vIGJhY2sgLyB0b3AgLyBmcm9udCB0b3Jzb1xuICAgICAgICAzOiBtYXRlcmlhbHNbIFwiTGlnaHQgZ2xhc3NcIiBdLCAgICAvLyBnbGFzc1xuICAgICAgICA0OiBtYXRlcmlhbHNbIFwiUHVyZSBjaHJvbWVcIiBdLCAgIC8vIHNpZGVzIHRvcnNvXG4gICAgICAgIDU6IG1hdGVyaWFsc1sgXCJQdXJlIGNocm9tZVwiIF0sICAgLy8gZW5naW5lXG4gICAgICAgIDY6IG1hdGVyaWFsc1sgXCJSZWQgZ2xhc3MgNTBcIiBdLCAgICAvLyBiYWNrbGlnaHRzXG4gICAgICAgIDc6IG1hdGVyaWFsc1sgXCJPcmFuZ2UgZ2xhc3MgNTBcIiBdICAvLyBiYWNrc2lnbmFsc1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5zZXR1cFNjZW5lKG9uTG9hZGVkKTtcbiAgICBmdW5jdGlvbiBvbkxvYWRlZCgpIHtcbiAgICAgIFZST2JqZWN0LnByb3RvdHlwZS5jcmVhdGVkLmNhbGwoc2VsZik7XG4gICAgICB2YXIgYW1iaWVudCA9IG5ldyBUSFJFRS5BbWJpZW50TGlnaHQoIDB4MDUwNTA1ICk7XG4gICAgICBzZWxmLnNjZW5lLnNjZW5lLmFkZCggYW1iaWVudCApO1xuXG4gICAgICB2YXIgZGlyZWN0aW9uYWxMaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweGZmZmZmZiwgMiApO1xuICAgICAgZGlyZWN0aW9uYWxMaWdodC5wb3NpdGlvbi5zZXQoIDIsIDEuMiwgMTAgKS5ub3JtYWxpemUoKTtcbiAgICAgIHNlbGYuc2NlbmUuc2NlbmUuYWRkKCBkaXJlY3Rpb25hbExpZ2h0ICk7XG5cbiAgICAgIGRpcmVjdGlvbmFsTGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhmZmZmZmYsIDEgKTtcbiAgICAgIGRpcmVjdGlvbmFsTGlnaHQucG9zaXRpb24uc2V0KCAtMiwgMS4yLCAtMTAgKS5ub3JtYWxpemUoKTtcbiAgICAgIHNlbGYuc2NlbmUuc2NlbmUuYWRkKCBkaXJlY3Rpb25hbExpZ2h0ICk7XG5cbiAgICAgIHZhciBwb2ludExpZ2h0ID0gbmV3IFRIUkVFLlBvaW50TGlnaHQoIDB4ZmZhYTAwLCAyICk7XG4gICAgICBwb2ludExpZ2h0LnBvc2l0aW9uLnNldCggMjAwMCwgMTIwMCwgMTAwMDAgKTtcbiAgICAgIHNlbGYuc2NlbmUuc2NlbmUuYWRkKCBwb2ludExpZ2h0ICk7XG4gICAgfVxuICB9LFxuXG4gIC8vIGNvbW1vbiBtYXRlcmlhbHNcbiAgbWF0ZXJpYWxzOiB7XG4gICAgXCJPcmFuZ2VcIjogICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHhmZjY2MDAsIGFtYmllbnQ6IDB4ZmYyMjAwLCBlbnZNYXA6IHRleHR1cmVDdWJlLCBjb21iaW5lOiBUSFJFRS5NaXhPcGVyYXRpb24sIHJlZmxlY3Rpdml0eTogMC4zIH0gKSxcbiAgICBcIkJsdWVcIjogICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHgwMDExMzMsIGFtYmllbnQ6IDB4MDAxMTMzLCBlbnZNYXA6IHRleHR1cmVDdWJlLCBjb21iaW5lOiBUSFJFRS5NaXhPcGVyYXRpb24sIHJlZmxlY3Rpdml0eTogMC4zIH0gKSxcbiAgICBcIlJlZFwiOiAgICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHg2NjAwMDAsIGFtYmllbnQ6IDB4MzMwMDAwLCBlbnZNYXA6IHRleHR1cmVDdWJlLCBjb21iaW5lOiBUSFJFRS5NaXhPcGVyYXRpb24sIHJlZmxlY3Rpdml0eTogMC4yNSB9ICksXG4gICAgXCJCbGFja1wiOiAgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoIHsgY29sb3I6IDB4MDAwMDAwLCBhbWJpZW50OiAweDAwMDAwMCwgZW52TWFwOiB0ZXh0dXJlQ3ViZSwgY29tYmluZTogVEhSRUUuTWl4T3BlcmF0aW9uLCByZWZsZWN0aXZpdHk6IDAuMTUgfSApLFxuICAgIFwiV2hpdGVcIjogIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmZmZiwgYW1iaWVudDogMHg2NjY2NjYsIGVudk1hcDogdGV4dHVyZUN1YmUsIGNvbWJpbmU6IFRIUkVFLk1peE9wZXJhdGlvbiwgcmVmbGVjdGl2aXR5OiAwLjI1IH0gKSxcblxuICAgIFwiQ2FybWluZVwiOiAgbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKCB7IGNvbG9yOiAweDc3MDAwMCwgc3BlY3VsYXI6MHhmZmFhYWEsIGVudk1hcDogdGV4dHVyZUN1YmUsIGNvbWJpbmU6IFRIUkVFLk11bHRpcGx5T3BlcmF0aW9uIH0gKSxcbiAgICBcIkdvbGRcIjogICBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoIHsgY29sb3I6IDB4YWE5OTQ0LCBzcGVjdWxhcjoweGJiYWE5OSwgc2hpbmluZXNzOjUwLCBlbnZNYXA6IHRleHR1cmVDdWJlLCBjb21iaW5lOiBUSFJFRS5NdWx0aXBseU9wZXJhdGlvbiB9ICksXG4gICAgXCJCcm9uemVcIjogbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKCB7IGNvbG9yOiAweDE1MDUwNSwgc3BlY3VsYXI6MHhlZTY2MDAsIHNoaW5pbmVzczoxMCwgZW52TWFwOiB0ZXh0dXJlQ3ViZSwgY29tYmluZTogVEhSRUUuTWl4T3BlcmF0aW9uLCByZWZsZWN0aXZpdHk6IDAuMjUgfSApLFxuICAgIFwiQ2hyb21lXCI6ICAgbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmZmZiwgc3BlY3VsYXI6MHhmZmZmZmYsIGVudk1hcDogdGV4dHVyZUN1YmUsIGNvbWJpbmU6IFRIUkVFLk11bHRpcGx5T3BlcmF0aW9uIH0gKSxcblxuICAgIFwiT3JhbmdlIG1ldGFsXCI6IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweGZmNjYwMCwgYW1iaWVudDogMHhmZjIyMDAsIGVudk1hcDogdGV4dHVyZUN1YmUsIGNvbWJpbmU6IFRIUkVFLk11bHRpcGx5T3BlcmF0aW9uIH0gKSxcbiAgICBcIkJsdWUgbWV0YWxcIjogICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHgwMDExMzMsIGFtYmllbnQ6IDB4MDAyMjY2LCBlbnZNYXA6IHRleHR1cmVDdWJlLCBjb21iaW5lOiBUSFJFRS5NdWx0aXBseU9wZXJhdGlvbiB9ICksXG4gICAgXCJSZWQgbWV0YWxcIjogIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweDc3MDAwMCwgZW52TWFwOiB0ZXh0dXJlQ3ViZSwgY29tYmluZTogVEhSRUUuTXVsdGlwbHlPcGVyYXRpb24gfSApLFxuICAgIFwiR3JlZW4gbWV0YWxcIjogIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweDAwNzcxMSwgZW52TWFwOiB0ZXh0dXJlQ3ViZSwgY29tYmluZTogVEhSRUUuTXVsdGlwbHlPcGVyYXRpb24gfSApLFxuICAgIFwiQmxhY2sgbWV0YWxcIjogIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweDIyMjIyMiwgZW52TWFwOiB0ZXh0dXJlQ3ViZSwgY29tYmluZTogVEhSRUUuTXVsdGlwbHlPcGVyYXRpb24gfSApLFxuXG4gICAgXCJQdXJlIGNocm9tZVwiOiAgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCBlbnZNYXA6IHRleHR1cmVDdWJlIH0gKSxcbiAgICBcIkRhcmsgY2hyb21lXCI6ICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHg0NDQ0NDQsIGVudk1hcDogdGV4dHVyZUN1YmUgfSApLFxuICAgIFwiRGFya2VyIGNocm9tZVwiOm5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweDIyMjIyMiwgZW52TWFwOiB0ZXh0dXJlQ3ViZSB9ICksXG5cbiAgICBcIkJsYWNrIGdsYXNzXCI6ICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHgxMDEwMTYsIGVudk1hcDogdGV4dHVyZUN1YmUsIG9wYWNpdHk6IDAuOTc1LCB0cmFuc3BhcmVudDogdHJ1ZSB9ICksXG4gICAgXCJEYXJrIGdsYXNzXCI6IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweDEwMTA0NiwgZW52TWFwOiB0ZXh0dXJlQ3ViZSwgb3BhY2l0eTogMC4yNSwgdHJhbnNwYXJlbnQ6IHRydWUgfSApLFxuICAgIFwiQmx1ZSBnbGFzc1wiOiBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHg2Njg4OTksIGVudk1hcDogdGV4dHVyZUN1YmUsIG9wYWNpdHk6IDAuNzUsIHRyYW5zcGFyZW50OiB0cnVlIH0gKSxcbiAgICBcIkxpZ2h0IGdsYXNzXCI6ICBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4MjIzMzQ0LCBlbnZNYXA6IHRleHR1cmVDdWJlLCBvcGFjaXR5OiAwLjI1LCB0cmFuc3BhcmVudDogdHJ1ZSwgY29tYmluZTogVEhSRUUuTWl4T3BlcmF0aW9uLCByZWZsZWN0aXZpdHk6IDAuMjUgfSApLFxuXG4gICAgXCJSZWQgZ2xhc3NcIjogIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweGZmMDAwMCwgb3BhY2l0eTogMC43NSwgdHJhbnNwYXJlbnQ6IHRydWUgfSApLFxuICAgIFwiWWVsbG93IGdsYXNzXCI6IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweGZmZmZhYSwgb3BhY2l0eTogMC43NSwgdHJhbnNwYXJlbnQ6IHRydWUgfSApLFxuICAgIFwiT3JhbmdlIGdsYXNzXCI6IG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweDk5NTUwMCwgb3BhY2l0eTogMC43NSwgdHJhbnNwYXJlbnQ6IHRydWUgfSApLFxuXG4gICAgXCJPcmFuZ2UgZ2xhc3MgNTBcIjogIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweGZmYmIwMCwgb3BhY2l0eTogMC41LCB0cmFuc3BhcmVudDogdHJ1ZSB9ICksXG4gICAgXCJSZWQgZ2xhc3MgNTBcIjogICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHhmZjAwMDAsIG9wYWNpdHk6IDAuNSwgdHJhbnNwYXJlbnQ6IHRydWUgfSApLFxuXG4gICAgXCJGdWxsYmxhY2sgcm91Z2hcIjogIG5ldyBUSFJFRS5NZXNoTGFtYmVydE1hdGVyaWFsKCB7IGNvbG9yOiAweDAwMDAwMCB9ICksXG4gICAgXCJCbGFjayByb3VnaFwiOiAgICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHgwNTA1MDUgfSApLFxuICAgIFwiRGFya2dyYXkgcm91Z2hcIjogbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoIHsgY29sb3I6IDB4MDkwOTA5IH0gKSxcbiAgICBcIlJlZCByb3VnaFwiOiAgICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCggeyBjb2xvcjogMHgzMzA1MDAgfSApLFxuXG4gICAgXCJEYXJrZ3JheSBzaGlueVwiOiBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoIHsgY29sb3I6IDB4MDAwMDAwLCBzcGVjdWxhcjogMHgwNTA1MDUgfSApLFxuICAgIFwiR3JheSBzaGlueVwiOiAgIG5ldyBUSFJFRS5NZXNoUGhvbmdNYXRlcmlhbCggeyBjb2xvcjogMHgwNTA1MDUsIHNoaW5pbmVzczogMjAgfSApXG4gIH0sXG5cbiAgbW9kZWxJbmZvOiB7XG4gICAgbmFtZTogXCJCdWdhdHRpIFZleXJvblwiLFxuICAgIHVybDogIFwib2JqL3ZleXJvbi9WZXlyb25Ob1V2X2Jpbi5qc1wiLFxuICAgIGF1dGhvcjogJzxhIGhyZWY9XCJodHRwOi8vYXJ0aXN0LTNkLmNvbS9mcmVlXzNkX21vZGVscy9kbm0vbW9kZWxfZGlzcC5waHA/dWlkPTExMjlcIiB0YXJnZXQ9XCJfYmxhbmtcIj5Ucm95YW5vPC9hPicsXG4gICAgaW5pdF9yb3RhdGlvbjogWyAwLCAwLCAwIF0sXG4gICAgc2NhbGU6IDUuNSxcbiAgICBpbml0X21hdGVyaWFsOiA0LFxuICAgIGJvZHlfbWF0ZXJpYWxzOiBbIDIgXSxcbiAgICBvYmplY3Q6IG51bGwsXG4gICAgYnV0dG9uczogbnVsbCxcbiAgICBtYXRlcmlhbHM6IG51bGxcbiAgfSxcblxuICBzZXR1cFNjZW5lOiBmdW5jdGlvbihvbkxvYWRlZCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICB2YXIgbG9hZGVyID0gbmV3IFRIUkVFLkJpbmFyeUxvYWRlcih0cnVlKTtcbiAgICBsb2FkZXIubG9hZCh0aGlzLm1vZGVsSW5mby51cmwsIGZ1bmN0aW9uKGdlb21ldHJ5KSB7XG4gICAgICB2YXIgbW9kZWxJbmZvID0gc2VsZi5tb2RlbEluZm87XG4gICAgICB2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEZhY2VNYXRlcmlhbCgpO1xuICAgICAgdmFyIHNjYWxlID0gbW9kZWxJbmZvLnNjYWxlICogMTtcbiAgICAgIHZhciByb3RhdGlvbiA9IG1vZGVsSW5mby5pbml0X3JvdGF0aW9uO1xuICAgICAgdmFyIG1hdGVyaWFscyA9IG1vZGVsSW5mby5tYXRlcmlhbHM7XG4gICAgICB2YXIgaW5pdE1hdGVyaWFsID0gbW9kZWxJbmZvLmluaXRfbWF0ZXJpYWw7XG4gICAgICB2YXIgYm9keU1hdGVyaWFscyA9IG1vZGVsSW5mby5ib2R5X21hdGVyaWFscztcbiAgICAgIGZvciAoIHZhciBpIGluIG1vZGVsSW5mby5tYXRlcmlhbHMubW1hcCApIHtcbiAgICAgICAgbWF0ZXJpYWwubWF0ZXJpYWxzWyBpIF0gPSBtb2RlbEluZm8ubWF0ZXJpYWxzLm1tYXBbIGkgXTtcbiAgICAgIH1cbiAgICAgIHZhciBtZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApO1xuICAgICAgbWVzaC5yb3RhdGlvbi54ID0gcm90YXRpb25bIDAgXTtcbiAgICAgIG1lc2gucm90YXRpb24ueSA9IHJvdGF0aW9uWyAxIF07XG4gICAgICBtZXNoLnJvdGF0aW9uLnogPSByb3RhdGlvblsgMiBdO1xuICAgICAgbWVzaC5zY2FsZS54ID0gbWVzaC5zY2FsZS55ID0gbWVzaC5zY2FsZS56ID0gc2NhbGU7XG4gICAgICB2YXIgeCA9IHBhcnNlSW50KHNlbGYuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS14JykpIHx8IDA7XG4gICAgICB2YXIgeSA9IHBhcnNlSW50KHNlbGYuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS15JykpIHx8IDA7XG4gICAgICB2YXIgeiA9IHBhcnNlSW50KHNlbGYuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS16JykpIHx8IDA7XG4gICAgICBtZXNoLnBvc2l0aW9uLnNldCh4LCB5LCAteik7XG4gICAgICBzZWxmLm9iamVjdDNEID0gbWVzaDtcbiAgICAgIG9uTG9hZGVkKCk7XG4gICAgfSk7XG4gIH1cblxufSk7XG5cbn0pO30pKHR5cGVvZiBkZWZpbmU9PSdmdW5jdGlvbicmJmRlZmluZS5hbWQ/ZGVmaW5lXG46KGZ1bmN0aW9uKG4sdyl7J3VzZSBzdHJpY3QnO3JldHVybiB0eXBlb2YgbW9kdWxlPT0nb2JqZWN0Jz9mdW5jdGlvbihjKXtcbmMocmVxdWlyZSxleHBvcnRzLG1vZHVsZSk7fTpmdW5jdGlvbihjKXt2YXIgbT17ZXhwb3J0czp7fX07YyhmdW5jdGlvbihuKXtcbnJldHVybiB3W25dO30sbS5leHBvcnRzLG0pO3dbbl09bS5leHBvcnRzO307fSkoJ1ZSTW9kZWwnLHRoaXMpKTtcbiIsIi8qIGdsb2JhbHMgZGVmaW5lICovXG4oZnVuY3Rpb24oZGVmaW5lKXsndXNlIHN0cmljdCc7ZGVmaW5lKGZ1bmN0aW9uKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpe1xuXG4vKipcbiAqIERlcGVuZGVuY2llc1xuICovXG5cbnZhciBjb21wb25lbnQgPSByZXF1aXJlKCdnYWlhLWNvbXBvbmVudCcpO1xuXG4vKipcbiAqIFNpbXBsZSBsb2dnZXJcbiAqIEB0eXBlIHtGdW5jdGlvbn1cbiAqL1xudmFyIGRlYnVnID0gMCA/IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSkgOiBmdW5jdGlvbigpIHt9O1xuXG4vKipcbiAqIEV4cG9ydHNcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNvbXBvbmVudC5yZWdpc3RlcigndnItaHVkJywge1xuICBleHRlbmRzOiBWUk9iamVjdC5wcm90b3R5cGUsXG5cbiAgY3JlYXRlZDogZnVuY3Rpb24oKSB7XG4gICAgVlJPYmplY3QucHJvdG90eXBlLmNyZWF0ZWQuY2FsbCh0aGlzKTtcbiAgICB2YXIgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzKTtcbiAgICB0aGlzLmVscyA9IHt9O1xuICAgIHRoaXMuZWxzLnVybGJhciA9IHRoaXMuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKCcudXJsYmFyJyk7XG4gICAgdmFyIGRhdGFfdXJsID0gdGhpcy5nZXRQcm9wZXJ0eVZhbHVlKFwiLS1kYXRhLXVybFwiKTtcbiAgICBkYXRhX3VybCA9IC91cmxcXChbJ1wiXSguKilbJ1wiXVxcKS8uZXhlYyhkYXRhX3VybClbMV07XG4gICAgYWpheC5nZXQoZGF0YV91cmwsIHRoaXMubG9hZExpbmtzLmJpbmQodGhpcykpO1xuICB9LFxuXG4gIGxvYWRMaW5rcyhsaW5rcykge1xuICAgIHZhciBsaW5rcyA9IGxpbmtzLnNpdGVzO1xuICAgIHRoaXMuY2xhc3NMaXN0LmFkZCgnaHVkJyk7XG4gICAgdmFyIGk7XG4gICAgdmFyIGVsO1xuICAgIHZhciBoMTtcbiAgICB2YXIgaDI7XG4gICAgZm9yIChpPTA7IGkgPCA1OyArK2kpIHtcbiAgICAgIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBlbC5jbGFzc0xpc3QuYWRkKCdodWQtZWxlbWVudCcpO1xuICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnbGluaycpO1xuICAgICAgaDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpO1xuICAgICAgaDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICAgICAgaDEuaW5uZXJIVE1MID0gbGlua3NbaV0ubmFtZTtcbiAgICAgIGgyLmlubmVySFRNTCA9IGxpbmtzW2ldLnRhZ2xpbmU7XG4gICAgICBlbC5hcHBlbmRDaGlsZChoMSk7XG4gICAgICBlbC5hcHBlbmRDaGlsZChoMik7XG4gICAgICBlbC5zdHlsZS5zZXRQcm9wZXJ0eShcIi0tdXJsXCIsIGxpbmtzW2ldLnVybCk7XG4gICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMubGlua0NsaWNrSGFuZGxlci5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMuYXBwZW5kQ2hpbGQoZWwpO1xuICAgIH1cbiAgfSxcblxuICBsaW5rQ2xpY2tIYW5kbGVyOiBmdW5jdGlvbihldnQpIHtcbiAgICB2YXIgdXJsID0gZXZ0LmN1cnJlbnRUYXJnZXQuc3R5bGUuZ2V0UHJvcGVydHlWYWx1ZSgnLS11cmwnKTtcbiAgICB2YXIgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ2NsaWNrJywgeyAnZGV0YWlsJzogeyAndXJsJzogdXJsIH0gfSk7XG4gICAgZXZ0LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gIH0sXG5cbiAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbiAgfSxcblxuICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICB9LFxuXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBjbGFzcz1cImxpbmtzXCI+XG4gICAgICA8Y29udGVudD48L2NvbnRlbnQ+XG4gICAgPC9kaXY+XG4gICAgPGZvcm0gY2xhc3M9XCJodWQtZWxlbWVudCB1cmxiYXJcIiBhY3Rpb249XCIjXCI+XG4gICAgICA8aW5wdXQgY2xhc3M9XCJ1cmxiYXItaW5wdXRcIiB0eXBlPVwidGV4dFwiPlxuICAgIDwvZm9ybT5cbiAgICA8c3R5bGU+XG5cbiAgICAgIC5odWQtZWxlbWVudCB7XG4gICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogaHNsYSgyMjgsIDE1JSwgNiUsIDAuNzUpO1xuICAgICAgICBib3JkZXI6IDAuMjVjbSBzb2xpZCBibGFjaztcbiAgICAgICAgZm9udDogNTAwIDEuMXJlbSBzYW5zLXNlcmlmO1xuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICogVVJMIEJhclxuICAgICAgKi9cblxuICAgICAgLnVybGJhciB7XG4gICAgICAgIG1hcmdpbi10b3A6IDIwcHg7XG4gICAgICAgIHdpZHRoOiA0NSU7XG4gICAgICB9XG5cbiAgICAgIC51cmxiYXItaW5wdXQge1xuICAgICAgICBmb250OiA1MDAgMi4xcmVtLzEgc2Fucy1zZXJpZjtcbiAgICAgICAgbGV0dGVyLXNwYWNpbmc6IDAuMDVlbTtcbiAgICAgICAgcGFkZGluZzogMC41ZW0gMWVtO1xuICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7XG4gICAgICAgIHRyYW5zaXRpb246IC4yNXMgd2lkdGggZWFzZTtcbiAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgIGNvbG9yOiBibGFjaztcbiAgICAgICAgYm94LXNpemluZyA6IGJvcmRlci1ib3g7XG4gICAgICB9XG5cbiAgICAgIC51cmxiYXItaW5wdXQ6aG92ZXIge1xuICAgICAgICBiYWNrZ3JvdW5kOiBibGFjaztcbiAgICAgICAgY29sb3I6IHdoaXRlO1xuICAgICAgfVxuXG4gICAgICAudXJsYmFyLWlucHV0OmZvY3VzIHtcbiAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgICAgIGNvbG9yOiBibGFjaztcbiAgICAgIH1cblxuICAgICAgLyogTk9URTogVGhlc2Ugc2VsZWN0b3JzIGNhbm5vdCBiZSBjb21iaW5lZDogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTLzo6c2VsZWN0aW9uI0V4YW1wbGVzICovXG4gICAgICAudXJsYmFyLWlucHV0OjpzZWxlY3Rpb24ge1xuICAgICAgICBiYWNrZ3JvdW5kOiBoc2xhKDAsIDAlLCAwJSwgMC4yKTtcbiAgICAgICAgY29sb3I6IHdoaXRlO1xuICAgICAgfVxuXG4gICAgICAudXJsYmFyLWlucHV0OjotbW96LXNlbGVjdGlvbiB7XG4gICAgICAgIGJhY2tncm91bmQ6IGhzbGEoMCwgMCUsIDAlLCAwLjIpO1xuICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgKiBMaW5rc1xuICAgICAgKi9cblxuICAgICAgOjpjb250ZW50IC5saW5rIHtcbiAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7XG4gICAgICAgIGJvcmRlcjogMC4yNWNtIHNvbGlkIGJsYWNrO1xuICAgICAgICBmb250OiA1MDAgMS4xcmVtIHNhbnMtc2VyaWY7XG4gICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcbiAgICAgICAgaGVpZ2h0OiA3Y207XG4gICAgICAgIG1hcmdpbjogMC4yNWNtO1xuICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICBwYWRkaW5nOiAwLjVjbTtcbiAgICAgICAgdGV4dC1hbGlnbjogbGVmdDtcbiAgICAgICAgd2lkdGg6IDdjbTtcbiAgICAgICAgY29sb3I6IGJsYWNrO1xuICAgICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7XG4gICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgIH1cblxuICAgICAgOjpjb250ZW50IC5saW5rOmhvdmVyIHtcbiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7XG4gICAgICAgIGNvbG9yOiB3aGl0ZTtcbiAgICAgIH1cblxuICAgICAgOjpjb250ZW50IC5saW5rIGgxIHtcbiAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICBwYWRkaW5nOiAwO1xuICAgICAgfVxuXG4gICAgICA6OmNvbnRlbnQgLmxpbmsgaDIge1xuICAgICAgICBjb2xvcjogZ3JheTtcbiAgICAgICAgbWFyZ2luOiAwO1xuICAgICAgICBwYWRkaW5nOiAwO1xuICAgICAgfVxuXG4gICAgICA6aG9zdCB7XG4gICAgICAgIGxlZnQ6IDUwJTtcbiAgICAgICAgdG9wOiA1MCU7XG4gICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgdHJhbnNmb3JtLXN0eWxlOiBwcmVzZXJ2ZS0zZDtcbiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgICAgfVxuXG4gICAgICAuaGlkZGVuIHtcbiAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG4gICAgICAgIGRpc3BsYXk6IG5vbmU7XG4gICAgICB9XG4gICAgPC9zdHlsZT5cbiAgYFxuXG59KTtcblxufSk7fSkodHlwZW9mIGRlZmluZT09J2Z1bmN0aW9uJyYmZGVmaW5lLmFtZD9kZWZpbmVcbjooZnVuY3Rpb24obix3KXsndXNlIHN0cmljdCc7cmV0dXJuIHR5cGVvZiBtb2R1bGU9PSdvYmplY3QnP2Z1bmN0aW9uKGMpe1xuYyhyZXF1aXJlLGV4cG9ydHMsbW9kdWxlKTt9OmZ1bmN0aW9uKGMpe3ZhciBtPXtleHBvcnRzOnt9fTtjKGZ1bmN0aW9uKG4pe1xucmV0dXJuIHdbbl07fSxtLmV4cG9ydHMsbSk7d1tuXT1tLmV4cG9ydHM7fTt9KSgnVlJIVUQnLHRoaXMpKTtcbiIsIi8qIGdsb2JhbHMgZGVmaW5lICovXG4oZnVuY3Rpb24oZGVmaW5lKXsndXNlIHN0cmljdCc7ZGVmaW5lKGZ1bmN0aW9uKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpe1xuXG4vKipcbiAqIERlcGVuZGVuY2llc1xuICovXG5cbnZhciBjb21wb25lbnQgPSByZXF1aXJlKCdnYWlhLWNvbXBvbmVudCcpO1xuXG4vKipcbiAqIFNpbXBsZSBsb2dnZXJcbiAqIEB0eXBlIHtGdW5jdGlvbn1cbiAqL1xudmFyIGRlYnVnID0gMCA/IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSkgOiBmdW5jdGlvbigpIHt9O1xuXG4vKipcbiAqIEV4cG9ydHNcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNvbXBvbmVudC5yZWdpc3RlcigndnItd2VidmlldycsIHtcbiAgZXh0ZW5kczogVlJPYmplY3QucHJvdG90eXBlLFxuXG4gIGNyZWF0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgIFZST2JqZWN0LnByb3RvdHlwZS5jcmVhdGVkLmNhbGwodGhpcyk7XG4gICAgdGhpcy5lbHMgPSB7fTtcbiAgICB0aGlzLmVscy5pZnJhbWUgPSB0aGlzLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcignaWZyYW1lJyk7XG4gICAgdGhpcy5oaWRlKCk7XG4gIH0sXG5cbiAgbG9hZFVSTDogZnVuY3Rpb24odXJsKSB7XG4gICAgdGhpcy5lbHMuaWZyYW1lLnNyYyA9IHVybDtcbiAgfSxcblxuICBzaG93OiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmVscy5pZnJhbWUuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gIH0sXG5cbiAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lbHMuaWZyYW1lLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICB9LFxuXG4gIHRlbXBsYXRlOiBgXG4gICAgPGlmcmFtZSByZW1vdGU9XCJ0cnVlXCIgbW96YnJvd3Nlcj1cInRydWVcIj48L2lmcmFtZT5cbiAgICA8c3R5bGU+XG4gICAgICA6aG9zdCB7XG4gICAgICAgIGxlZnQ6IDUwJTtcbiAgICAgICAgdG9wOiA1MCU7XG4gICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgdHJhbnNmb3JtLXN0eWxlOiBwcmVzZXJ2ZS0zZDtcbiAgICAgIH1cblxuICAgICAgaWZyYW1lIHtcbiAgICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgICAgYm9yZGVyOiAwO1xuICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4zcyBlYXNlLWluLW91dDtcbiAgICAgIH1cblxuICAgICAgLmhpZGRlbiB7XG4gICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lO1xuICAgICAgICBvcGFjaXR5OiAwLjI7XG4gICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgMCwgLTEwMHB4KSBzY2FsZSgwLjc1LCAwLjc1KTtcbiAgICAgIH1cbiAgICA8L3N0eWxlPlxuICBgXG5cbn0pO1xuXG59KTt9KSh0eXBlb2YgZGVmaW5lPT0nZnVuY3Rpb24nJiZkZWZpbmUuYW1kP2RlZmluZVxuOihmdW5jdGlvbihuLHcpeyd1c2Ugc3RyaWN0JztyZXR1cm4gdHlwZW9mIG1vZHVsZT09J29iamVjdCc/ZnVuY3Rpb24oYyl7XG5jKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpO306ZnVuY3Rpb24oYyl7dmFyIG09e2V4cG9ydHM6e319O2MoZnVuY3Rpb24obil7XG5yZXR1cm4gd1tuXTt9LG0uZXhwb3J0cyxtKTt3W25dPW0uZXhwb3J0czt9O30pKCdWUldlYlZpZXcnLHRoaXMpKTtcbiIsIi8qIGdsb2JhbHMgZGVmaW5lICovXG4oZnVuY3Rpb24oZGVmaW5lKXsndXNlIHN0cmljdCc7ZGVmaW5lKGZ1bmN0aW9uKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpe1xuXG4vKipcbiAqIERlcGVuZGVuY2llc1xuICovXG5cbnZhciBjb21wb25lbnQgPSByZXF1aXJlKCdnYWlhLWNvbXBvbmVudCcpO1xuXG5cbi8vIC5zcHJpdGUgeyBiYWNrZ3JvdW5kOiB1cmwoJ3Nwcml0ZS5wbmcnKSBuby1yZXBlYXQgdG9wIGxlZnQ7IHdpZHRoOiAyNzBweDsgaGVpZ2h0OiAzNDNweDsgIH1cbi8vIC5zcHJpdGUuYXJtLWJhY2sgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIDA7IHdpZHRoOiAyMDJweDsgaGVpZ2h0OiA3M3B4OyB9XG4vLyAuc3ByaXRlLmFybS1ib3R0b20geyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC04M3B4OyB3aWR0aDogMjAzcHg7IGhlaWdodDogMzRweDsgfVxuLy8gLnNwcml0ZS5hcm0geyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xMjdweDsgd2lkdGg6IDIzMnB4OyBoZWlnaHQ6IDczcHg7IH1cbi8vIC5zcHJpdGUuYm9keS1iYWNrIHsgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMjEwcHg7IH1cbi8vIC5zcHJpdGUuYm9keS1ib3R0b20geyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC01NjNweDsgd2lkdGg6IDI3NHB4OyBoZWlnaHQ6IDI3M3B4OyB9XG4vLyAuc3ByaXRlLmJvZHktZnJvbnQgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC04NDZweDsgfVxuLy8gLnNwcml0ZS5ib2R5LWxlZnQgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xMTk5cHg7IH1cbi8vIC5zcHJpdGUuYm9keS1yaWdodCB7IGJhY2tncm91bmQtcG9zaXRpb246IDAgLTE1NTJweDsgfVxuLy8gLnNwcml0ZS5ib2R5LXRvcCB7IGJhY2tncm91bmQtcG9zaXRpb246IDAgLTE5MDVweDsgd2lkdGg6IDI3NHB4OyBoZWlnaHQ6IDI3M3B4OyB9XG4vLyAuc3ByaXRlLmV5ZXMgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yMTg4cHg7IGhlaWdodDogMTEwcHg7IH1cbi8vIC5zcHJpdGUuZmluZ2VyLXRpcCB7IGJhY2tncm91bmQtcG9zaXRpb246IDAgLTIzMDhweDsgd2lkdGg6IDUxcHg7IGhlaWdodDogNThweDsgfVxuLy8gLnNwcml0ZS5maW5nZXIgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yMzc2cHg7IHdpZHRoOiA3MXB4OyBoZWlnaHQ6IDU4cHg7IH1cbi8vIC5zcHJpdGUuZm9yZWFybS1jYXAgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yNDQ0cHg7IHdpZHRoOiAzOXB4OyBoZWlnaHQ6IDQycHg7IH1cbi8vIC5zcHJpdGUuZm9yZWFybSB7IGJhY2tncm91bmQtcG9zaXRpb246IDAgLTI0OTZweDsgd2lkdGg6IDE4OXB4OyBoZWlnaHQ6IDMxcHg7IH1cbi8vIC5zcHJpdGUuaGVhZC1iaWcgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yNTM3cHg7IHdpZHRoOiAyMDdweDsgaGVpZ2h0OiAxMjVweDsgfVxuLy8gLnNwcml0ZS5oZWFkLWxlZnRyaWdodCB7IGJhY2tncm91bmQtcG9zaXRpb246IDAgLTI2NzJweDsgd2lkdGg6IDE0cHg7IGhlaWdodDogMTMwcHg7IH1cbi8vIC5zcHJpdGUuaGVhZC1mcm9udC1iYWNrIHsgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMjgxMnB4OyB3aWR0aDogMjA5cHg7IGhlaWdodDogMTRweDsgfVxuLy8gLnNwcml0ZS5uZWNrLWJhc2UgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yODM2cHg7IHdpZHRoOiAzNXB4OyBoZWlnaHQ6IDQycHg7IH1cbi8vIC5zcHJpdGUubmVjay1jYXAgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yODg4cHg7IHdpZHRoOiA0N3B4OyBoZWlnaHQ6IDQycHg7IH1cbi8vIC5zcHJpdGUubmVjay1sb3cgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yOTQwcHg7IHdpZHRoOiAxNzBweDsgaGVpZ2h0OiAzN3B4OyB9XG4vLyAuc3ByaXRlLm5lY2staGlnaCB7IGJhY2tncm91bmQtcG9zaXRpb246IDAgLTI5ODdweDsgd2lkdGg6IDEzN3B4OyBoZWlnaHQ6IDE5cHg7IH1cbi8vIC5zcHJpdGUuc2hvdWxkZXItY2FwIHsgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMzAxNnB4OyB3aWR0aDogODRweDsgaGVpZ2h0OiA4MnB4OyB9XG4vLyAuc3ByaXRlLnNob3VsZGVyLWxlZnQgeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0zMTA4cHg7IHdpZHRoOiA2NXB4OyBoZWlnaHQ6IDEwNXB4OyB9XG4vLyAuc3ByaXRlLndoZWVsIHsgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMzIyM3B4OyB3aWR0aDogNTRweDsgaGVpZ2h0OiAxMzdweDsgfVxuLy8gLnNwcml0ZS53cmlzdCB7IGJhY2tncm91bmQtcG9zaXRpb246IDAgLTMzNzBweDsgd2lkdGg6IDE0OHB4OyBoZWlnaHQ6IDE4cHg7IH1cblxuLyoqXG4gKiBTaW1wbGUgbG9nZ2VyXG4gKiBAdHlwZSB7RnVuY3Rpb259XG4gKi9cbnZhciBkZWJ1ZyA9IDAgPyBjb25zb2xlLmxvZy5iaW5kKGNvbnNvbGUpIDogZnVuY3Rpb24oKSB7fTtcblxuLyoqXG4gKiBFeHBvcnRzXG4gKi9cbm1vZHVsZS5leHBvcnRzID0gY29tcG9uZW50LnJlZ2lzdGVyKCd2ci13YWxsZScsIHtcbiAgZXh0ZW5kczogVlJPYmplY3QucHJvdG90eXBlLFxuXG5cbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IGNsYXNzPVwiZ3JvdW5kXCI+PC9kaXY+XG5cbiAgICA8ZGl2IGNsYXNzPVwid2FsbGVcIj5cblxuICAgICAgPGRpdiBjbGFzcz1cImJvZHlcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBib2R5LWJhY2tcIj48L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBib2R5LWxlZnRcIj48L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBib2R5LXJpZ2h0XCI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgYm9keS1mcm9udFwiPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGJvZHktdG9wXCI+PC9kaXY+XG4gICAgICAgIDwhLS0gPGRpdiBjbGFzcz1cInNwcml0ZSBib2R5LWJvdHRvbVwiPjwvZGl2PiAtLT5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8ZGl2IGNsYXNzPVwiaGVhZFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGhlYWQtYmlnIGJvdHRvbVwiPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGhlYWQtYmlnIHRvcFwiPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGhlYWQtbGVmdHJpZ2h0IGxlZnRcIj48L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBoZWFkLWxlZnRyaWdodCByaWdodFwiPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGhlYWQtZnJvbnQtYmFjayBiYWNrXCI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgZXllc1wiPjwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIG5lY2stbG93XCI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgbmVjay1oaWdoXCI+PC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBhcm0gbGVmdFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGZvcmVhcm1cIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIHdyaXN0XCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgZmluZ2VyIHRodW1iXCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBmaW5nZXItdGlwXCI+PC9kaXY+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGZpbmdlciBpbmRleFwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgZmluZ2VyLXRpcFwiPjwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBmaW5nZXIgcGlua3lcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGZpbmdlci10aXBcIj48L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgYXJtIHJpZ2h0XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgZm9yZWFybVwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgd3Jpc3RcIj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBmaW5nZXIgdGh1bWJcIj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGZpbmdlci10aXBcIj48L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgZmluZ2VyIGluZGV4XCI+XG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBmaW5nZXItdGlwXCI+PC9kaXY+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGZpbmdlciBwaW5reVwiPlxuICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgZmluZ2VyLXRpcFwiPjwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSB3aGVlbCBsZWZ0XCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgYmVsdCBib3R0b21cIj48L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBiZWx0IGJhY2tcIj48L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSBiZWx0IGZyb250XCI+PC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGRpdiBjbGFzcz1cInNwcml0ZSB3aGVlbCByaWdodFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3ByaXRlIGJlbHQgYm90dG9tXCI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgYmVsdCBiYWNrXCI+PC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzcHJpdGUgYmVsdCBmcm9udFwiPjwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICA8L2Rpdj5cblxuICAgIDxzdHlsZT5cbiAgICA6aG9zdCB7XG4gICAgICBsZWZ0OiA1MCU7XG4gICAgICB0b3A6IDUwJTtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIHRyYW5zZm9ybS1zdHlsZTogcHJlc2VydmUtM2Q7XG4gICAgfVxuXG4gICAgLndhbGxlIHtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTpcbiAgICAgIHRyYW5zZm9ybS1zdHlsZTogcHJlc2VydmUtM2Q7XG4gICAgfVxuXG4gICAgLnNwcml0ZSB7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBiYWNrZ3JvdW5kOiB1cmwoJ3RleHR1cmVzL3dhbGxlL3BuZy9hdGxhcy5wbmcnKSBuby1yZXBlYXQgdG9wIGxlZnQ7IHdpZHRoOiAyNzBweDsgaGVpZ2h0OiAzNDNweDtcbiAgICAgIHRyYW5zZm9ybS1zdHlsZTogcHJlc2VydmUtM2Q7XG4gICAgfVxuXG4gICAgLnNwcml0ZS5ib2R5LWZyb250IHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTg0NnB4O1xuICAgIH1cblxuICAgIC5zcHJpdGUuYm9keS1iYWNrIHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTIxMHB4O1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAwLCAtMjcwcHgpO1xuICAgIH1cblxuICAgIC5zcHJpdGUuYm9keS1sZWZ0IHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTExOTlweDtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoLTEzNXB4LCAwLCAtMTM1cHgpIHJvdGF0ZVkoOTBkZWcpO1xuICAgIH1cblxuICAgIC5zcHJpdGUuYm9keS1yaWdodCB7XG4gICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xNTUycHg7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDEzNXB4LCAwLCAtMTM1cHgpIHJvdGF0ZVkoOTBkZWcpIHNjYWxlWCgtMSk7XG4gICAgfVxuXG4gICAgLnNwcml0ZS5ib2R5LXRvcCB7XG4gICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0xOTA1cHg7IHdpZHRoOiAyNzRweDsgaGVpZ2h0OiAyNzNweDtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgLTEzNXB4LCAtMTM1cHgpIHJvdGF0ZVgoOTBkZWcpO1xuICAgIH1cblxuICAgIC5zcHJpdGUuYm9keS1ib3R0b20ge1xuICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtNTYzcHg7IHdpZHRoOiAyNzRweDsgaGVpZ2h0OiAyNzNweDtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgMjEwcHgsIC0xMzVweCkgcm90YXRlWCg5MGRlZyk7XG4gICAgfVxuXG4gICAgLnNwcml0ZS5leWVzIHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTIxODhweDsgaGVpZ2h0OiAxMTBweDtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgLTIxMHB4LCAtODBweCk7XG4gICAgfVxuXG4gICAgLnNwcml0ZS5oZWFkLWJpZyB7XG4gICAgICBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yNTM3cHg7IHdpZHRoOiAyMDdweDsgaGVpZ2h0OiAxMjVweDtcbiAgICB9XG5cbiAgICAuc3ByaXRlLmhlYWQtYmlnLnRvcCB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0yNDBweCwgLTE0MHB4KSByb3RhdGVYKDkwZGVnKTtcbiAgICB9XG5cbiAgICAuc3ByaXRlLmhlYWQtYmlnLmJvdHRvbSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0yMjBweCwgLTE0MHB4KSByb3RhdGVYKDkwZGVnKTtcbiAgICB9XG5cbiAgICAuc3ByaXRlLmhlYWQtbGVmdHJpZ2h0IHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTI2NzJweDsgd2lkdGg6IDE0cHg7IGhlaWdodDogMTMwcHg7XG4gICAgfVxuXG4gICAgLnNwcml0ZS5oZWFkLWxlZnRyaWdodC5sZWZ0IHtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgLTIzMHB4LCAtMTQwcHgpIHJvdGF0ZVooOTBkZWcpIHJvdGF0ZVgoOTBkZWcpO1xuICAgIH1cblxuICAgIC5zcHJpdGUuaGVhZC1sZWZ0cmlnaHQucmlnaHQge1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgyMDdweCwgLTIzMHB4LCAtMTQwcHgpIHJvdGF0ZVooOTBkZWcpIHJvdGF0ZVgoOTBkZWcpO1xuICAgIH1cblxuICAgIC5zcHJpdGUuaGVhZC1mcm9udC1iYWNrIHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTI4MTJweDsgd2lkdGg6IDIwOXB4OyBoZWlnaHQ6IDE0cHg7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0xNzBweCwgLTIwNXB4KTtcbiAgICB9XG5cbiAgICAuc3ByaXRlLmFybS5sZWZ0IHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTEyN3B4OyB3aWR0aDogMjMycHg7IGhlaWdodDogNzNweDtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoLTEzNnB4LCAzMHB4LCAwKSByb3RhdGVZKC05MGRlZyk7XG4gICAgfVxuXG4gICAgLnNwcml0ZS5hcm0ucmlnaHQge1xuICAgICAgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMTI3cHg7IHdpZHRoOiAyMzJweDsgaGVpZ2h0OiA3M3B4O1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgxODBweCwgLTYwcHgsIC02MHB4KSByb3RhdGVYKDYwZGVnKSByb3RhdGVZKC05MGRlZyk7XG4gICAgfVxuXG4gICAgLnNwcml0ZS5mb3JlYXJtIHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTI0OTZweDsgd2lkdGg6IDE4OXB4OyBoZWlnaHQ6IDMxcHg7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDE1OXB4LCAxNnB4LCAwKTtcbiAgICB9XG5cbiAgICAuc3ByaXRlLndyaXN0IHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTMzNzBweDsgd2lkdGg6IDE0OHB4OyBoZWlnaHQ6IDE4cHg7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDEwMHB4LCA5cHgsIDApO1xuICAgIH1cblxuICAgIC5zcHJpdGUuZmluZ2VyIHtcbiAgICAgIGJhY2tncm91bmQtcG9zaXRpb246IDAgLTIzNzZweDsgd2lkdGg6IDcxcHg7IGhlaWdodDogNThweDtcbiAgICB9XG5cbiAgICAuc3ByaXRlLmZpbmdlci50aHVtYiB7XG4gICAgICB0cmFuc2Zvcm06IHJvdGF0ZVgoOTBkZWcpIHRyYW5zbGF0ZTNkKDE0NXB4LCAwcHgsIDApIHJvdGF0ZVkoMTVkZWcpO1xuICAgIH1cblxuICAgIC5zcHJpdGUuZmluZ2VyLmluZGV4IHtcbiAgICAgIHRyYW5zZm9ybTogcm90YXRlWCg5MGRlZykgdHJhbnNsYXRlM2QoMTQ1cHgsIDI1cHgsIDQwcHgpIHJvdGF0ZVkoLTE1ZGVnKTtcbiAgICB9XG5cbiAgICAuc3ByaXRlLmZpbmdlci5waW5reSB7XG4gICAgICB0cmFuc2Zvcm06IHJvdGF0ZVgoOTBkZWcpIHRyYW5zbGF0ZTNkKDE0NXB4LCAtMjVweCwgNDBweCkgcm90YXRlWSgtMTVkZWcpO1xuICAgIH1cblxuICAgIC5zcHJpdGUuZmluZ2VyLXRpcCB7IGJhY2tncm91bmQtcG9zaXRpb246IDAgLTIzMDhweDsgd2lkdGg6IDUxcHg7IGhlaWdodDogNThweDsgfVxuXG4gICAgLnNwcml0ZS5maW5nZXIudGh1bWIgLmZpbmdlci10aXAge1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCg2MHB4LCAwcHgsIDVweCkgcm90YXRlWSgtMTVkZWcpO1xuICAgIH1cblxuICAgIC5zcHJpdGUuZmluZ2VyLmluZGV4IC5maW5nZXItdGlwLFxuICAgIC5zcHJpdGUuZmluZ2VyLnBpbmt5IC5maW5nZXItdGlwIHtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoNjBweCwgMHB4LCAtNXB4KSByb3RhdGVZKDE1ZGVnKTtcbiAgICB9XG5cbiAgICAud2hlZWwubGVmdCB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKC0xMjBweCwgMjAwcHgsIC0xNTBweCkgcm90YXRlWSgtOTBkZWcpIHJvdGF0ZVgoLTkwZGVnKSBzY2FsZSgwLjgpO1xuICAgICAgYmFja2dyb3VuZDogbm9uZTtcbiAgICB9XG5cbiAgICAud2hlZWwucmlnaHQge1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgzMDBweCwgMjAwcHgsIC0xNTBweCkgcm90YXRlWSgtOTBkZWcpIHJvdGF0ZVgoLTkwZGVnKSBzY2FsZSgwLjgpO1xuICAgICAgYmFja2dyb3VuZDogbm9uZTtcbiAgICB9XG5cbiAgICAuYmVsdCB7XG4gICAgICBiYWNrZ3JvdW5kOiB1cmwoJ3RleHR1cmVzL3dhbGxlL3doZWVsLnBuZycpO1xuICAgICAgaGVpZ2h0OiAxMzdweDtcbiAgICAgIHdpZHRoOiBjYWxjKDU0cHggKiA2KTtcbiAgICAgIGJhY2tncm91bmQtcmVwZWF0OiByZXBlYXQteDtcbiAgICB9XG5cbiAgICAuYmVsdC5iYWNrIHtcbiAgICAgIHdpZHRoOiBjYWxjKDU0cHggKiA0KTtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IGxlZnQgNTAlO1xuICAgICAgdHJhbnNmb3JtOiByb3RhdGVZKDkwZGVnKTtcbiAgICB9XG5cbiAgICAuYmVsdC5mcm9udCB7XG4gICAgICB3aWR0aDogY2FsYyg1NHB4ICogNy4yKTtcbiAgICAgIHRyYW5zZm9ybS1vcmlnaW46IHJpZ2h0IDUwJTtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoY2FsYygtMS4yICogNTRweCksIDAsIDApIHJvdGF0ZVkoLTM0ZGVnKTtcbiAgICB9XG5cbiAgICAuc3ByaXRlLm5lY2stbG93IHsgYmFja2dyb3VuZC1wb3NpdGlvbjogMCAtMjk0MHB4OyB3aWR0aDogMTcwcHg7IGhlaWdodDogMzdweDsgfVxuXG4gICAgLnNwcml0ZS5uZWNrLWxvdyB7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiByaWdodCA1MCU7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKC0zNXB4LCAwLCAtMjAwcHgpIHJvdGF0ZVooOTBkZWcpIHJvdGF0ZVkoNDBkZWcpXG4gICAgfVxuXG4gICAgLnNwcml0ZS5uZWNrLWhpZ2ggeyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwIC0yOTg3cHg7IHdpZHRoOiAxMzdweDsgaGVpZ2h0OiAxOXB4OyB9XG5cbiAgICAuc3ByaXRlLm5lY2staGlnaCB7XG4gICAgICB0cmFuc2Zvcm0tb3JpZ2luOiByaWdodCA1MCU7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsIC0xMjBweCwgLTkwcHgpIHJvdGF0ZVooOTBkZWcpIHJvdGF0ZVkoLTYwZGVnKVxuICAgIH1cblxuICAgIC5ncm91bmQge1xuICAgICAgd2lkdGg6IDIwNDhweDtcbiAgICAgIGhlaWdodDogMjA0OHB4O1xuICAgICAgdHJhbnNmb3JtLW9yaWdpbjogbGVmdCA1MCU7XG4gICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBncmVlbjtcbiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoLTUwJSwgY2FsYygtNTAlICsgMzUwcHgpLCAwKSByb3RhdGVYKDkwZGVnKTtcbiAgICAgIHRyYW5zZm9ybS1zdHlsZTogcHJlc2VydmUtM2Q7XG4gICAgICBiYWNrZ3JvdW5kOiB1cmwoJ3RleHR1cmVzL3dhbGxlL3NhbmQuanBnJykgcmVwZWF0O1xuICAgIH1cblxuICAgIDwvc3R5bGU+XG4gIGBcblxufSk7XG5cbn0pO30pKHR5cGVvZiBkZWZpbmU9PSdmdW5jdGlvbicmJmRlZmluZS5hbWQ/ZGVmaW5lXG46KGZ1bmN0aW9uKG4sdyl7J3VzZSBzdHJpY3QnO3JldHVybiB0eXBlb2YgbW9kdWxlPT0nb2JqZWN0Jz9mdW5jdGlvbihjKXtcbmMocmVxdWlyZSxleHBvcnRzLG1vZHVsZSk7fTpmdW5jdGlvbihjKXt2YXIgbT17ZXhwb3J0czp7fX07YyhmdW5jdGlvbihuKXtcbnJldHVybiB3W25dO30sbS5leHBvcnRzLG0pO3dbbl09bS5leHBvcnRzO307fSkoJ1ZSV2FsbGUnLHRoaXMpKTtcbiIsIi8qIGdsb2JhbHMgZGVmaW5lICovXG4oZnVuY3Rpb24oZGVmaW5lKXsndXNlIHN0cmljdCc7ZGVmaW5lKGZ1bmN0aW9uKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpe1xuXG4vKipcbiAqIERlcGVuZGVuY2llc1xuICovXG5cbnZhciBjb21wb25lbnQgPSByZXF1aXJlKCdnYWlhLWNvbXBvbmVudCcpO1xuXG4vKipcbiAqIFNpbXBsZSBsb2dnZXJcbiAqIEB0eXBlIHtGdW5jdGlvbn1cbiAqL1xudmFyIGRlYnVnID0gMCA/IGNvbnNvbGUubG9nLmJpbmQoY29uc29sZSkgOiBmdW5jdGlvbigpIHt9O1xuXG4vKipcbiAqIEV4cG9ydHNcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGNvbXBvbmVudC5yZWdpc3RlcigndnItc2t5Ym94Jywge1xuICBleHRlbmRzOiBWUk9iamVjdC5wcm90b3R5cGUsXG5cbiAgY3JlYXRlZDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuc2V0dXBTY2VuZSgpO1xuICAgIFZST2JqZWN0LnByb3RvdHlwZS5jcmVhdGVkLmNhbGwoc2VsZik7XG4gIH0sXG5cbiAgcGFyYW1ldGVyczoge1xuICAgIHR1cmJpZGl0eTogMTAsXG4gICAgcmVpbGVpZ2g6IDIsXG4gICAgbWllQ29lZmZpY2llbnQ6IDAuMDA1LFxuICAgIG1pZURpcmVjdGlvbmFsRzogMC44LFxuICAgIGx1bWluYW5jZTogMSxcbiAgICBpbmNsaW5hdGlvbjogMC40OSwgLy8gZWxldmF0aW9uIC8gaW5jbGluYXRpb25cbiAgICBhemltdXRoOiAwLjI1LCAvLyBGYWNpbmcgZnJvbnQsXG4gICAgc3VuOiAhdHJ1ZVxuICB9LFxuXG4gIHNldHVwU2NlbmU6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBza3kgPSB0aGlzLnNreSA9IG5ldyBUSFJFRS5Ta3koKTtcbiAgICB2YXIgcGFyYW1ldGVycyA9IHRoaXMucGFyYW1ldGVycztcbiAgICB2YXIgdW5pZm9ybXMgPSBza3kudW5pZm9ybXM7XG4gICAgdW5pZm9ybXMudHVyYmlkaXR5LnZhbHVlID0gcGFyYW1ldGVycy50dXJiaWRpdHk7XG4gICAgdW5pZm9ybXMucmVpbGVpZ2gudmFsdWUgPSBwYXJhbWV0ZXJzLnJlaWxlaWdoO1xuICAgIHVuaWZvcm1zLmx1bWluYW5jZS52YWx1ZSA9IHBhcmFtZXRlcnMubHVtaW5hbmNlO1xuICAgIHVuaWZvcm1zLm1pZUNvZWZmaWNpZW50LnZhbHVlID0gcGFyYW1ldGVycy5taWVDb2VmZmljaWVudDtcbiAgICB1bmlmb3Jtcy5taWVEaXJlY3Rpb25hbEcudmFsdWUgPSBwYXJhbWV0ZXJzLm1pZURpcmVjdGlvbmFsRztcbiAgICBza3kudW5pZm9ybXMuc3VuUG9zaXRpb24udmFsdWUuY29weShuZXcgVEhSRUUuVmVjdG9yMyggLTIwMDAwLCAwLCAtNzAwMDAgKSk7XG4gICAgLy8gQWRkIFNreSBNZXNoXG4gICAgdGhpcy5vYmplY3QzRCA9IHNreS5tZXNoO1xuICB9XG5cbn0pO1xuXG59KTt9KSh0eXBlb2YgZGVmaW5lPT0nZnVuY3Rpb24nJiZkZWZpbmUuYW1kP2RlZmluZVxuOihmdW5jdGlvbihuLHcpeyd1c2Ugc3RyaWN0JztyZXR1cm4gdHlwZW9mIG1vZHVsZT09J29iamVjdCc/ZnVuY3Rpb24oYyl7XG5jKHJlcXVpcmUsZXhwb3J0cyxtb2R1bGUpO306ZnVuY3Rpb24oYyl7dmFyIG09e2V4cG9ydHM6e319O2MoZnVuY3Rpb24obil7XG5yZXR1cm4gd1tuXTt9LG0uZXhwb3J0cyxtKTt3W25dPW0uZXhwb3J0czt9O30pKCdWUlNreUJveCcsdGhpcykpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9