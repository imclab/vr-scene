<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>HORIZON HUD</title>
  <meta name="description" content="Demo of Horizon HUD using Web Components">
  <link rel="stylesheet" type="text/css" href="style/horizon.css" />
  <link rel="stylesheet" href="js/lib/codemirror/codemirror.css">
  <link rel="stylesheet" href="js/lib/codemirror/theme/monokai.css">
</head>

<!-- HUD -->
<!-- <div id="hud" class="hud threed">

  <div id="background" class="background threed"></div>

  <div id="title" class="title threed">
    <span id="title__icon" class="title__icon"></span>
    <span id="title__text" class="title__text"></span>
  </div>

  <div id="directory" class="directory threed"></div>

  <form id="urlbar" class="urlbar threed" action="#">
    <input class="urlbar__input" type="text">
  </form>

  <div id="backfwd" class="backfwd threed">
    <span class="fa fa-arrow-left nav backfwd__back" data-action="back" id="backfwd__back"></span>
    <span class="fa fa-arrow-right nav backfwd__forward" data-action="forward" id="backfwd__forward"></span>
  </div>

  <div id="stopreload" class="stopreload threed">
    <span class="fa fa-repeat nav stopreload--reload" data-action="reload" id="stopreload--reload"></span>
    <span class="fa fa-times nav stopreload--stop" data-action="stop" id="stopreload--stop"></span>
  </div>

  <div id="closehud" class="closehud threed">Close HUD</div>
  <div id="resetsensor" class="resetsensor threed">Reset Sensor</div>

  <div id="loading" class="loading threed">LOADING</div>

</div> -->

<body>
  <vr-scene class="scene">
    <vr-camera class="camera">
      <vr-object class="pivot">
        <vr-object class="hud" style="--z: 1000">
          <vr-object class="links" style="--y: -50">
            <vr-object class="row1" style="--y: -110">
              <vr-object class="hud-element hud-button" style="--x: -440">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
              <vr-object class="hud-element hud-button" style="--x: -220">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
              <vr-object class="hud-element hud-button">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
              <vr-object class="hud-element hud-button" style="--x: 220">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
              <vr-object class="hud-element hud-button" style="--x: 440">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
            </vr-object>
            <vr-object class="row2" style="--y: 110">
              <vr-object class="hud-element hud-button" style="--x: -330">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
              <vr-object class="hud-element hud-button" style="--x: -110">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
              <vr-object class="hud-element hud-button" style="--x: 110">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
              <vr-object class="hud-element hud-button" style="--x: 330">
                <div>
                  <h1>Title</h1>
                  <h2>Subtitle</h2>
                </div>
              </vr-object>
            </vr-object>
          </vr-object>
          <vr-object class="hud-element hud-url" style="--y: 220">www.mozilla.com</vr-object>
        </vr-object>
      </vr-object>
    </vr-camera>
  </vr-scene>
  <button class="vr-button">Enter VR</button>
  <button class="source-button view-source">View Source</button>
  <div class="source">
    <div class="source-controls">
      <button class="vr-button">Enter VR</button>
      <button class="source-button close-source">Close Source</button>
    </div>
  </div>
  <script src="js/lib/codemirror/codemirror.js"></script>
  <script src="js/lib/codemirror/addon/searchcursor.js"></script>
  <script src="js/lib/codemirror/mode/javascript.js"></script>

  <script src="../lib/vendor/dat.gui.js"></script>
  <script src="../lib/vendor/three.js"></script>
  <script src="../lib/vendor/VRControls.js"></script>
  <script src="../lib/vendor/VREffect.js"></script>
  <script src="../src/vr-editor.js"></script>
  <script src="../build/vr-components.js"></script>
  <script>
    var vrDevices = {};
    var container = document.querySelector('vr-scene');

    function start() {
      var sourcePanel = document.querySelector('.source');
      var fsButtons = document.querySelectorAll('.vr-button');
      var i;
      for(i=0; i<fsButtons.length; ++i) {
        fsButtons[i].addEventListener('click', function() {
          container.mozRequestFullScreen({ vrDisplay: vrDevices.headset });
        });
      }

      var source;
      var sourceButtons = document.querySelectorAll('.source-button');
      sourcePanel.style.display = 'none';
      for(i=0; i<sourceButtons.length; ++i) {
        sourceButtons[i].addEventListener('click', function(evt) {
          var close = evt.currentTarget.classList.contains('close-source');
          //var source;
          if (close) {
            sourcePanel.style.display = 'none';
            VREditor.enableAnimation(true);
          } else {
            VREditor.enableAnimation(false);
            sourcePanel.style.display = '';
            source = container.innerHTML
              .replace(/transform: translate3d\(-50%, -50%, 0px\)\ /g,'') // transforms set by scene
              .replace(/matrix3d\(([-+]?(\d+)(\.\d+)?, )+[-+]?(\d+)(\.\d+)?\);/g,'') // matrix styles set by scene
              .replace(/width: (\d+)[.]?(\d+)px; /g,'') // width styles set by scene
              .replace(/ height: (\d+)[.]?(\d+)px;/g,'')  // height styles set by scene
              .replace(/<style scoped="">([\S\s]*?)<\/style>/g,'') // scoped styles
              .replace(/style=""/g,'') // remaining empty style attrbitutes
              .replace(/:(\s+)/g,': ');
            codemirror.setValue( source );
            var cursor = codemirror.getSearchCursor("selected");
            if (cursor.findNext()) {
              debugger;
              codemirror.addLineClass(cursor.pos.from.line, 'background', 'line-highlight');
            }
          }
        });
      }

      window.addEventListener('resize', function(e) {
        console.log('window Height = container Height', window.innerHeight == container.offsetHeight)
      })
    }

    var codemirror = CodeMirror(document.querySelector('.source'), {
      lineNumbers: true,
      matchBrackets: true,
      indentWithTabs: true,
      lineWrapping: true,
      tabSize: 2,
      indentUnit: 2,
      mode: "javascript"
    });
    codemirror.setOption('theme', 'monokai');

    codemirror.on('change', function() {
      var source = codemirror.getValue();
      container.innerHTML = source;
      VREditor.reset();
    });

    navigator.getVRDevices().then(function(devices) {
      vrDevices.headset = devices[0];
      vrDevices.position = devices[1];
      start();
    });

    document.addEventListener('copy', function(e) {
        var source = codemirror.getValue();
        e.clipboardData.setData('text/plain', textToPutOnClipboard);
        e.preventDefault();
    });
  </script>
</body>
</html>
